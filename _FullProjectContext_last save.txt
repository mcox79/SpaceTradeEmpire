=== SPACE TRADE EMPIRE PROJECT DUMP ===
format_version: 5.0
dump_timestamp: 2026-01-22T14:41:20.2594659-05:00
project_root: C:\Users\marsh\Documents\Space Trade Empire
devtool_path: C:\Users\marsh\Documents\Space Trade Empire\DevTool.ps1
devtool_sha256: 95954056E9EB5BF7509D9627A705DBA882A3A84A1993742D8A6DD0FBFE81135C
max_inline_bytes: 52428800

=== LIVE PROJECT STRUCTURE (SYSTEM FOLDERS HIDDEN) ===
+ [.git]
+ [.godot]
+ [addons]
+ [resources]
+ [scenes]
+ [scripts]
- .gitattributes
- .gitignore
- DevTool - Copy.ps1
- DevTool.ps1
- DevTool.ps1 - Shortcut.lnk
- DevTool.ps1.bak_20260122_143430
- godot_path.cfg
- icon.png.import
- icon.svg.import
- project.godot
- project.godot.bak_20260122_134706
- project.godot.bak_20260122_134725
- _FullProjectContext3.txt
- _PROJECT_CONTEXT.md
- _PROJECT_CONTEXT.md.bak_20260122_135730
- _PROJECT_CONTEXT.md.bak_20260122_140333
- _RESET_UNTRACKED_TEST.tmp
+   [phantom_camera]
+     [assets]
+     [examples]
+     [fonts]
+     [icons]
+     [inspector]
+     [panel]
+     [scripts]
+     [themes]
-     plugin.cfg
-     plugin.gd
-     plugin.gd.uid
-       PhantomCameraBtnPrimaryDefault.png
-       PhantomCameraBtnPrimaryDefault.png.import
-       PhantomCameraBtnPrimaryHover.png
-       PhantomCameraBtnPrimaryHover.png.import
+       [example_scenes]
+       [models]
+       [resources]
+       [scripts]
+       [textures]
+       [ui]
-       credits.txt
+         [2D]
+         [3D]
+           [sub_scenes]
-           2d_example_scene.tscn
-           2d_follow_framed_example_scene.tscn
-           2d_follow_group_example_scene.tscn
-           2d_follow_path_example_scene.tscn
-           2d_limit_example_scene.tscn
-           2d_noise_example_scene.tscn
-           2d_tweening_example_scene.tscn
-             playable_character_2d.tscn
+           [sub_scenes]
-           3d_example_scene.tscn
-           3d_follow_framed_example_scene.tscn
-           3d_follow_glued_example_scene.tscn
-           3d_follow_group_example_scene.tscn
-           3d_follow_path_example_scene.tscn
-           3d_follow_simple_example_scene.tscn
-           3d_follow_third_person_attribtues_example_scene.tscn
-           3d_follow_third_person_example_scene.tscn
-           3d_look_at_example_scene.tscn
-           3d_noise_example_scene.tscn
-           3d_tweening_example_scene.tscn
-             playable_character_3d.tscn
-             playable_character_third_person_3d.tscn
-         3d_cube_dark.tscn
+         [tween]
-           fixed_camera_tween.tres
-           inventory_phantom_camera_2d_tween.tres
-           item_focus_phantom_camera_2d_tween.tres
-           player_phantom_camera_2d_tween.tres
-           player_phantom_camera_3d_tween.tres
+         [2D]
+         [3D]
-           2d_room_limit_tween.gd
-           2d_room_limit_tween.gd.uid
-           2d_trigger_area.gd
-           2d_trigger_area.gd.uid
-           player_character_body_2d.gd
-           player_character_body_2d.gd.uid
-           3d_trigger_area.gd
-           3d_trigger_area.gd.uid
-           npc.gd
-           npc.gd.uid
-           path_follow.gd
-           path_follow.gd.uid
-           player_controller.gd
-           player_controller.gd.uid
-           player_controller_first_person.gd
-           player_controller_first_person.gd.uid
-           player_controller_third_person.gd
-           player_controller_third_person.gd.uid
+         [2D]
+         [3D]
-           inventory_container.png
-           inventory_container.png.import
-           level_spritesheet.png
-           level_spritesheet.png.import
-           phantom_camera_2d_sprite.png
-           phantom_camera_2d_sprite.png.import
-           player_sprite.svg
-           player_sprite.svg.import
-           sign_prompt.png
-           sign_prompt.png.import
-           checker_pattern_dark.png
-           checker_pattern_dark.png.import
-           target.png
-           target.png.import
-         ui_inventory.tscn
-         ui_sign.tscn
-       Nunito-Black.ttf
-       Nunito-Black.ttf.import
-       Nunito-Regular.ttf
-       Nunito-Regular.ttf.import
+       [misc]
+       [viewfinder]
-       phantom_camera_2d.svg
-       phantom_camera_2d.svg.import
-       phantom_camera_3d.svg
-       phantom_camera_3d.svg.import
-       phantom_camera_camera_3d_resource.svg
-       phantom_camera_camera_3d_resource.svg.import
-       phantom_camera_gizmo.svg
-       phantom_camera_gizmo.svg.import
-       phantom_camera_glow_logo.png
-       phantom_camera_glow_logo.png.import
-       phantom_camera_host.svg
-       phantom_camera_host.svg.import
-       phantom_camera_logo.png
-       phantom_camera_logo.png.import
-       phantom_camera_noise_emitter_2d.svg
-       phantom_camera_noise_emitter_2d.svg.import
-       phantom_camera_noise_emitter_3d.svg
-       phantom_camera_noise_emitter_3d.svg.import
-       phantom_camera_noise_emitter_gizmo.svg
-       phantom_camera_noise_emitter_gizmo.svg.import
-       phantom_camera_noise_resource.svg
-       phantom_camera_noise_resource.svg.import
-       phantom_camera_tween.svg
-       phantom_camera_tween.svg.import
-       phantom_camera_tween_director.svg
-       phantom_camera_tween_director.svg.import
-       phantom_camera_tween_director_resource.svg
-       phantom_camera_tween_director_resource.svg.import
-       phantom_camera_updater_panel_icon.svg
-       phantom_camera_updater_panel_icon.svg.import
-       warning.svg
-       warning.svg.import
-         PriorityOverride.svg
-         PriorityOverride.svg.import
-         Camera2DIcon.svg
-         Camera2DIcon.svg.import
-         Camera3DIcon.svg
-         Camera3DIcon.svg.import
-         SceneTypesIcon.svg
-         SceneTypesIcon.svg.import
-         Select.svg
-         Select.svg.import
-       phantom_camera_inspector_plugin.gd
-       phantom_camera_inspector_plugin.gd.uid
+       [updater]
+       [viewfinder]
-       editor.gd.uid
-       editor.tscn
-         download_update_panel.tscn
-         update_button.tscn
+         [host_list]
-         deadzone_style_box.tres
-         viewfinder_panel.tscn
-           host_list.tscn
-           host_list_item.tscn
-           host_list_item_group.tres
+       [gizmos]
+       [managers]
+       [panel]
+       [phantom_camera]
+       [phantom_camera_host]
+       [resources]
-         phantom_camera_3d_gizmo.gd
-         phantom_camera_3d_gizmo.gd.uid
-         phantom_camera_3d_gizmo_plugin.gd
-         phantom_camera_3d_gizmo_plugin.gd.uid
-         phantom_camera_noise_emitter_gizmo_plugin_3d.gd
-         phantom_camera_noise_emitter_gizmo_plugin_3d.gd.uid
-         PhantomCameraManager.cs
-         PhantomCameraManager.cs.uid
-         phantom_camera_manager.gd
-         phantom_camera_manager.gd.uid
+         [updater]
+         [viewfinder]
-         editor.gd
-         editor.gd.uid
-           download_update_panel.gd
-           download_update_panel.gd.uid
-           updater_constants.gd
-           updater_constants.gd.uid
-           update_button.gd
-           update_button.gd.uid
-           host_list.gd
-           host_list.gd.uid
-           host_list_item.gd
-           host_list_item.gd.uid
-           viewfinder.gd
-           viewfinder.gd.uid
-         PhantomCamera.cs
-         PhantomCamera.cs.uid
-         PhantomCamera2D.cs
-         PhantomCamera2D.cs.uid
-         PhantomCamera3D.cs
-         PhantomCamera3D.cs.uid
-         PhantomCameraNoiseEmitter2D.cs
-         PhantomCameraNoiseEmitter2D.cs.uid
-         PhantomCameraNoiseEmitter3D.cs
-         PhantomCameraNoiseEmitter3D.cs.uid
-         PhantomCameraTweenDirector.cs
-         phantom_camera_2d.gd
-         phantom_camera_2d.gd.uid
-         phantom_camera_3d.gd
-         phantom_camera_3d.gd.uid
-         phantom_camera_constants.gd
-         phantom_camera_constants.gd.uid
-         phantom_camera_noise_emitter_2d.gd
-         phantom_camera_noise_emitter_2d.gd.uid
-         phantom_camera_noise_emitter_3d.gd
-         phantom_camera_noise_emitter_3d.gd.uid
-         phantom_camera_tween_director.gd
-         phantom_camera_tween_director.gd.uid
-         PhantomCameraHost.cs
-         PhantomCameraHost.cs.uid
-         phantom_camera_host.gd
-         phantom_camera_host.gd.uid
-         Camera3DResource.cs
-         Camera3DResource.cs.uid
-         camera_3d_resource.gd
-         camera_3d_resource.gd.uid
-         PhantomCameraNoise2D.cs
-         PhantomCameraNoise2D.cs.uid
-         PhantomCameraNoise3D.cs
-         PhantomCameraNoise3D.cs.uid
-         PhantomCameraTween.cs
-         PhantomCameraTween.cs.uid
-         phantom_camera_noise_2d.gd
-         phantom_camera_noise_2d.gd.uid
-         phantom_camera_noise_3d.gd
-         phantom_camera_noise_3d.gd.uid
-         TweenDirectorResource.cs
-         tween_director_resource.gd
-         tween_director_resource.gd.uid
-         tween_resource.gd
-         tween_resource.gd.uid
-       button_focus.tres
-       button_hover.tres
-       button_normal.tres
-       theme.tres
+   [commodities]
+   [markets]
-     gold.tres
-     iron.tres
-     station_alpha_profile.tres
-     station_beta_profile.tres
+   [tests]
-   asteroid.tscn
-   bullet.tscn
-   enemy.tscn
-   main.tscn
-   main.tscn.bak_20260121_212252
-   main.tscn.bak_20260121_215200
-   player.tscn
-   station.tscn
-   ui_hud.tscn
-     test_economy_core.tscn
-     test_galaxy_core.tscn
+   [core]
+   [debug]
+   [resources]
+   [tests]
-   asteroid.gd
-   asteroid.gd.uid
-   bullet.gd
-   bullet.gd.uid
-   enemy.gd
-   enemy.gd.bak_20260122_135040
-   enemy.gd.uid
-   hud.gd
-   hud.gd.uid
-   player.gd
-   player.gd.bak_20260122_134537
-   player.gd.bak_20260122_134610
-   player.gd.bak_20260122_134640
-   player.gd.bak_20260122_135117
-   player.gd.bak_20260122_135146
-   player.gd.uid
-   spawner.gd
-   spawner.gd.uid
-   starfield.gd
-   starfield.gd.uid
-   station.gd
-   station.gd.uid
-     economy_engine.gd
-     economy_engine.gd.uid
-     galaxy_graph.gd
-     galaxy_graph.gd.uid
-     camera_follow.gd
-     camera_follow.gd.uid
-     market_profile.gd
-     market_profile.gd.uid
-     sector.gd
-     sector.gd.uid
-     trade_good.gd
-     trade_good.gd.uid
-     test_economy_core.gd
-     test_economy_core.gd.uid
-     test_galaxy_core.gd
-     test_galaxy_core.gd.uid
========================================

=== THIRD PARTY / EXTERNAL INVENTORY (REFERENCED, NOT INLINED) ===
third_party_dirs: addons, third_party, vendor, externals, external
INVENTORY: addons
  file_count: 200
  total_bytes: 1475207
  top_extensions: .uid:46, .gd:34, .import:32, .tscn:30, .svg:20, .cs:13, .tres:11, .png:10, .ttf:2, .cfg:1, .txt:1
========================================

=== INLINE FILE MANIFEST (NON-3RD-PARTY) ===
inline_file_count: 35
===========================================

<<< BEGIN FILE >>>
index: 1
path: _FullProjectContext3.txt
bytes: 176458
sha256: 9D8CCA37A3798BE4CAF27F91D29ACE607765DE12329F8D3361FE4F723D8560E8
<<< CONTENT >>>
=== SPACE TRADE EMPIRE PROJECT DUMP ===
format_version: 5.0
dump_timestamp: 2026-01-22T14:04:12.6628223-05:00
project_root: C:\Users\marsh\Documents\Space Trade Empire
devtool_path: C:\Users\marsh\Documents\Space Trade Empire\DevTool.ps1
devtool_sha256: D4DC9883D9DCB9DCA17C3F70B08531EB164B5D981766412172F135461A101652
max_inline_bytes: 52428800

=== LIVE PROJECT STRUCTURE (SYSTEM FOLDERS HIDDEN) ===
+ [.git]
+ [.godot]
+ [addons]
+ [resources]
+ [scenes]
+ [scripts]
- .gitattributes
- .gitignore
- DevTool - Copy.ps1
- DevTool.ps1
- DevTool.ps1 - Shortcut.lnk
- godot_path.cfg
- icon.png.import
- icon.svg.import
- project.godot
- project.godot.bak_20260122_134706
- project.godot.bak_20260122_134725
- _FullProjectContext2.txt
- _PROJECT_CONTEXT.md
- _PROJECT_CONTEXT.md.bak_20260122_135730
- _PROJECT_CONTEXT.md.bak_20260122_140333
+   [phantom_camera]
+     [assets]
+     [examples]
+     [fonts]
+     [icons]
+     [inspector]
+     [panel]
+     [scripts]
+     [themes]
-     plugin.cfg
-     plugin.gd
-     plugin.gd.uid
-       PhantomCameraBtnPrimaryDefault.png
-       PhantomCameraBtnPrimaryDefault.png.import
-       PhantomCameraBtnPrimaryHover.png
-       PhantomCameraBtnPrimaryHover.png.import
+       [example_scenes]
+       [models]
+       [resources]
+       [scripts]
+       [textures]
+       [ui]
-       credits.txt
+         [2D]
+         [3D]
+           [sub_scenes]
-           2d_example_scene.tscn
-           2d_follow_framed_example_scene.tscn
-           2d_follow_group_example_scene.tscn
-           2d_follow_path_example_scene.tscn
-           2d_limit_example_scene.tscn
-           2d_noise_example_scene.tscn
-           2d_tweening_example_scene.tscn
-             playable_character_2d.tscn
+           [sub_scenes]
-           3d_example_scene.tscn
-           3d_follow_framed_example_scene.tscn
-           3d_follow_glued_example_scene.tscn
-           3d_follow_group_example_scene.tscn
-           3d_follow_path_example_scene.tscn
-           3d_follow_simple_example_scene.tscn
-           3d_follow_third_person_attribtues_example_scene.tscn
-           3d_follow_third_person_example_scene.tscn
-           3d_look_at_example_scene.tscn
-           3d_noise_example_scene.tscn
-           3d_tweening_example_scene.tscn
-             playable_character_3d.tscn
-             playable_character_third_person_3d.tscn
-         3d_cube_dark.tscn
+         [tween]
-           fixed_camera_tween.tres
-           inventory_phantom_camera_2d_tween.tres
-           item_focus_phantom_camera_2d_tween.tres
-           player_phantom_camera_2d_tween.tres
-           player_phantom_camera_3d_tween.tres
+         [2D]
+         [3D]
-           2d_room_limit_tween.gd
-           2d_room_limit_tween.gd.uid
-           2d_trigger_area.gd
-           2d_trigger_area.gd.uid
-           player_character_body_2d.gd
-           player_character_body_2d.gd.uid
-           3d_trigger_area.gd
-           3d_trigger_area.gd.uid
-           npc.gd
-           npc.gd.uid
-           path_follow.gd
-           path_follow.gd.uid
-           player_controller.gd
-           player_controller.gd.uid
-           player_controller_first_person.gd
-           player_controller_first_person.gd.uid
-           player_controller_third_person.gd
-           player_controller_third_person.gd.uid
+         [2D]
+         [3D]
-           inventory_container.png
-           inventory_container.png.import
-           level_spritesheet.png
-           level_spritesheet.png.import
-           phantom_camera_2d_sprite.png
-           phantom_camera_2d_sprite.png.import
-           player_sprite.svg
-           player_sprite.svg.import
-           sign_prompt.png
-           sign_prompt.png.import
-           checker_pattern_dark.png
-           checker_pattern_dark.png.import
-           target.png
-           target.png.import
-         ui_inventory.tscn
-         ui_sign.tscn
-       Nunito-Black.ttf
-       Nunito-Black.ttf.import
-       Nunito-Regular.ttf
-       Nunito-Regular.ttf.import
+       [misc]
+       [viewfinder]
-       phantom_camera_2d.svg
-       phantom_camera_2d.svg.import
-       phantom_camera_3d.svg
-       phantom_camera_3d.svg.import
-       phantom_camera_camera_3d_resource.svg
-       phantom_camera_camera_3d_resource.svg.import
-       phantom_camera_gizmo.svg
-       phantom_camera_gizmo.svg.import
-       phantom_camera_glow_logo.png
-       phantom_camera_glow_logo.png.import
-       phantom_camera_host.svg
-       phantom_camera_host.svg.import
-       phantom_camera_logo.png
-       phantom_camera_logo.png.import
-       phantom_camera_noise_emitter_2d.svg
-       phantom_camera_noise_emitter_2d.svg.import
-       phantom_camera_noise_emitter_3d.svg
-       phantom_camera_noise_emitter_3d.svg.import
-       phantom_camera_noise_emitter_gizmo.svg
-       phantom_camera_noise_emitter_gizmo.svg.import
-       phantom_camera_noise_resource.svg
-       phantom_camera_noise_resource.svg.import
-       phantom_camera_tween.svg
-       phantom_camera_tween.svg.import
-       phantom_camera_tween_director.svg
-       phantom_camera_tween_director.svg.import
-       phantom_camera_tween_director_resource.svg
-       phantom_camera_tween_director_resource.svg.import
-       phantom_camera_updater_panel_icon.svg
-       phantom_camera_updater_panel_icon.svg.import
-       warning.svg
-       warning.svg.import
-         PriorityOverride.svg
-         PriorityOverride.svg.import
-         Camera2DIcon.svg
-         Camera2DIcon.svg.import
-         Camera3DIcon.svg
-         Camera3DIcon.svg.import
-         SceneTypesIcon.svg
-         SceneTypesIcon.svg.import
-         Select.svg
-         Select.svg.import
-       phantom_camera_inspector_plugin.gd
-       phantom_camera_inspector_plugin.gd.uid
+       [updater]
+       [viewfinder]
-       editor.gd.uid
-       editor.tscn
-         download_update_panel.tscn
-         update_button.tscn
+         [host_list]
-         deadzone_style_box.tres
-         viewfinder_panel.tscn
-           host_list.tscn
-           host_list_item.tscn
-           host_list_item_group.tres
+       [gizmos]
+       [managers]
+       [panel]
+       [phantom_camera]
+       [phantom_camera_host]
+       [resources]
-         phantom_camera_3d_gizmo.gd
-         phantom_camera_3d_gizmo.gd.uid
-         phantom_camera_3d_gizmo_plugin.gd
-         phantom_camera_3d_gizmo_plugin.gd.uid
-         phantom_camera_noise_emitter_gizmo_plugin_3d.gd
-         phantom_camera_noise_emitter_gizmo_plugin_3d.gd.uid
-         PhantomCameraManager.cs
-         PhantomCameraManager.cs.uid
-         phantom_camera_manager.gd
-         phantom_camera_manager.gd.uid
+         [updater]
+         [viewfinder]
-         editor.gd
-         editor.gd.uid
-           download_update_panel.gd
-           download_update_panel.gd.uid
-           updater_constants.gd
-           updater_constants.gd.uid
-           update_button.gd
-           update_button.gd.uid
-           host_list.gd
-           host_list.gd.uid
-           host_list_item.gd
-           host_list_item.gd.uid
-           viewfinder.gd
-           viewfinder.gd.uid
-         PhantomCamera.cs
-         PhantomCamera.cs.uid
-         PhantomCamera2D.cs
-         PhantomCamera2D.cs.uid
-         PhantomCamera3D.cs
-         PhantomCamera3D.cs.uid
-         PhantomCameraNoiseEmitter2D.cs
-         PhantomCameraNoiseEmitter2D.cs.uid
-         PhantomCameraNoiseEmitter3D.cs
-         PhantomCameraNoiseEmitter3D.cs.uid
-         PhantomCameraTweenDirector.cs
-         phantom_camera_2d.gd
-         phantom_camera_2d.gd.uid
-         phantom_camera_3d.gd
-         phantom_camera_3d.gd.uid
-         phantom_camera_constants.gd
-         phantom_camera_constants.gd.uid
-         phantom_camera_noise_emitter_2d.gd
-         phantom_camera_noise_emitter_2d.gd.uid
-         phantom_camera_noise_emitter_3d.gd
-         phantom_camera_noise_emitter_3d.gd.uid
-         phantom_camera_tween_director.gd
-         phantom_camera_tween_director.gd.uid
-         PhantomCameraHost.cs
-         PhantomCameraHost.cs.uid
-         phantom_camera_host.gd
-         phantom_camera_host.gd.uid
-         Camera3DResource.cs
-         Camera3DResource.cs.uid
-         camera_3d_resource.gd
-         camera_3d_resource.gd.uid
-         PhantomCameraNoise2D.cs
-         PhantomCameraNoise2D.cs.uid
-         PhantomCameraNoise3D.cs
-         PhantomCameraNoise3D.cs.uid
-         PhantomCameraTween.cs
-         PhantomCameraTween.cs.uid
-         phantom_camera_noise_2d.gd
-         phantom_camera_noise_2d.gd.uid
-         phantom_camera_noise_3d.gd
-         phantom_camera_noise_3d.gd.uid
-         TweenDirectorResource.cs
-         tween_director_resource.gd
-         tween_director_resource.gd.uid
-         tween_resource.gd
-         tween_resource.gd.uid
-       button_focus.tres
-       button_hover.tres
-       button_normal.tres
-       theme.tres
+   [commodities]
-     iron.tres
+   [tests]
-   asteroid.tscn
-   bullet.tscn
-   enemy.tscn
-   main.tscn
-   main.tscn.bak_20260121_212252
-   main.tscn.bak_20260121_215200
-   player.tscn
-   station.tscn
-   ui_hud.tscn
-     test_economy_core.tscn
-     test_galaxy_core.tscn
+   [core]
+   [debug]
+   [resources]
+   [tests]
-   asteroid.gd
-   asteroid.gd.uid
-   bullet.gd
-   bullet.gd.uid
-   camera_follow.gd.uid
-   enemy.gd
-   enemy.gd.bak_20260122_135040
-   enemy.gd.uid
-   hud.gd
-   hud.gd.uid
-   player.gd
-   player.gd.bak_20260122_134537
-   player.gd.bak_20260122_134610
-   player.gd.bak_20260122_134640
-   player.gd.bak_20260122_135117
-   player.gd.bak_20260122_135146
-   player.gd.uid
-   spawner.gd
-   spawner.gd.uid
-   starfield.gd
-   starfield.gd.uid
-   station.gd
-   station.gd.uid
-     economy_engine.gd
-     economy_engine.gd.uid
-     galaxy_graph.gd
-     galaxy_graph.gd.uid
-     camera_follow.gd
-     market_profile.gd
-     market_profile.gd.uid
-     sector.gd
-     sector.gd.uid
-     trade_good.gd
-     trade_good.gd.uid
-     test_economy_core.gd
-     test_economy_core.gd.uid
-     test_galaxy_core.gd
-     test_galaxy_core.gd.uid
========================================

=== THIRD PARTY / EXTERNAL INVENTORY (REFERENCED, NOT INLINED) ===
third_party_dirs: addons, third_party, vendor, externals, external
INVENTORY: addons
  file_count: 200
  total_bytes: 1475207
  top_extensions: .uid:46, .gd:34, .import:32, .tscn:30, .svg:20, .cs:13, .tres:11, .png:10, .ttf:2, .cfg:1, .txt:1
========================================

=== INLINE FILE MANIFEST (NON-3RD-PARTY) ===
inline_file_count: 32
===========================================

<<< BEGIN FILE >>>
index: 1
path: _FullProjectContext2.txt
bytes: 95181
sha256: A411449A0F4AFF0CE6F94786830951525FEC8A3A6A163F60341074D7052EE328
<<< CONTENT >>>
=== SPACE TRADE EMPIRE PROJECT DUMP ===
format_version: 5.0
dump_timestamp: 2026-01-22T13:58:32.5150997-05:00
project_root: C:\Users\marsh\Documents\Space Trade Empire
devtool_path: C:\Users\marsh\Documents\Space Trade Empire\DevTool.ps1
devtool_sha256: D4DC9883D9DCB9DCA17C3F70B08531EB164B5D981766412172F135461A101652
max_inline_bytes: 52428800

=== LIVE PROJECT STRUCTURE (SYSTEM FOLDERS HIDDEN) ===
+ [.git]
+ [.godot]
+ [addons]
+ [resources]
+ [scenes]
+ [scripts]
- .gitattributes
- .gitignore
- DevTool - Copy.ps1
- DevTool.ps1
- DevTool.ps1 - Shortcut.lnk
- godot_path.cfg
- icon.png.import
- icon.svg.import
- project.godot
- project.godot.bak_20260122_134706
- project.godot.bak_20260122_134725
- _FullProjectContext.txt
- _PROJECT_CONTEXT.md
- _PROJECT_CONTEXT.md.bak_20260122_135730
+   [phantom_camera]
+     [assets]
+     [examples]
+     [fonts]
+     [icons]
+     [inspector]
+     [panel]
+     [scripts]
+     [themes]
-     plugin.cfg
-     plugin.gd
-     plugin.gd.uid
-       PhantomCameraBtnPrimaryDefault.png
-       PhantomCameraBtnPrimaryDefault.png.import
-       PhantomCameraBtnPrimaryHover.png
-       PhantomCameraBtnPrimaryHover.png.import
+       [example_scenes]
+       [models]
+       [resources]
+       [scripts]
+       [textures]
+       [ui]
-       credits.txt
+         [2D]
+         [3D]
+           [sub_scenes]
-           2d_example_scene.tscn
-           2d_follow_framed_example_scene.tscn
-           2d_follow_group_example_scene.tscn
-           2d_follow_path_example_scene.tscn
-           2d_limit_example_scene.tscn
-           2d_noise_example_scene.tscn
-           2d_tweening_example_scene.tscn
-             playable_character_2d.tscn
+           [sub_scenes]
-           3d_example_scene.tscn
-           3d_follow_framed_example_scene.tscn
-           3d_follow_glued_example_scene.tscn
-           3d_follow_group_example_scene.tscn
-           3d_follow_path_example_scene.tscn
-           3d_follow_simple_example_scene.tscn
-           3d_follow_third_person_attribtues_example_scene.tscn
-           3d_follow_third_person_example_scene.tscn
-           3d_look_at_example_scene.tscn
-           3d_noise_example_scene.tscn
-           3d_tweening_example_scene.tscn
-             playable_character_3d.tscn
-             playable_character_third_person_3d.tscn
-         3d_cube_dark.tscn
+         [tween]
-           fixed_camera_tween.tres
-           inventory_phantom_camera_2d_tween.tres
-           item_focus_phantom_camera_2d_tween.tres
-           player_phantom_camera_2d_tween.tres
-           player_phantom_camera_3d_tween.tres
+         [2D]
+         [3D]
-           2d_room_limit_tween.gd
-           2d_room_limit_tween.gd.uid
-           2d_trigger_area.gd
-           2d_trigger_area.gd.uid
-           player_character_body_2d.gd
-           player_character_body_2d.gd.uid
-           3d_trigger_area.gd
-           3d_trigger_area.gd.uid
-           npc.gd
-           npc.gd.uid
-           path_follow.gd
-           path_follow.gd.uid
-           player_controller.gd
-           player_controller.gd.uid
-           player_controller_first_person.gd
-           player_controller_first_person.gd.uid
-           player_controller_third_person.gd
-           player_controller_third_person.gd.uid
+         [2D]
+         [3D]
-           inventory_container.png
-           inventory_container.png.import
-           level_spritesheet.png
-           level_spritesheet.png.import
-           phantom_camera_2d_sprite.png
-           phantom_camera_2d_sprite.png.import
-           player_sprite.svg
-           player_sprite.svg.import
-           sign_prompt.png
-           sign_prompt.png.import
-           checker_pattern_dark.png
-           checker_pattern_dark.png.import
-           target.png
-           target.png.import
-         ui_inventory.tscn
-         ui_sign.tscn
-       Nunito-Black.ttf
-       Nunito-Black.ttf.import
-       Nunito-Regular.ttf
-       Nunito-Regular.ttf.import
+       [misc]
+       [viewfinder]
-       phantom_camera_2d.svg
-       phantom_camera_2d.svg.import
-       phantom_camera_3d.svg
-       phantom_camera_3d.svg.import
-       phantom_camera_camera_3d_resource.svg
-       phantom_camera_camera_3d_resource.svg.import
-       phantom_camera_gizmo.svg
-       phantom_camera_gizmo.svg.import
-       phantom_camera_glow_logo.png
-       phantom_camera_glow_logo.png.import
-       phantom_camera_host.svg
-       phantom_camera_host.svg.import
-       phantom_camera_logo.png
-       phantom_camera_logo.png.import
-       phantom_camera_noise_emitter_2d.svg
-       phantom_camera_noise_emitter_2d.svg.import
-       phantom_camera_noise_emitter_3d.svg
-       phantom_camera_noise_emitter_3d.svg.import
-       phantom_camera_noise_emitter_gizmo.svg
-       phantom_camera_noise_emitter_gizmo.svg.import
-       phantom_camera_noise_resource.svg
-       phantom_camera_noise_resource.svg.import
-       phantom_camera_tween.svg
-       phantom_camera_tween.svg.import
-       phantom_camera_tween_director.svg
-       phantom_camera_tween_director.svg.import
-       phantom_camera_tween_director_resource.svg
-       phantom_camera_tween_director_resource.svg.import
-       phantom_camera_updater_panel_icon.svg
-       phantom_camera_updater_panel_icon.svg.import
-       warning.svg
-       warning.svg.import
-         PriorityOverride.svg
-         PriorityOverride.svg.import
-         Camera2DIcon.svg
-         Camera2DIcon.svg.import
-         Camera3DIcon.svg
-         Camera3DIcon.svg.import
-         SceneTypesIcon.svg
-         SceneTypesIcon.svg.import
-         Select.svg
-         Select.svg.import
-       phantom_camera_inspector_plugin.gd
-       phantom_camera_inspector_plugin.gd.uid
+       [updater]
+       [viewfinder]
-       editor.gd.uid
-       editor.tscn
-         download_update_panel.tscn
-         update_button.tscn
+         [host_list]
-         deadzone_style_box.tres
-         viewfinder_panel.tscn
-           host_list.tscn
-           host_list_item.tscn
-           host_list_item_group.tres
+       [gizmos]
+       [managers]
+       [panel]
+       [phantom_camera]
+       [phantom_camera_host]
+       [resources]
-         phantom_camera_3d_gizmo.gd
-         phantom_camera_3d_gizmo.gd.uid
-         phantom_camera_3d_gizmo_plugin.gd
-         phantom_camera_3d_gizmo_plugin.gd.uid
-         phantom_camera_noise_emitter_gizmo_plugin_3d.gd
-         phantom_camera_noise_emitter_gizmo_plugin_3d.gd.uid
-         PhantomCameraManager.cs
-         PhantomCameraManager.cs.uid
-         phantom_camera_manager.gd
-         phantom_camera_manager.gd.uid
+         [updater]
+         [viewfinder]
-         editor.gd
-         editor.gd.uid
-           download_update_panel.gd
-           download_update_panel.gd.uid
-           updater_constants.gd
-           updater_constants.gd.uid
-           update_button.gd
-           update_button.gd.uid
-           host_list.gd
-           host_list.gd.uid
-           host_list_item.gd
-           host_list_item.gd.uid
-           viewfinder.gd
-           viewfinder.gd.uid
-         PhantomCamera.cs
-         PhantomCamera.cs.uid
-         PhantomCamera2D.cs
-         PhantomCamera2D.cs.uid
-         PhantomCamera3D.cs
-         PhantomCamera3D.cs.uid
-         PhantomCameraNoiseEmitter2D.cs
-         PhantomCameraNoiseEmitter2D.cs.uid
-         PhantomCameraNoiseEmitter3D.cs
-         PhantomCameraNoiseEmitter3D.cs.uid
-         PhantomCameraTweenDirector.cs
-         phantom_camera_2d.gd
-         phantom_camera_2d.gd.uid
-         phantom_camera_3d.gd
-         phantom_camera_3d.gd.uid
-         phantom_camera_constants.gd
-         phantom_camera_constants.gd.uid
-         phantom_camera_noise_emitter_2d.gd
-         phantom_camera_noise_emitter_2d.gd.uid
-         phantom_camera_noise_emitter_3d.gd
-         phantom_camera_noise_emitter_3d.gd.uid
-         phantom_camera_tween_director.gd
-         phantom_camera_tween_director.gd.uid
-         PhantomCameraHost.cs
-         PhantomCameraHost.cs.uid
-         phantom_camera_host.gd
-         phantom_camera_host.gd.uid
-         Camera3DResource.cs
-         Camera3DResource.cs.uid
-         camera_3d_resource.gd
-         camera_3d_resource.gd.uid
-         PhantomCameraNoise2D.cs
-         PhantomCameraNoise2D.cs.uid
-         PhantomCameraNoise3D.cs
-         PhantomCameraNoise3D.cs.uid
-         PhantomCameraTween.cs
-         PhantomCameraTween.cs.uid
-         phantom_camera_noise_2d.gd
-         phantom_camera_noise_2d.gd.uid
-         phantom_camera_noise_3d.gd
-         phantom_camera_noise_3d.gd.uid
-         TweenDirectorResource.cs
-         tween_director_resource.gd
-         tween_director_resource.gd.uid
-         tween_resource.gd
-         tween_resource.gd.uid
-       button_focus.tres
-       button_hover.tres
-       button_normal.tres
-       theme.tres
+   [commodities]
-     iron.tres
+   [tests]
-   asteroid.tscn
-   bullet.tscn
-   enemy.tscn
-   main.tscn
-   main.tscn.bak_20260121_212252
-   main.tscn.bak_20260121_215200
-   player.tscn
-   station.tscn
-   ui_hud.tscn
-     test_economy_core.tscn
-     test_galaxy_core.tscn
+   [core]
+   [resources]
+   [tests]
-   asteroid.gd
-   asteroid.gd.uid
-   bullet.gd
-   bullet.gd.uid
-   camera_follow.gd
-   camera_follow.gd.uid
-   enemy.gd
-   enemy.gd.bak_20260122_135040
-   enemy.gd.uid
-   hud.gd
-   hud.gd.uid
-   player.gd
-   player.gd.bak_20260122_134537
-   player.gd.bak_20260122_134610
-   player.gd.bak_20260122_134640
-   player.gd.bak_20260122_135117
-   player.gd.bak_20260122_135146
-   player.gd.uid
-   spawner.gd
-   spawner.gd.uid
-   starfield.gd
-   starfield.gd.uid
-   station.gd
-   station.gd.uid
-     economy_engine.gd
-     economy_engine.gd.uid
-     galaxy_graph.gd
-     galaxy_graph.gd.uid
-     market_profile.gd
-     market_profile.gd.uid
-     sector.gd
-     sector.gd.uid
-     trade_good.gd
-     trade_good.gd.uid
-     test_economy_core.gd
-     test_economy_core.gd.uid
-     test_galaxy_core.gd
-     test_galaxy_core.gd.uid
========================================

=== THIRD PARTY / EXTERNAL INVENTORY (REFERENCED, NOT INLINED) ===
third_party_dirs: addons, third_party, vendor, externals, external
INVENTORY: addons
  file_count: 200
  total_bytes: 1475207
  top_extensions: .uid:46, .gd:34, .import:32, .tscn:30, .svg:20, .cs:13, .tres:11, .png:10, .ttf:2, .cfg:1, .txt:1
========================================

=== INLINE FILE MANIFEST (NON-3RD-PARTY) ===
inline_file_count: 31
===========================================

<<< BEGIN FILE >>>
index: 1
path: _PROJECT_CONTEXT.md
bytes: 16600
sha256: 2074E4D0F4C5103D7C0502D075494796FB0EAC618675130909D95F657A4D1739
<<< CONTENT >>>
# SPACE TRADE EMPIRE - MASTER CONTEXT
# ===================================

## 1. THE FOUNDER PROTOCOL
# ------------------------
# - **Voice:** Pragmatic, Commercial, Technical.
# - **Output:** Direct Code Blocks -> Implementation Steps -> Verification.
# - **Meta-Rule:** If the project structure changes significantly (new systems), you MUST propose an updated version of this file.

## 2. RECOVERY & TOOLCHAIN
# ------------------------
# [DevTools Recovery Block]
#   If `DevTool.ps1` is lost, write a script that:
#   1. Concatenates all .gd/.tscn files into `_FullProjectContext.txt`.
#   2. Wraps `git add/commit` and `git reset --hard` into GUI buttons.

## 3. ARCHITECTURE & STANDARDS (STRICT)
# -------------------------------------
# - **File Org:**
#     - `/scenes`: Visuals & Prefabs.
#     - `/scripts`: Logic.
#     - `/assets`: Raw imports (models, sounds).
# - **Naming:** #     - Nodes: PascalCase (e.g., `ScoreLabel`).
#     - Scripts/Files: snake_case (e.g., `game_manager.gd`).
# - **Design Patterns:**
#     - **Signal Bus (CURRENT):** Use direct signals for now (e.g., Player -> HUD). Add an Autoload bus only when two unrelated systems need it.
#     - **Composition:** Avoid deep inheritance. Use Child Nodes to add features.
# - **Camera Law (ACTIVE)**
#     - Camera is defined in `scenes/player.tscn` at `CameraMount/Camera3D`.
#     - No runtime camera creation in scripts. (`Camera3D.new()` is banned in gameplay code.)
#     - Only `scripts/player.gd` may set `my_camera.current = true`, and only for `CameraMount/Camera3D`.
#     - No other scene may define a gameplay camera without an explicit decision and doc update.
#     - Debug cameras must live in dedicated debug-only scenes (never attached to production nodes).

## 4. CURRENT SPRINT STATUS
# -------------------------
# - **Phase:** MVP Economy Implementation.
# - **Active Task:** Wiring `Asteroid` -> `GameManager` -> `HUD`.
# - **Next Up:** "Infinite Demand" (Spawner System).


## GAME DEFINITION (LOCKED)

### Core Fantasy
You are not the hero pilot.  
You are the logistics backbone of a civilization at war.

Your influence is indirect. You shape outcomes by moving goods, scaling fleets, stabilizing supply chains, and starving enemies of resources.

Combat exists to protect trade. Trade exists to win the war.

---

### Genre
Single-player, long-horizon space trading and fleet management game with light combat and a persistent galactic conflict.

Inspirational reference points: Endless Sky, Starcom  
Structural focus: trading-first, fleet-scale decision making.

---

### Primary Loop (NON-NEGOTIABLE)

1. Scout markets and routes  
2. Acquire goods (mining, purchase, salvage)  
3. Move goods through contested space  
4. Sell or allocate goods to stations and factions  
5. Reinvest profits into ships, fleets, and infrastructure  
6. Repeat at larger scale under increasing pressure

If a mechanic does not reinforce this loop, it is secondary.

---

### Progression Axes

**A. Economic Scale (Primary)**  
- Capital  
- Cargo throughput  
- Market leverage  
- Access to scarce goods and high-impact routes  

**B. Fleet Control (Secondary, Differentiating)**  
- Multiple ship roles: traders, miners, escorts, patrols  
- Delegated behavior: routes, objectives, risk tolerance  
- Loss is possible and meaningful  

**C. Technology (Tertiary)**  
- Unlocks new economic and logistical behaviors  
- Military tech is an enabler, not the end goal  

---

### The War (Framing Constraint)

The war is a systemic pressure, not a narrative RPG.

- Two sides: human civilization vs an aggressive alien force  
- The war advances regardless of player action  
- Player influence is expressed through supply, logistics, and economic stabilization  
- There is no chosen one narrative  

If the player stops trading, the war continues and goes badly.

---

### Run Structure

- Endless, evolving sandbox  
- No hard win or game over state  
- Major inflection points and regional outcomes exist  
- The universe reacts, but does not conclude  

---

### Pressure and Failure

At least two of the following must always apply:

- Escalating external threats (pirates, incursions)  
- Capital risk (ship loss, sunk cost, opportunity loss)  
- Strategic time pressure (markets and war state evolve)  

Fleet management must involve real risk, not just optimization.

---

### Design Invariants

- Trade dominance is the primary source of power  
- Logistics beats tactics  
- Determinism over spectacle  
- Systems over scripts  
- Player agency through scale, not micromanagement  

---

### Explicit Non-Goals

- No realtime multiplayer  
- No live-service mechanics  
- No narrative-heavy branching RPG  
- No crew simulation  
- No high-fidelity physics  
- No tactical fleet combat micromanagement  

## TECHNOLOGY AND STRATEGIC INFLUENCE (LOCKED PRINCIPLES)

### Technology Structure

Technology progression is modeled as a **directed acyclic graph (DAG)**, not a strict tree.

- Each technology node may have **multiple prerequisites**
- Prerequisites may span multiple domains
- Cycles are not allowed
- Unlock logic must be deterministic and testable

The purpose of the graph is to support **multiple viable pathways** to similar capabilities, reflecting different strategic choices rather than linear progression.

---

### Technology Domains

Technology nodes are partitioned into explicit domains:

- **Trade & Logistics** (primary)
- **Fleet Operations**
- **Mining & Extraction**
- **Industry & Manufacturing**
- **Defense & Combat**
- **Intelligence & Espionage**

Domains exist to enforce design constraints, not to silo systems.

---

### Cross-Domain Governance Rules

To prevent uncontrolled graph complexity:

- A technology node may have **at most two cross-domain prerequisites**
- Any **Combat-domain** technology must require at least one prerequisite from:
  - Trade & Logistics, or
  - Fleet Operations
- Trade & Logistics technologies may never require Combat prerequisites

These rules enforce the invariant that **logistics and trade remain foundational**, and combat remains subordinate.

---

### Unlock Vectors

Technology unlocks may be gated by one or more of the following vectors:

1. **Economic Contribution**
   - Credits accumulated
   - Goods delivered
   - Sustained trade volume
2. **Strategic Support**
   - Supplying specific regions or fronts
   - Maintaining logistics under pressure
   - Stabilizing critical systems
3. **Intelligence Actions**
   - Espionage investments
   - Information acquisition
   - Long-horizon, probabilistic outcomes

Unlock conditions may combine vectors, but must be expressible as explicit rules.

---

### Regional and Factional Specialization

Some technologies are **contextually unlocked**:

- Certain regions or factions enable access to specialized technology paths
- Access is earned through sustained logistical or strategic support
- These unlocks reflect **capability transfer**, not allegiance or narrative choice

Technology access may be global once unlocked, or restricted by context, but this must be explicit per node.

---

### Espionage (System Boundary)

Espionage is a **strategic, abstract system**, not a tactical mechanic.

- Player commits resources
- Time passes
- Outcomes are uncertain but bounded
- Results unlock information, technology access, or economic advantages

Espionage does not involve:
- Tactical gameplay
- Character control
- Stealth mechanics

It exists to introduce **risk, delay, and alternative pathways** into the tech graph.

---

### Technology Effects

Technology unlocks grant **capabilities**, not narrative rewards.

Examples of effects:
- New ship behaviors
- New fleet-level automation
- Access to new goods or manufacturing
- Improved routing, sensing, or risk mitigation

Technologies should enable **new economic behaviors**, not simply increase numeric stats.

---

### Design Invariants (Reinforced)

- Technology reinforces trade-first gameplay
- Multiple pathways are always preferred to linear progression
- Player agency comes from strategic choice, not grind
- Systems remain deterministic and testable
- Content is layered atop structure, not baked into it


## INFORMATION FLOW AND PLAYER KNOWLEDGE (LOCKED PRINCIPLES)

### Information as a Strategic Resource

Information is **incomplete, delayed, and unevenly distributed**.

Perfect knowledge is never assumed. Improving information quality is a core axis of progression, on par with ships, fleets, and technology.

The player wins by **making better decisions with imperfect data**, not by reacting instantly.

---

### Baseline Visibility

At any moment, the player has access to:

- Confirmed information about:
  - Their own assets (ships, fleets, cargo, credits)
  - Locations and status of owned fleets
- Partial or delayed information about:
  - Market prices outside visited regions
  - Route safety and threat levels
  - War state beyond nearby fronts

Unvisited or unsupported regions are opaque by default.

---

### Discovery and First Contact

The player ship is the primary tool for **initial information acquisition**.

- New stations, regions, and factions require physical presence to:
  - Reveal market structure
  - Establish trade access
  - Unlock regional information flow
- Fleets cannot operate autonomously in unknown regions until discovery is complete

This preserves player embodiment and makes exploration meaningful.

---

### Information Delay and Uncertainty

Information degrades with distance, time, and lack of infrastructure.

Examples:
- Market prices may be outdated
- Threat assessments may be probabilistic
- Fleet status updates may arrive late

Delays are intentional and legible, not random.

The player should understand:
- What is known
- What is estimated
- What is unknown

---

### Improving Information Quality

Information quality improves through:

- Sustained trade and presence in a region
- Dedicated intelligence or sensor technologies
- Espionage investments
- Infrastructure (relay stations, hubs, etc.)

Higher information quality reduces variance and delay, but never eliminates uncertainty entirely.

---

### Feedback and Causality

Outcomes must be **explainable**, even when uncertain.

When events occur (losses, delays, price shifts), the player should be able to trace them to:
- Known risks
- Incomplete information
- Strategic choices

Surprise is acceptable. Confusion is not.

---

### War State Visibility

The galactic war is visible only in aggregate.

- Frontline movement
- Regional instability
- Supply shortages

The player does not see tactical details, only **logistical consequences**.

This reinforces the fantasy of influencing the war indirectly.

---

### Relationship to Automation

Automation does not grant perfect information.

- Automated fleets operate on available data
- Poor information leads to suboptimal execution
- Better intelligence improves automation outcomes

This prevents automation from becoming a â€œset and forgetâ€ solution.

---

### Design Invariants (Reinforced)

- Information is power
- Uncertainty is intentional and bounded
- Discovery requires presence
- Better data improves decisions, not guarantees outcomes
- The player is never punished for what they could not reasonably know


## WORK ORDERS AND ECONOMIC FLOW (LOCKED PRINCIPLES)

### Work Orders as the Core Abstraction

All non-player-ship activity in the game is expressed through a single abstraction: **Work Orders**.

A Work Order represents an ongoing or time-bound directive assigned to a fleet.  
Fleets do not act independently; they always execute a Work Order.

This abstraction unifies:
- Trade routes
- Contracts
- Mining operations
- Patrol and escort duties
- Special strategic actions

---

### Types of Work Orders

There are three high-level categories of Work Orders:

1. **Route Orders (Persistent)**
   - Player-defined
   - Represent long-term trade or supply infrastructure
   - Execute continuously until modified or cancelled
   - Form the economic backbone of the playerâ€™s power

2. **Contract Orders (Temporary)**
   - Generated by the world in response to economic and war conditions
   - Time-bound and situational
   - Represent shortages, emergencies, opportunities, or strategic needs
   - Optional but consequential if ignored

3. **Special Orders (Strategic)**
   - Unlocked via technology or intelligence
   - Include actions such as reconnaissance, covert delivery, or strategic intervention
   - Often high-risk and high-impact

All orders share the same structural model, differing only in scope, duration, and origin.

---

### Order Definition (Conceptual)

A Work Order defines:

- Objective (deliver, mine, patrol, escort, recon)
- Origin and destination or operating region
- Duration (persistent, fixed-term, one-off)
- Priority and urgency
- Risk tolerance
- Expected outcome (explicit or estimated)

Orders are evaluated continuously against available information and conditions.

---

### Economic Flow and World Reaction

The game world reacts to Work Orders.

- Sustained routes stabilize regions and markets
- Ignored contracts worsen shortages or instability
- War pressure alters the type and urgency of contracts generated
- Player infrastructure influences what opportunities appear

The player does not simply respond to the world; their trade network actively reshapes it.

---

### Player Interaction Model

- Early game: the player personally executes Work Orders via their ship
- Mid game: fleets execute orders under player direction
- Late game: the player orchestrates multiple overlapping orders at scale

Direct player intervention remains possible for discovery, crisis response, and high-leverage actions.

---

### Technology Interaction

Technology expands the Work Order system by:

- Unlocking new order types
- Improving execution efficiency
- Reducing risk and uncertainty
- Enabling larger or more complex orders

Technology does not eliminate decision-making; it increases strategic bandwidth.

---

### Design Invariants (Reinforced)

- All economic activity flows through Work Orders
- Routes represent power; contracts represent pressure
- The world responds systemically, not narratively
- Scale introduces tradeoffs, not automation without consequence
- The playerâ€™s strength is measured by coordination, not micromanagement


## EARLY GAME CONTRACT AND PLAYER AUTHORITY (LOCKED PRINCIPLES)

### Early Game Contract (First 60â€“90 Minutes)

The early game exists to establish **trust, tension, and legibility**.

During this phase:
- The player controls a single ship
- The playable space is limited to a small number of regions
- Markets are fragile, visible, and reactive
- Losses are survivable but instructive

The player must personally:
- Discover new locations
- Make first contact with stations or regions
- Execute initial trades and deliveries
- Observe cause-and-effect between trade actions and world state

The early game is not a tutorial; it is a **proof of agency**.

---

### Transition to Delegation

Delegation is earned, not granted.

- Fleet control unlocks only after the player has personally executed core economic actions
- Early fleets are limited in scope and autonomy
- Automation quality is initially poor and visibly imperfect

This ensures that abstraction feels like progress, not removal of gameplay.

---

### Player Authority and Intervention

The player retains the right to intervene directly, but not universally.

The player may:
- Personally execute or override critical Work Orders
- Intervene in high-risk or high-impact situations
- Act as a discovery and crisis-response asset

The player may not:
- Micromanage routine fleet execution
- Override outcomes after commitments are made
- Eliminate risk through manual control

Authority is **situational and strategic**, not absolute.

---

### Failure Semantics

Failure is informative, not punitive.

- Failed routes create shortages, instability, or opportunity elsewhere
- Ignored contracts escalate pressure rather than ending the game
- Lost fleets alter the strategic landscape but do not invalidate progress

Failure should:
- Reveal new information
- Force adaptation
- Create downstream consequences

Failure should not:
- Hard-lock progress
- Require reloads to remain viable
- Feel arbitrary or opaque

---

### Design Invariants (Reinforced)

- Early play builds intuition, not efficiency
- Delegation is a reward for understanding
- Player presence matters most at points of uncertainty
- Loss reshapes the world instead of ending play



<<< END FILE >>>

<<< BEGIN FILE >>>
index: 2
path: DevTool - Copy.ps1
bytes: 7502
sha256: 722D8AA673A8F6C54081D8840232136D8DCE0DE95CAF4593695C277CF4769776
<<< CONTENT >>>
<#
.SYNOPSIS
    SPACE TRADE EMPIRE - MISSION CONTROL (v4.2)
    Fix: Strict Type Casting for Godot Path to prevent array errors.
#>

Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# --- CONFIGURATION ---
$ProjectRoot = Get-Location
$ContextFile = Join-Path $ProjectRoot "_FullProjectContext.txt"
$TestScene   = "scenes/tests/test_economy_core.tscn"
$ConfigPath  = Join-Path $ProjectRoot "godot_path.cfg"

# --- GUI SETUP ---
$form = New-Object System.Windows.Forms.Form
$form.Text = "STE :: Mission Control v4.2"
$form.Size = New-Object System.Drawing.Size(450, 520)
$form.StartPosition = "CenterScreen"
$form.BackColor = "#1e1e1e"
$form.ForeColor = "#ffffff"

$fontHeader = New-Object System.Drawing.Font("Consolas", 12, [System.Drawing.FontStyle]::Bold)
$fontNormal = New-Object System.Drawing.Font("Segoe UI", 10, [System.Drawing.FontStyle]::Bold)
$fontLog    = New-Object System.Drawing.Font("Consolas", 9)

# --- LOGIC ---

function Log-Output($message) {
    $txtOutput.AppendText("[$((Get-Date).ToString('HH:mm:ss'))] $message`r`n")
    $txtOutput.ScrollToCaret()
}

function Get-GodotExe {
    $exePath = $null

    # 1. Check saved config
    if (Test-Path $ConfigPath) {
        $raw = Get-Content $ConfigPath -Raw
        if ($raw) { $exePath = $raw.Trim() }
    }

    # 2. If valid, return immediately
    if ($exePath -and (Test-Path $exePath)) { 
        return $exePath 
    }

    # 3. If invalid, ask user
    [System.Windows.Forms.MessageBox]::Show("Godot executable not found.`n`nPlease select your godot.exe file.", "Setup Required")
    
    $dlg = New-Object System.Windows.Forms.OpenFileDialog
    $dlg.Title = "SELECT GODOT EXECUTABLE (godot.exe)"
    $dlg.Filter = "Executable|*.exe"
    
    if ($dlg.ShowDialog() -eq "OK") {
        $exePath = $dlg.FileName
        Set-Content -Path $ConfigPath -Value $exePath
        return $exePath
    }
    
    return $null
}

function Run-Tests {
    Log-Output ">>> EXEC: ECONOMY TEST SUITE"
    
    # FORCE STRING CAST (The Fix)
    # We take the last item in case pipeline pollution occurred
    $godotRaw = Get-GodotExe
    $godotExe = @($godotRaw)[-1] 

    if (-not $godotExe -or -not (Test-Path $godotExe)) {
        Log-Output "ERROR: Godot path missing or invalid."
        return
    }

    Log-Output "Target: $godotExe"

    try {
        Log-Output "Running simulation..."
        # Runs Godot in headless mode (-s) or standard, waiting for exit
        $process = Start-Process -FilePath "$godotExe" -ArgumentList "$TestScene" -NoNewWindow -Wait -PassThru
        
        if ($process.ExitCode -eq 0) {
            Log-Output "Cycle Complete. Check Console window."
        } else {
            Log-Output "WARNING: Process exited with code $($process.ExitCode)"
        }
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

function Run-ContextGen {
    Log-Output ">>> EXEC: SMART CONTEXT DUMP"
    try {
        $content = "=== SPACE TRADE EMPIRE PROJECT DUMP ===`n"
        $content += "dump_timestamp: $(Get-Date)`n`n"
        
        $content += "=== LIVE PROJECT STRUCTURE ===`n"
        try {
            $tree = Get-ChildItem -Path $ProjectRoot -Recurse | 
                Where-Object { $_.FullName -notmatch "\\.godot|\\.git|\\.import" } |
                ForEach-Object { 
                    $rel = $_.FullName.Replace($ProjectRoot.Path, "")
                    $indent = "  " * ($rel.Split('\').Count - 1)
                    if ($_.PSIsContainer) { "+ $indent[$($_.Name)]" } else { "- $indent$($_.Name)" }
                }
            $content += $tree
        } catch {}
        $content += "`n================================`n"

        $files = Get-ChildItem -Path $ProjectRoot -Recurse -Include *.gd, *.tscn, *.shader, *.ps1 | 
                 Where-Object { $_.FullName -notmatch ".git" -and $_.FullName -notmatch ".import" }

        foreach ($file in $files) {
            $relPath = $file.FullName.Replace($ProjectRoot.Path, "")
            $content += "`n--- FILE: $relPath ---`n"
            $content += "---------------------------------`n"
            $content += Get-Content $file.FullName -Raw
            $content += "`n"
        }
        
        Set-Content -Path $ContextFile -Value $content -Encoding UTF8
        Log-Output "SUCCESS: Context refreshed."
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

function Run-GitSave {
    Log-Output ">>> EXEC: GIT SNAPSHOT"
    git add .
    $res = git commit -m "Manual Save Point $(Get-Date)" 2>&1
    Log-Output $res
    Log-Output "State Saved."
}

function Run-GitReset {
    $confirm = [System.Windows.Forms.MessageBox]::Show("NUKE IT? This reverts to the last SAVE.", "DANGER ZONE", [System.Windows.Forms.MessageBoxButtons]::YesNo, [System.Windows.Forms.MessageBoxIcon]::Warning)
    if ($confirm -eq "Yes") {
        Log-Output ">>> EXEC: HARD RESET"
        git reset --hard 2>&1 | Out-Null
        git clean -fd 2>&1 | Out-Null
        Log-Output "SUCCESS: Time machine activated. Changes reverted."
    }
}

# --- UI COMPONENTS ---

# Header
$lblHeader = New-Object System.Windows.Forms.Label
$lblHeader.Text = "COMMAND DECK"
$lblHeader.Location = New-Object System.Drawing.Point(20, 10)
$lblHeader.Font = $fontHeader
$lblHeader.AutoSize = $true
$form.Controls.Add($lblHeader)

# 1. TEST (Blue)
$btnTest = New-Object System.Windows.Forms.Button
$btnTest.Text = "1. RUN UNIT TESTS"
$btnTest.Location = New-Object System.Drawing.Point(20, 40)
$btnTest.Size = New-Object System.Drawing.Size(400, 45)
$btnTest.Font = $fontNormal
$btnTest.BackColor = "#007acc"
$btnTest.ForeColor = "White"
$btnTest.FlatStyle = "Flat"
$btnTest.Add_Click({ Run-Tests })
$form.Controls.Add($btnTest)

# 2. DUMP (Gray)
$btnContext = New-Object System.Windows.Forms.Button
$btnContext.Text = "2. GENERATE CONTEXT"
$btnContext.Location = New-Object System.Drawing.Point(20, 95)
$btnContext.Size = New-Object System.Drawing.Size(400, 45)
$btnContext.Font = $fontNormal
$btnContext.BackColor = "#2d2d30"
$btnContext.ForeColor = "White"
$btnContext.FlatStyle = "Flat"
$btnContext.Add_Click({ Run-ContextGen })
$form.Controls.Add($btnContext)

# 3. SAVE (Green)
$btnSave = New-Object System.Windows.Forms.Button
$btnSave.Location = New-Object System.Drawing.Point(20, 150)
$btnSave.Size = New-Object System.Drawing.Size(195, 45)
$btnSave.Text = "3. SAVE STATE"
$btnSave.BackColor = "#228822"
$btnSave.ForeColor = "White"
$btnSave.Font = $fontNormal
$btnSave.FlatStyle = "Flat"
$btnSave.Add_Click({ Run-GitSave })
$form.Controls.Add($btnSave)

# 4. RESET (Red)
$btnUndo = New-Object System.Windows.Forms.Button
$btnUndo.Location = New-Object System.Drawing.Point(225, 150)
$btnUndo.Size = New-Object System.Drawing.Size(195, 45)
$btnUndo.Text = "4. HARD RESET"
$btnUndo.BackColor = "#cc2222"
$btnUndo.ForeColor = "White"
$btnUndo.Font = $fontNormal
$btnUndo.FlatStyle = "Flat"
$btnUndo.Add_Click({ Run-GitReset })
$form.Controls.Add($btnUndo)

# Console Output
$txtOutput = New-Object System.Windows.Forms.TextBox
$txtOutput.Location = New-Object System.Drawing.Point(20, 210)
$txtOutput.Size = New-Object System.Drawing.Size(400, 250)
$txtOutput.Multiline = $true
$txtOutput.ScrollBars = "Vertical"
$txtOutput.BackColor = "#000000"
$txtOutput.ForeColor = "#00ff00"
$txtOutput.Font = $fontLog
$txtOutput.Text = "Mission Control v4.2 Online...`r`n"
$form.Controls.Add($txtOutput)

# --- LAUNCH ---
$form.Add_Shown({ $form.Activate() })
[void] $form.ShowDialog()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 3
path: DevTool.ps1
bytes: 18195
sha256: D4DC9883D9DCB9DCA17C3F70B08531EB164B5D981766412172F135461A101652
<<< CONTENT >>>
<#
SPACE TRADE EMPIRE - MISSION CONTROL (v5.0)

What changed vs v4.2
- Keeps all existing buttons + behavior (tests, save, reset, GUI)
- Context dump now:
  - Inlines first-party: .gd .tscn .shader .ps1 project.godot export_presets.cfg .tres .res .cfg .ini .md .txt .json .csv .yml .yaml
  - References 3rd party dirs (inventory + appears in tree) but does NOT inline their contents
  - Adds per-file bytes + SHA256 + deterministic ordering
  - Adds omitted/errors lists + END OF DUMP marker
  - Excludes editor/system junk: .git .import .godot
  - Excludes the dump file itself from being re-inlined
- Adds strong provenance: script path + script hash written into the dump header

How to install correctly (do this exactly)
1) Save THIS file as: C:\Users\marsh\Documents\Space Trade Empire\DevTool.ps1
2) In PowerShell, verify it is v5.0:
   Select-String -Path .\DevTool.ps1 -Pattern "v4\.2","v5\.0" | ft LineNumber,Line -AutoSize
   (should show v5.0, nothing for v4.2)
3) Run it:
   powershell.exe -NoProfile -ExecutionPolicy Bypass -File .\DevTool.ps1

If you still see v4.2 after that, you did not overwrite the right file.
#>

Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# --- CONFIGURATION ---
$ProjectRoot = Get-Location
$ContextFile = Join-Path $ProjectRoot "_FullProjectContext.txt"
$TestScene   = "scenes/tests/test_economy_core.tscn"
$ConfigPath  = Join-Path $ProjectRoot "godot_path.cfg"
$DevToolVersion = "5.0"

# --- GUI SETUP ---
$form = New-Object System.Windows.Forms.Form
$form.Text = "STE :: Mission Control v$DevToolVersion"
$form.Size = New-Object System.Drawing.Size(450, 520)
$form.StartPosition = "CenterScreen"
$form.BackColor = "#1e1e1e"
$form.ForeColor = "#ffffff"

$fontHeader = New-Object System.Drawing.Font("Consolas", 12, [System.Drawing.FontStyle]::Bold)
$fontNormal = New-Object System.Drawing.Font("Segoe UI", 10, [System.Drawing.FontStyle]::Bold)
$fontLog    = New-Object System.Drawing.Font("Consolas", 9)

# Console Output (declared early so Log-Output can be used anywhere)
$txtOutput = New-Object System.Windows.Forms.TextBox
$txtOutput.Location = New-Object System.Drawing.Point(20, 210)
$txtOutput.Size = New-Object System.Drawing.Size(400, 250)
$txtOutput.Multiline = $true
$txtOutput.ScrollBars = "Vertical"
$txtOutput.BackColor = "#000000"
$txtOutput.ForeColor = "#00ff00"
$txtOutput.Font = $fontLog
$txtOutput.Text = "Mission Control v$DevToolVersion Online...`r`n"
$form.Controls.Add($txtOutput)

function Log-Output($message) {
    $txtOutput.AppendText("[$((Get-Date).ToString('HH:mm:ss'))] $message`r`n")
    $txtOutput.ScrollToCaret()
}

function Get-GodotExe {
    $exePath = $null

    if (Test-Path $ConfigPath) {
        $raw = Get-Content $ConfigPath -Raw
        if ($raw) { $exePath = $raw.Trim() }
    }

    if ($exePath -and (Test-Path $exePath)) {
        return $exePath
    }

    [System.Windows.Forms.MessageBox]::Show("Godot executable not found.`n`nPlease select your godot.exe file.", "Setup Required")

    $dlg = New-Object System.Windows.Forms.OpenFileDialog
    $dlg.Title = "SELECT GODOT EXECUTABLE (godot.exe)"
    $dlg.Filter = "Executable|*.exe"

    if ($dlg.ShowDialog() -eq "OK") {
        $exePath = $dlg.FileName
        Set-Content -Path $ConfigPath -Value $exePath
        return $exePath
    }

    return $null
}

function Run-Tests {
    Log-Output ">>> EXEC: ECONOMY TEST SUITE"

    $godotRaw = Get-GodotExe
    $godotExe = @($godotRaw)[-1]

    if (-not $godotExe -or -not (Test-Path $godotExe)) {
        Log-Output "ERROR: Godot path missing or invalid."
        return
    }

    Log-Output "Target: $godotExe"

    try {
        Log-Output "Running simulation..."
        $process = Start-Process -FilePath "$godotExe" -ArgumentList "$TestScene" -NoNewWindow -Wait -PassThru

        if ($process.ExitCode -eq 0) {
            Log-Output "Cycle Complete. Check Console window."
        } else {
            Log-Output "WARNING: Process exited with code $($process.ExitCode)"
        }
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

# ----------------------------
# CONTEXT DUMP HELPERS
# ----------------------------

function Normalize-RelPath([string]$fullPath) {
    $rp = $fullPath.Replace($ProjectRoot.Path, "")
    $rp = $rp.TrimStart("\","/")
    return $rp -replace "/", "\"
}

function Is-UnderAnyDir([string]$fullPath, [string[]]$dirNames) {
    foreach ($d in $dirNames) {
        if ($fullPath -match [regex]::Escape("\$d\") -or $fullPath.EndsWith("\$d")) { return $true }
        if ($fullPath -match [regex]::Escape("/$d/") -or $fullPath.EndsWith("/$d")) { return $true }
    }
    return $false
}

function Get-Sha256([string]$path) {
    try {
        return (Get-FileHash -Algorithm SHA256 -Path $path).Hash
    } catch {
        return "HASH_ERROR"
    }
}

function Try-ReadText([string]$path) {
    try {
        return Get-Content -Path $path -Raw -ErrorAction Stop
    } catch {
        return $null
    }
}

function Build-TreeListing([string]$rootPath, [string[]]$treeExclusionRegex) {
    $lines = New-Object System.Collections.Generic.List[string]
    try {
        $items = Get-ChildItem -Path $rootPath -Recurse -Force -ErrorAction Stop
        foreach ($it in $items) {
            $full = $it.FullName
            $excluded = $false
            foreach ($rx in $treeExclusionRegex) {
                if ($full -match $rx) { $excluded = $true; break }
            }
            if ($excluded) { continue }

            $rel = Normalize-RelPath $full
            $depth = ($rel.Split('\').Count - 1)
            $indent = "  " * $depth
            if ($it.PSIsContainer) {
                $lines.Add("+ $indent[$($it.Name)]")
            } else {
                $lines.Add("- $indent$($it.Name)")
            }
        }
    } catch {
        $lines.Add("TREE_ERROR: $($_.Exception.Message)")
    }
    return $lines
}

function Summarize-DirInventory([string]$dirPath, [string]$label, [string[]]$excludeRegexForCounting) {
    $summary = [ordered]@{
        label = $label
        path  = (Normalize-RelPath $dirPath)
        file_count = 0
        total_bytes = 0
        top_extensions = @()
    }

    if (-not (Test-Path $dirPath)) { return $summary }

    $extCount = @{}
    try {
        $files = Get-ChildItem -Path $dirPath -Recurse -File -Force -ErrorAction Stop | Where-Object {
            $ok = $true
            foreach ($rx in $excludeRegexForCounting) {
                if ($_.FullName -match $rx) { $ok = $false; break }
            }
            $ok
        }
        $summary.file_count = $files.Count
        $summary.total_bytes = ($files | Measure-Object -Property Length -Sum).Sum

        foreach ($f in $files) {
            $e = [IO.Path]::GetExtension($f.Name).ToLowerInvariant()
            if (-not $e) { $e = "<none>" }
            if (-not $extCount.ContainsKey($e)) { $extCount[$e] = 0 }
            $extCount[$e]++
        }

        $top = $extCount.GetEnumerator() | Sort-Object -Property Value -Descending | Select-Object -First 12
        $summary.top_extensions = $top | ForEach-Object { "$($_.Key):$($_.Value)" }
    } catch {
        $summary.top_extensions = @("INVENTORY_ERROR:$($_.Exception.Message)")
    }

    return $summary
}

function Run-ContextGen {
    Log-Output ">>> EXEC: FULL CONTEXT DUMP (SCOPED, VERIFIED)"

    # Text extensions we embed
    $IncludeExtensions = @(
        ".gd", ".tscn", ".shader", ".ps1",
        ".godot",
        ".tres", ".res",
        ".cfg", ".ini",
        ".md", ".txt",
        ".json", ".csv", ".tsv",
        ".yml", ".yaml"
    )

    # Always include these if present
    $AlwaysIncludeRel = @(
        "project.godot",
        "export_presets.cfg",
        "_PROJECT_CONTEXT.md"
    )

    # Exclude from embedded text dump (but still referenced in inventory + tree)
    $ThirdPartyDirs = @("addons", "third_party", "vendor", "externals", "external")

    # Exclude from everything (tree + inline + inventory)
    $HardExcludeRegex = @(
        "\\.git\\", "/\.git/",
        "\\.import\\", "/\.import/",
        "\\.godot\\", "/\.godot/"
    )

    # For TREE view, hide only system folders. Keep third party visible.
    $TreeExcludeRegex = $HardExcludeRegex

    # Very high cap to avoid surprising first-party omissions.
    # If you want truly unlimited, set this to [int64]::MaxValue
    $MaxInlineBytes = 50MB

    $errors = New-Object System.Collections.Generic.List[string]
    $omitted = New-Object System.Collections.Generic.List[string]

    try {
        $scriptHash = if ($PSCommandPath -and (Test-Path $PSCommandPath)) { (Get-FileHash -Algorithm SHA256 -Path $PSCommandPath).Hash } else { "UNKNOWN" }

        $header = New-Object System.Text.StringBuilder
        $null = $header.AppendLine("=== SPACE TRADE EMPIRE PROJECT DUMP ===")
        $null = $header.AppendLine("format_version: $DevToolVersion")
        $null = $header.AppendLine("dump_timestamp: $(Get-Date -Format o)")
        $null = $header.AppendLine("project_root: $($ProjectRoot.Path)")
        $null = $header.AppendLine("devtool_path: $PSCommandPath")
        $null = $header.AppendLine("devtool_sha256: $scriptHash")
        $null = $header.AppendLine("max_inline_bytes: $MaxInlineBytes")
        $null = $header.AppendLine()

        # Project tree
        $null = $header.AppendLine("=== LIVE PROJECT STRUCTURE (SYSTEM FOLDERS HIDDEN) ===")
        $treeLines = Build-TreeListing -rootPath $ProjectRoot -treeExclusionRegex $TreeExcludeRegex
        foreach ($line in $treeLines) { $null = $header.AppendLine($line) }
        $null = $header.AppendLine("========================================")
        $null = $header.AppendLine()

        # Third party inventory
        $null = $header.AppendLine("=== THIRD PARTY / EXTERNAL INVENTORY (REFERENCED, NOT INLINED) ===")
        $null = $header.AppendLine("third_party_dirs: " + ($ThirdPartyDirs -join ", "))
        foreach ($d in $ThirdPartyDirs) {
            $p = Join-Path $ProjectRoot $d
            if (Test-Path $p) {
                $inv = Summarize-DirInventory -dirPath $p -label "third_party" -excludeRegexForCounting $HardExcludeRegex
                $null = $header.AppendLine("INVENTORY: $($inv.path)")
                $null = $header.AppendLine("  file_count: $($inv.file_count)")
                $null = $header.AppendLine("  total_bytes: $($inv.total_bytes)")
                $null = $header.AppendLine("  top_extensions: $($inv.top_extensions -join ', ')")
            }
        }
        $null = $header.AppendLine("========================================")
        $null = $header.AppendLine()

        # Discover files
        $allFiles = Get-ChildItem -Path $ProjectRoot -Recurse -File -Force -ErrorAction Stop

        # Always include set
        $alwaysFull = @()
        foreach ($rel in $AlwaysIncludeRel) {
            $fp = Join-Path $ProjectRoot $rel
            if (Test-Path $fp) { $alwaysFull += (Get-Item $fp).FullName }
        }

        $inlineFiles = New-Object System.Collections.Generic.List[System.IO.FileInfo]

        foreach ($f in $allFiles) {
            $full = $f.FullName

            # Exclude system
            $hardExcluded = $false
            foreach ($rx in $HardExcludeRegex) {
                if ($full -match $rx) { $hardExcluded = $true; break }
            }
            if ($hardExcluded) { continue }

            # Never inline the dump itself (avoids self-omission noise)
            if ($full -ieq $ContextFile) { continue }

            # Exclude third party from inline
            if (Is-UnderAnyDir -fullPath $full -dirNames $ThirdPartyDirs) { continue }

            $ext = [IO.Path]::GetExtension($f.Name).ToLowerInvariant()

            if ($alwaysFull -contains $full) {
                $inlineFiles.Add($f)
                continue
            }

            if ($IncludeExtensions -contains $ext) {
                $inlineFiles.Add($f)
            }
        }

        $inlineFilesSorted = $inlineFiles | Sort-Object -Property FullName

        # Build dump
        $sb = New-Object System.Text.StringBuilder
        $null = $sb.Append($header.ToString())

        $null = $sb.AppendLine("=== INLINE FILE MANIFEST (NON-3RD-PARTY) ===")
        $null = $sb.AppendLine("inline_file_count: $($inlineFilesSorted.Count)")
        $null = $sb.AppendLine("===========================================")
        $null = $sb.AppendLine()

        $totalInlineBytes = 0
        $fileIndex = 0

        foreach ($file in $inlineFilesSorted) {
            $fileIndex++
            $relPath = Normalize-RelPath $file.FullName
            $size = $file.Length
            $hash = Get-Sha256 $file.FullName

            $null = $sb.AppendLine("<<< BEGIN FILE >>>")
            $null = $sb.AppendLine("index: $fileIndex")
            $null = $sb.AppendLine("path: $relPath")
            $null = $sb.AppendLine("bytes: $size")
            $null = $sb.AppendLine("sha256: $hash")
            $null = $sb.AppendLine("<<< CONTENT >>>")

            if ($size -gt $MaxInlineBytes) {
                $omitted.Add("OMITTED_TOO_LARGE|$relPath|bytes=$size|sha256=$hash")
                $null = $sb.AppendLine("[OMITTED: file exceeds max_inline_bytes. See OMITTED FILES section.]")
                $null = $sb.AppendLine("<<< END FILE >>>")
                $null = $sb.AppendLine()
                continue
            }

            $text = Try-ReadText $file.FullName
            if ($null -eq $text) {
                $errors.Add("READ_ERROR|$relPath|bytes=$size|sha256=$hash")
                $null = $sb.AppendLine("[ERROR: could not read file as text. See ERRORS section.]")
                $null = $sb.AppendLine("<<< END FILE >>>")
                $null = $sb.AppendLine()
                continue
            }

            $null = $sb.AppendLine($text)
            if (-not $text.EndsWith("`n")) { $null = $sb.AppendLine() }
            $null = $sb.AppendLine("<<< END FILE >>>")
            $null = $sb.AppendLine()

            $totalInlineBytes += $size
        }

        $null = $sb.AppendLine("=== OMITTED FILES (NOT INLINED) ===")
        $null = $sb.AppendLine("omitted_count: $($omitted.Count)")
        foreach ($o in $omitted) { $null = $sb.AppendLine($o) }
        $null = $sb.AppendLine("===================================")
        $null = $sb.AppendLine()

        $null = $sb.AppendLine("=== ERRORS ===")
        $null = $sb.AppendLine("error_count: $($errors.Count)")
        foreach ($e in $errors) { $null = $sb.AppendLine($e) }
        $null = $sb.AppendLine("==============")
        $null = $sb.AppendLine()

        $null = $sb.AppendLine("=== DUMP SUMMARY ===")
        $null = $sb.AppendLine("inline_file_count: $($inlineFilesSorted.Count)")
        $null = $sb.AppendLine("inline_total_bytes: $totalInlineBytes")
        $null = $sb.AppendLine("third_party_dirs_referenced: " + ($ThirdPartyDirs -join ", "))
        $null = $sb.AppendLine("max_inline_bytes: $MaxInlineBytes")
        $null = $sb.AppendLine("====================")
        $null = $sb.AppendLine()
        $null = $sb.AppendLine("=== END OF DUMP ===")

        Set-Content -Path $ContextFile -Value $sb.ToString() -Encoding UTF8 -ErrorAction Stop

        Log-Output "SUCCESS: Context refreshed."
        Log-Output "Inline files: $($inlineFilesSorted.Count) | Inline bytes: $totalInlineBytes | Omitted: $($omitted.Count) | Errors: $($errors.Count)"
        Log-Output "Dump: $ContextFile"
        Log-Output "Script: $PSCommandPath"
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

function Run-GitSave {
    Log-Output ">>> EXEC: GIT SNAPSHOT"
    git add .
    $res = git commit -m "Manual Save Point $(Get-Date)" 2>&1
    Log-Output $res
    Log-Output "State Saved."
}

function Run-GitReset {
    $confirm = [System.Windows.Forms.MessageBox]::Show("NUKE IT? This reverts to the last SAVE.", "DANGER ZONE", [System.Windows.Forms.MessageBoxButtons]::YesNo, [System.Windows.Forms.MessageBoxIcon]::Warning)
    if ($confirm -eq "Yes") {
        Log-Output ">>> EXEC: HARD RESET"
        git reset --hard 2>&1 | Out-Null
        git clean -fd 2>&1 | Out-Null
        Log-Output "SUCCESS: Time machine activated. Changes reverted."
    }
}

# --- UI COMPONENTS ---

$lblHeader = New-Object System.Windows.Forms.Label
$lblHeader.Text = "COMMAND DECK"
$lblHeader.Location = New-Object System.Drawing.Point(20, 10)
$lblHeader.Font = $fontHeader
$lblHeader.AutoSize = $true
$form.Controls.Add($lblHeader)

$btnTest = New-Object System.Windows.Forms.Button
$btnTest.Text = "1. RUN UNIT TESTS"
$btnTest.Location = New-Object System.Drawing.Point(20, 40)
$btnTest.Size = New-Object System.Drawing.Size(400, 45)
$btnTest.Font = $fontNormal
$btnTest.BackColor = "#007acc"
$btnTest.ForeColor = "White"
$btnTest.FlatStyle = "Flat"
$btnTest.Add_Click({ Run-Tests })
$form.Controls.Add($btnTest)

$btnContext = New-Object System.Windows.Forms.Button
$btnContext.Text = "2. GENERATE CONTEXT"
$btnContext.Location = New-Object System.Drawing.Point(20, 95)
$btnContext.Size = New-Object System.Drawing.Size(400, 45)
$btnContext.Font = $fontNormal
$btnContext.BackColor = "#2d2d30"
$btnContext.ForeColor = "White"
$btnContext.FlatStyle = "Flat"
$btnContext.Add_Click({ Run-ContextGen })
$form.Controls.Add($btnContext)

$btnSave = New-Object System.Windows.Forms.Button
$btnSave.Location = New-Object System.Drawing.Point(20, 150)
$btnSave.Size = New-Object System.Drawing.Size(195, 45)
$btnSave.Text = "3. SAVE STATE"
$btnSave.BackColor = "#228822"
$btnSave.ForeColor = "White"
$btnSave.Font = $fontNormal
$btnSave.FlatStyle = "Flat"
$btnSave.Add_Click({ Run-GitSave })
$form.Controls.Add($btnSave)

$btnUndo = New-Object System.Windows.Forms.Button
$btnUndo.Location = New-Object System.Drawing.Point(225, 150)
$btnUndo.Size = New-Object System.Drawing.Size(195, 45)
$btnUndo.Text = "4. HARD RESET"
$btnUndo.BackColor = "#cc2222"
$btnUndo.ForeColor = "White"
$btnUndo.Font = $fontNormal
$btnUndo.FlatStyle = "Flat"
$btnUndo.Add_Click({ Run-GitReset })
$form.Controls.Add($btnUndo)

$form.Add_Shown({
    $form.Activate()
    Log-Output "DevTool path: $PSCommandPath"
})

[void] $form.ShowDialog()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 4
path: godot_path.cfg
bytes: 40
sha256: E260C63C14FB82B4D261960EE192BF1A27598566F46C6CF7564B2AE3AA48D531
<<< CONTENT >>>
C:\Godot\Godot_v4.5.1-stable_win64.exe

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 5
path: project.godot
bytes: 564
sha256: 7A475CFE7104C5993AA3BF112E9EFECA56E3C41EE442ACA35DEF590078E5DCDC
<<< CONTENT >>>
; Engine configuration file.
; It's best edited using the editor UI and not directly,
; since the parameters that go here are not all obvious.
;
; Format:
;   [section] ; section goes between []
;   param=value ; assign values to parameters

config_version=5

[application]

config/name="Space Trade Empire"
run/main_scene="res://scenes/main.tscn"
config/features=PackedStringArray("4.5", "Forward Plus")

[display]

window/size/viewport_width=1920
window/size/viewport_height=1080
window/stretch/mode="canvas_items"

[editor_plugins]

enabled=PackedStringArray()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 6
path: resources\commodities\iron.tres
bytes: 313
sha256: 1FDFEAC3F509FCDF42B22C5FE3A57EB3FB603952B2CAB4C0E75A58C94CA2F593
<<< CONTENT >>>
[gd_resource type="Resource" script_class="TradeGood" load_steps=2 format=3 uid="uid://tg_iron_001"]

[ext_resource type="Script" path="res://scripts/resources/trade_good.gd" id="1_tg"]

[resource]
script = ExtResource("1_tg")
id = "ore_iron"
name = "Iron Ore"
base_price = 45
volume = 0.5
is_contraband = false

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 7
path: scenes\asteroid.tscn
bytes: 820
sha256: 7497CB978E11CFE2F4EAECBE445546975CEA6EA1F2FD8186A4D44BA6D4444ED1
<<< CONTENT >>>
[gd_scene load_steps=5 format=3 uid="uid://asteroid_base_01"]

[ext_resource type="Script" path="res://scripts/asteroid.gd" id="1_rock"]

[sub_resource type="SphereShape3D" id="SphereShape3D_rock"]
radius = 2.0

[sub_resource type="SphereMesh" id="SphereMesh_rock"]
radius = 2.0
height = 4.0

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_grey"]
albedo_color = Color(0.4, 0.4, 0.4, 1)

[node name="Asteroid" type="StaticBody3D" groups=["Destructible"]]
collision_layer = 2
collision_mask = 0
script = ExtResource("1_rock")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("SphereShape3D_rock")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("SphereMesh_rock")
surface_material_override/0 = SubResource("StandardMaterial3D_grey")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 8
path: scenes\bullet.tscn
bytes: 807
sha256: 833770F44501088845389E358440EF4FBE0327B000D49427AF1B6D64503FA8B9
<<< CONTENT >>>
[gd_scene load_steps=5 format=3 uid="uid://projectile_01"]

[ext_resource type="Script" path="res://scripts/bullet.gd" id="1_b"]

[sub_resource type="BoxShape3D" id="BoxShape3D_b"]
size = Vector3(0.2, 0.2, 1.0)

[sub_resource type="BoxMesh" id="BoxMesh_b"]
size = Vector3(0.2, 0.2, 1.0)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_red"]
albedo_color = Color(1, 0, 0, 1)
emission_enabled = true
emission = Color(1, 0, 0, 1)
emission_energy_multiplier = 2.0

[node name="Bullet" type="Area3D"]
script = ExtResource("1_b")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_b")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("BoxMesh_b")
surface_material_override/0 = SubResource("StandardMaterial3D_red")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 9
path: scenes\enemy.tscn
bytes: 1206
sha256: 1915F48856F12284F778562CA2944F59ABE180D2C6F59678846397420C1A7A26
<<< CONTENT >>>
[gd_scene load_steps=7 format=3 uid="uid://enemy_drone_v2"]

[ext_resource type="Script" path="res://scripts/enemy.gd" id="1_ai"]

[sub_resource type="BoxShape3D" id="BoxShape3D_drone"]
size = Vector3(1.5, 1.5, 2.0)

[sub_resource type="PrismMesh" id="PrismMesh_drone"]
size = Vector3(1.5, 1.5, 2.0)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_hostile"]
albedo_color = Color(1, 0, 0, 1)

[sub_resource type="BoxMesh" id="BoxMesh_eye"]
size = Vector3(0.5, 0.5, 0.5)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_black"]
albedo_color = Color(0, 0, 0, 1)

[node name="EnemyDrone" type="CharacterBody3D"]
collision_layer = 2
collision_mask = 3
script = ExtResource("1_ai")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_drone")

[node name="Body" type="MeshInstance3D" parent="."]
mesh = SubResource("PrismMesh_drone")
surface_material_override/0 = SubResource("StandardMaterial3D_hostile")

[node name="CockpitEye" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.2, -1.0)
mesh = SubResource("BoxMesh_eye")
surface_material_override/0 = SubResource("StandardMaterial3D_black")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 10
path: scenes\main.tscn
bytes: 1918
sha256: B5EF3BA53444039DF06DF69257A1915FB5403D9624E0EFE97985E1984B708296
<<< CONTENT >>>
[gd_scene load_steps=9 format=3 uid="uid://b8j24k1n5q2x"]

[ext_resource type="PackedScene" path="res://scenes/player.tscn" id="2_0wfyh"]
[ext_resource type="PackedScene" path="res://scenes/station.tscn" id="3_sugp2"]
[ext_resource type="PackedScene" path="res://scenes/asteroid.tscn" id="4_asteroid"]
[ext_resource type="PackedScene" path="res://scenes/ui_hud.tscn" id="4_jyhfs"]
[ext_resource type="Script" uid="uid://cdth7i21ieed5" path="res://scripts/spawner.gd" id="5_tbgi4"]

[sub_resource type="Environment" id="Environment_blue"]
background_mode = 1
background_color = Color(0, 0, 0.2, 1)
ambient_light_source = 2
ambient_light_color = Color(1, 1, 1, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_floor"]
albedo_color = Color(0.3, 0.3, 0.3, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_floor"]
material = SubResource("StandardMaterial3D_floor")
size = Vector2(100, 100)

[node name="Main" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_blue")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.5, 0.866025, 0, -0.866025, 0.5, 0, 10, 0)
shadow_enabled = true

[node name="ReferenceFloor" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -2, 0)
mesh = SubResource("PlaneMesh_floor")

[node name="Asteroid" parent="." instance=ExtResource("4_asteroid")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -10)

[node name="Player" parent="." instance=ExtResource("2_0wfyh")]

[node name="Station" parent="." instance=ExtResource("3_sugp2")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 8.094528, 0.91242695, -15.825881)

[node name="HUD" parent="." instance=ExtResource("4_jyhfs")]

[node name="Spawner" type="Node3D" parent="."]
script = ExtResource("5_tbgi4")
asteroid_scene = ExtResource("4_asteroid")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 11
path: scenes\player.tscn
bytes: 1014
sha256: 45BDC245C89B9046000818CF1DCA74F8691F81ED7CDCCE9FD58837FC37B3D92E
<<< CONTENT >>>
[gd_scene load_steps=4 format=3 uid="uid://player_asset_01"]

[ext_resource type="Script" path="res://scripts/player.gd" id="1_script"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_hitbox"]
radius = 1.0
height = 2.0

[sub_resource type="CapsuleMesh" id="CapsuleMesh_visual"]
radius = 1.0
height = 2.0

[node name="Player" type="CharacterBody3D"]
collision_layer = 1
collision_mask = 1
script = ExtResource("1_script")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
shape = SubResource("CapsuleShape3D_hitbox")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
mesh = SubResource("CapsuleMesh_visual")

[node name="CameraMount" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.906308, 0.422618, 0, -0.422618, 0.906308, 0, 3, 5)

[node name="Camera3D" type="Camera3D" parent="CameraMount"]

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 12
path: scenes\station.tscn
bytes: 763
sha256: 42AE952D456EF86A598C59B005BF0DCA02ED89BAA835D4D9B32CE3079EF57A4A
<<< CONTENT >>>
[gd_scene load_steps=4 format=3 uid="uid://station_alpha_01"]

[ext_resource type="Script" path="res://scripts/station.gd" id="1_stn"]

[sub_resource type="BoxShape3D" id="BoxShape3D_dock"]
size = Vector3(10, 5, 10)

[sub_resource type="BoxMesh" id="BoxMesh_station"]
size = Vector3(10, 5, 10)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_green"]
transparency = 1
albedo_color = Color(0, 1, 0, 0.3)

[node name="Station" type="Area3D"]
script = ExtResource("1_stn")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_dock")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("BoxMesh_station")
surface_material_override/0 = SubResource("StandardMaterial3D_green")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 13
path: scenes\tests\test_economy_core.tscn
bytes: 218
sha256: 80A54139698AE93EA99B0CA38B7A22C9D962F733F4C246C37401D6DAE83EEBFB
<<< CONTENT >>>
[gd_scene load_steps=2 format=3 uid="uid://test_econ_01"]

[ext_resource type="Script" path="res://scripts/tests/test_economy_core.gd" id="1_test"]

[node name="TestRunner" type="Node"]
script = ExtResource("1_test")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 14
path: scenes\tests\test_galaxy_core.tscn
bytes: 222
sha256: A152414BB595AFCA06622DB308CF17805EB7A4E69DC8937C8A0C43AD871C8992
<<< CONTENT >>>
[gd_scene load_steps=2 format=3 uid="uid://test_gal_01"]

[ext_resource type="Script" path="res://scripts/tests/test_galaxy_core.gd" id="1_testgal"]

[node name="TestGalaxy" type="Node"]
script = ExtResource("1_testgal")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 15
path: scenes\ui_hud.tscn
bytes: 4141
sha256: BC9C06E90AF1851BC1EC1BBBA5A4357F3E68830466793FFDE3AEFBFD0A2F07C6
<<< CONTENT >>>
[gd_scene load_steps=4 format=3 uid="uid://ui_hud_04"]

[ext_resource type="Script" path="res://scripts/hud.gd" id="1_ui"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_green"]
bg_color = Color(0.2, 0.8, 0.2, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_yellow"]
bg_color = Color(0.8, 0.8, 0.2, 1)

[node name="HUD" type="CanvasLayer"]
script = ExtResource("1_ui")

[node name="Control" type="Control" parent="."]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="Panel" type="Panel" parent="Control"]
layout_mode = 0
offset_left = 20.0
offset_top = 20.0
offset_right = 320.0
offset_bottom = 240.0

[node name="VBoxContainer" type="VBoxContainer" parent="Control/Panel"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 15.0
offset_top = 15.0
offset_right = -15.0
offset_bottom = -15.0
grow_horizontal = 2
grow_vertical = 2

[node name="MoneyLabel" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 24
text = "CREDITS: $0"

[node name="HSeparator1" type="HSeparator" parent="Control/Panel/VBoxContainer"]
layout_mode = 2

[node name="LabelHull" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 12
text = "SHIELD INTEGRITY"

[node name="HealthBar" type="ProgressBar" parent="Control/Panel/VBoxContainer"]
custom_minimum_size = Vector2(0, 15)
layout_mode = 2
theme_override_styles/fill = SubResource("StyleBoxFlat_green")
value = 100.0
show_percentage = false

[node name="LabelFuel" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 12
text = "FUEL RESERVES"

[node name="FuelBar" type="ProgressBar" parent="Control/Panel/VBoxContainer"]
custom_minimum_size = Vector2(0, 15)
layout_mode = 2
theme_override_styles/fill = SubResource("StyleBoxFlat_yellow")
value = 100.0
show_percentage = false

[node name="HSeparator2" type="HSeparator" parent="Control/Panel/VBoxContainer"]
layout_mode = 2

[node name="CargoLabel" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
text = "CARGO: Empty"

[node name="ShopPanel" type="Panel" parent="Control"]
visible = false
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -250.0
offset_top = -200.0
offset_right = 250.0
offset_bottom = 200.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="Control/ShopPanel"]
layout_mode = 1
anchors_preset = 10
anchor_right = 1.0
offset_bottom = 40.0
grow_horizontal = 2
theme_override_font_sizes/font_size = 20
text = "COMMODITIES MARKET"
horizontal_alignment = 1
vertical_alignment = 1

[node name="VBoxContainer" type="VBoxContainer" parent="Control/ShopPanel"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 20.0
offset_top = 50.0
offset_right = -20.0
offset_bottom = -20.0
grow_horizontal = 2
grow_vertical = 2

[node name="MarketTicker" type="Label" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
theme_override_colors/font_color = Color(0, 1, 0, 1)
text = "IRON: $50 | GOLD: $100"
horizontal_alignment = 1

[node name="HSeparator3" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2

[node name="BtnSellAll" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
theme_override_colors/font_color = Color(0, 1, 0, 1)
text = "SELL ALL CARGO (AT CURRENT RATES)"

[node name="HSeparator4" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2

[node name="BtnSpeed" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "Upgrade Thrusters ($200)"

[node name="BtnWeapon" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "Upgrade Cooling ($500)"

[node name="HSeparator5" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2

[node name="BtnClose" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "UNDOCK"

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 16
path: scripts\asteroid.gd
bytes: 1466
sha256: 8A04EB65B62533AFF33CFE9A52264548294CB2266395D51D94F22BDE682568D9
<<< CONTENT >>>
extends StaticBody3D

@export var resource_type: String = "ore_iron"
@export var resource_amount: int = 1
@export var health: int = 3

func take_damage(amount: int):
    health -= amount
    print("[TARGET] Asteroid Hit! Health: %s" % health)
    
    # Flash Effect (Optional - just creates a visual pop)
    var mesh = $MeshInstance3D
    if mesh:
        var tween = create_tween()
        tween.tween_property(mesh, "scale", Vector3(1.2, 1.2, 1.2), 0.05)
        tween.tween_property(mesh, "scale", Vector3(1.0, 1.0, 1.0), 0.05)

    if health <= 0:
        explode()

func explode():
    print("[TARGET] Asteroid Destroyed! Yield: %s x%s" % [resource_type, resource_amount])
    
    # Give Loot to Player (Simplification: Auto-collect)
    # In a full game, we would spawn floating items.
    var player = get_tree().get_first_node_in_group("Player")
    if player:
        # Check if player has space (using the API we built earlier)
        # Note: We need to ensure 'add_cargo' exists in player.gd or use direct dict access
        if player.has_method("add_cargo"):
            player.add_cargo(resource_type, resource_amount)
        else:
            # Fallback if add_cargo helper is missing
            if not player.cargo.has(resource_type): player.cargo[resource_type] = 0
            player.cargo[resource_type] += resource_amount
            # Force UI Update
            player._update_ui_state() 
            
    queue_free() # Delete the rock

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 17
path: scripts\bullet.gd
bytes: 950
sha256: 37C292357212BB80E57C33DF52CC1459DC99D848D32014B95A57CF4D4168303D
<<< CONTENT >>>
extends Area3D

# --- PHYSICS CONSTANTS ---
var speed = 60.0
var damage = 1
var lifetime = 2.0
var shooter = null # IFF TAG

func _ready():
    # Layer 1 (World) + Layer 2 (Enemies/Player)
    collision_mask = 1 | 2 
    body_entered.connect(_on_body_entered)
    
    # Failsafe: Die after 2 seconds to prevent memory leaks
    await get_tree().create_timer(lifetime).timeout
    queue_free()

func _physics_process(delta):
    # LAW: Bullets ALWAYS travel Negative Z (Local Forward)
    position -= transform.basis.z * speed * delta

func _on_body_entered(body):
    # LAW: Do not hit the shooter
    if body == shooter: return

    print("IMPACT: %s -> %s" % [shooter.name if shooter else "Unknown", body.name])
    
    if body.has_method("take_damage"):
        body.take_damage(damage)
        queue_free()
    elif body.name != "Player" and body.name != "EnemyDrone":
        # Destroy on static objects (Station, Walls)
        queue_free()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 18
path: scripts\camera_follow.gd
bytes: 864
sha256: 536FAB2A38C25D83E18B29EAFACD38F3E844472D49C81A88BCA7E0382B9800BE
<<< CONTENT >>>
extends Camera3D

# SETTINGS: 40 meters up, 25 meters back
var offset = Vector3(0, 40, 25)
var target_node

func _ready():
	# 1. THE EJECT BUTTON
	# This tells the engine: "Ignore my parent's rotation. Use Global coordinates."
	set_as_top_level(true)
	
	# 2. FIND THE SHIP
	# If we are inside the ship, our parent is the ship.
	var parent = get_parent()
	if parent.name == "Player":
		target_node = parent
	else:
		# If we are neighbors, find it by name
		target_node = parent.get_node_or_null("Player")

	if target_node:
		# Teleport to starting position
		global_position = target_node.global_position + offset
		look_at(target_node.global_position)

func _physics_process(_delta):
	if target_node:
		# 3. CHASE THE SHIP
		# Since we are "Top Level" now, we must manually update our position every frame.
		global_position = target_node.global_position + offset

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 19
path: scripts\core\economy_engine.gd
bytes: 946
sha256: F914951A8C925F1D4B14534016E6E41B7FCF6B3CF16D5AD7AB810ECDC5AE6AE1
<<< CONTENT >>>
extends RefCounted
class_name EconomyEngine

const MINIMUM_PRICE = 1

# Note: 'good' is typed as Resource to prevent headless dependency errors
static func calculate_price(good: Resource, local_supply: int, base_demand: int) -> int:
    # MVP Algorithm: Simple Scarcity
    # We access properties dynamically
    var base = good.get("base_price")
    if base == null:
        base = 10 # Fallback
        
    var scarcity_factor = float(base_demand) / max(1.0, float(local_supply))
    var final_price = int(base * scarcity_factor)
    return max(final_price, MINIMUM_PRICE)

static func can_afford(wallet_balance: int, price_per_unit: int, quantity: int) -> bool:
    return wallet_balance >= (price_per_unit * quantity)

static func has_cargo_space(current_volume: float, max_volume: float, item_volume: float, quantity: int) -> bool:
    var required_space = item_volume * quantity
    return (current_volume + required_space) <= max_volume

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 20
path: scripts\core\galaxy_graph.gd
bytes: 1490
sha256: 6B9ACBA0472711035D0EA2DBFAE9833B6F8034DCDD7BB9141DB5464D86C851DA
<<< CONTENT >>>
extends RefCounted
class_name GalaxyGraph

# The Master Ledger of all stars
var sectors: Dictionary = {} # { "id": Sector }

func add_sector(sec: Resource):
    sectors[sec.id] = sec

func connect_sectors(id_a: String, id_b: String):
    if sectors.has(id_a) and sectors.has(id_b):
        sectors[id_a].connect_to(id_b)
        sectors[id_b].connect_to(id_a) # Bidirectional Jump Gate

# BFS Pathfinding: Returns list of IDs [start, ... , end]
func get_route(start_id: String, end_id: String) -> Array:
    if start_id == end_id: return [start_id]
    
    var queue = []
    var visited = { start_id: true }
    var parents = {} # To reconstruct path
    
    queue.append(start_id)
    
    while queue.size() > 0:
        var current = queue.pop_front()
        
        if current == end_id:
            return _reconstruct_path(parents, start_id, end_id)
            
        var current_sector = sectors.get(current)
        if current_sector:
            for neighbor in current_sector.connected_ids:
                if not visited.has(neighbor):
                    visited[neighbor] = true
                    parents[neighbor] = current
                    queue.append(neighbor)
                    
    return [] # No path found

func _reconstruct_path(parents: Dictionary, start: String, end: String) -> Array:
    var path = []
    var curr = end
    while curr != start:
        path.push_front(curr)
        curr = parents[curr]
    path.push_front(start)
    return path

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 21
path: scripts\enemy.gd
bytes: 1392
sha256: 14C7B3F64274ACC7C0DC14D499043E30B4CFCBAE87869E0E02543B75E1068A8F
<<< CONTENT >>>
extends CharacterBody3D

@export var speed: float = 15.0
@export var health: int = 3
@export var detection_range: float = 100.0
@export var attack_range: float = 30.0 
@export var loot_table: String = "ore_gold"

var target: Node3D = null
var bullet_scene = preload("res://scenes/bullet.tscn")
var can_shoot: bool = true
var cooldown: float = 1.5

func _ready():
	target = get_tree().get_first_node_in_group("Player")
	add_to_group("Hostile")

func _physics_process(_delta):
	if not target: return
	
	var dist = global_position.distance_to(target.global_position)
	
	if dist < detection_range:
		# POINT NEGATIVE Z AT PLAYER
		look_at(target.global_position, Vector3.UP)
		
		if dist > attack_range:
			# Move along -Z (Forward)
			velocity = -transform.basis.z * speed
		else:
			velocity = Vector3.ZERO
			_attempt_fire()
			
		move_and_slide()

func _attempt_fire():
	if can_shoot:
		can_shoot = false
		var b = bullet_scene.instantiate()
		
		# SPAWN IN FRONT (-Z)
		b.position = position - (transform.basis.z * 2.5) 
		b.rotation = rotation
		b.shooter = self
		
		get_parent().add_child(b)
		
		await get_tree().create_timer(cooldown).timeout
		can_shoot = true

func take_damage(amount: int):
	health -= amount
	print("[ENEMY] Integrity: %s" % health)
	if health <= 0: _die()

func _die():
	if target and target.has_method("add_cargo"):
		target.add_cargo(loot_table, 2)
	queue_free()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 22
path: scripts\hud.gd
bytes: 3366
sha256: 3F1E4AA63C640D3151D1D23696C55E80F06211E9B716A6AAB9A679FA1D0A4DE3
<<< CONTENT >>>
extends CanvasLayer

@onready var money_label = $Control/Panel/VBoxContainer/MoneyLabel
@onready var health_bar = $Control/Panel/VBoxContainer/HealthBar
@onready var fuel_bar = $Control/Panel/VBoxContainer/FuelBar
@onready var cargo_label = $Control/Panel/VBoxContainer/CargoLabel

@onready var shop_panel = $Control/ShopPanel
@onready var market_ticker = $Control/ShopPanel/VBoxContainer/MarketTicker
@onready var btn_sell = $Control/ShopPanel/VBoxContainer/BtnSellAll
@onready var btn_speed = $Control/ShopPanel/VBoxContainer/BtnSpeed
@onready var btn_weapon = $Control/ShopPanel/VBoxContainer/BtnWeapon
@onready var btn_close = $Control/ShopPanel/VBoxContainer/BtnClose

var player_ref = null
var current_station = null

func _ready():
    shop_panel.visible = false
    btn_sell.pressed.connect(_on_sell_all)
    btn_speed.pressed.connect(_on_buy_speed)
    btn_weapon.pressed.connect(_on_buy_weapon)
    btn_close.pressed.connect(_on_close_shop)

    _find_player()

func _find_player():
    var player = get_tree().get_first_node_in_group("Player")
    if player:
        player_ref = player
        player.credits_updated.connect(_on_credits_updated)
        player.cargo_updated.connect(_on_cargo_updated)
        player.health_updated.connect(_on_health_updated)
        player.fuel_updated.connect(_on_fuel_updated)
        player.shop_toggled.connect(_on_shop_toggled)
        
        # Init
        _on_credits_updated(player.credits)
        _on_cargo_updated(player.cargo)
        _on_health_updated(player.health, player.max_health)
        _on_fuel_updated(player.fuel, player.max_fuel)
    else:
        await get_tree().create_timer(0.1).timeout
        _find_player()

func _on_credits_updated(amount):
    money_label.text = "CREDITS: $%s" % amount

func _on_health_updated(current, max_val):
    if health_bar:
        health_bar.max_value = max_val
        health_bar.value = current

func _on_fuel_updated(current, max_val):
    if fuel_bar:
        fuel_bar.max_value = max_val
        fuel_bar.value = current

func _on_cargo_updated(manifest):
    var text = "CARGO: "
    if manifest.is_empty():
        text += "Empty"
    else:
        for item in manifest:
            text += "%s(%s) " % [item.replace("ore_", "").capitalize(), manifest[item]]
    cargo_label.text = text

func _on_shop_toggled(is_open, station_ref):
    shop_panel.visible = is_open
    current_station = station_ref
    
    if is_open:
        Input.mouse_mode = Input.MOUSE_MODE_VISIBLE
        _update_ticker()
    else:
        Input.mouse_mode = Input.MOUSE_MODE_CAPTURED

func _update_ticker():
    if not current_station: return
    var p_iron = current_station.get_market_price("ore_iron")
    var p_gold = current_station.get_market_price("ore_gold")
    market_ticker.text = "IRON: $%s | GOLD: $%s" % [p_iron, p_gold]

func _on_sell_all():
    if not player_ref or not current_station: return
    
    var manifest = player_ref.cargo.duplicate()
    for item in manifest:
        current_station.sell_cargo(player_ref, item, manifest[item])
        player_ref.remove_cargo(item, manifest[item])
    
    _update_ticker()

func _on_buy_speed():
    if player_ref: player_ref.purchase_upgrade("speed", 200)

func _on_buy_weapon():
    if player_ref: player_ref.purchase_upgrade("weapon", 500)

func _on_close_shop():
    if player_ref: player_ref.undock()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 23
path: scripts\player.gd
bytes: 4174
sha256: C1ED5AFA3B91CFD02A8BAAF4E6BE79E2CD0C9C5B5288DBF22FD43F9E6BE28D3A
<<< CONTENT >>>
extends CharacterBody3D

# --- CONFIG ---
@export_group("Ship Settings")
@export var speed_max := 25.0
@export var acceleration := 40.0
@export var friction := 15.0
@export var rotation_speed := 5.0
@export var max_health := 10
@export var max_fuel := 1000.0
@export var fuel_burn_rate := 15.0 # Cost to fly

@export_group("Weapon Systems")
@export var weapon_cooldown := 0.25
@export var invert_mesh_fire: bool = true

# --- STATE ---
var health: int = 10
var fuel: float = 1000.0
var credits: int = 100
var cargo: Dictionary = {} 
var cargo_capacity: int = 10
var is_docked: bool = false
var can_shoot : bool = true
var current_station = null

# --- SIGNALS ---
signal credits_updated(amount)
signal cargo_updated(manifest)
signal health_updated(current, max)
signal fuel_updated(current, max) # NEW
signal shop_toggled(is_open, station_ref) # UPDATED

# --- INTERNAL ---
var bullet_scene = preload("res://scenes/bullet.tscn")
var my_camera : Camera3D = null

func _ready():
		add_to_group("Player")
		Input.mouse_mode = Input.MOUSE_MODE_CAPTURED
		health = max_health
		fuel = max_fuel

		# Cam Init (scene camera only)
		my_camera = get_node_or_null("CameraMount/Camera3D")
		if my_camera:
				my_camera.current = true

		await get_tree().process_frame
		_update_ui_state()

func _physics_process(delta):
	if is_docked: return
	
	var input_dir = Input.get_vector("ui_left", "ui_right", "ui_up", "ui_down")
	var direction = Vector3(input_dir.x, 0, input_dir.y).normalized()

	# FUEL LOGIC
	if direction and fuel > 0:
		velocity = velocity.move_toward(direction * speed_max, acceleration * delta)
		
		# Burn Fuel
		fuel -= fuel_burn_rate * delta
		emit_signal("fuel_updated", int(fuel), int(max_fuel))
		
		# Rotation
		var target_rotation = atan2(velocity.x, velocity.z)
		rotation.y = lerp_angle(rotation.y, target_rotation, rotation_speed * delta)
	else:
		# Drift if no input or empty tank
		velocity = velocity.move_toward(Vector3.ZERO, friction * delta)

	move_and_slide()

	if Input.is_action_pressed("ui_accept") and can_shoot:
		shoot()
		
	if my_camera:
		var target_pos = global_position + Vector3(0, 40, 20)
		my_camera.global_position = my_camera.global_position.lerp(target_pos, 5.0 * delta)
		my_camera.look_at(global_position)

func shoot():
	if not bullet_scene: return
	can_shoot = false
	var new_bullet = bullet_scene.instantiate()
	new_bullet.position = position 
	new_bullet.rotation = rotation
	if invert_mesh_fire: new_bullet.rotate_object_local(Vector3.UP, PI)
	new_bullet.position += new_bullet.transform.basis.z * -2.0
	new_bullet.shooter = self
	get_parent().add_child(new_bullet)
	await get_tree().create_timer(weapon_cooldown).timeout
	can_shoot = true

func take_damage(amount: int):
	health -= amount
	emit_signal("health_updated", health, max_health)
	if health <= 0: _die()

func _die():
		print("CRITICAL FAILURE.")
		# Defer scene reload to avoid removing nodes during physics callbacks
		get_tree().call_deferred("reload_current_scene")

func _update_ui_state():
	emit_signal("credits_updated", credits)
	emit_signal("cargo_updated", cargo)
	emit_signal("health_updated", health, max_health)
	emit_signal("fuel_updated", int(fuel), int(max_fuel))

func add_cargo(item_id: String, amount: int):
	if not cargo.has(item_id): cargo[item_id] = 0
	cargo[item_id] += amount
	_update_ui_state()

func remove_cargo(item_id: String, amount: int):
	if cargo.has(item_id):
		cargo[item_id] -= amount
		if cargo[item_id] <= 0: cargo.erase(item_id)
		_update_ui_state()

func receive_payment(amount: int):
	credits += amount
	_update_ui_state()

func dock_at_station(station_node):
	if is_docked: return
	is_docked = true
	current_station = station_node
	velocity = Vector3.ZERO
	emit_signal("shop_toggled", true, current_station)

func undock():
	is_docked = false
	current_station = null
	emit_signal("shop_toggled", false, null)
	position -= transform.basis.z * 5.0
	
func get_fuel_status():
	return fuel
	
# PURCHASE UPGRADE API (Re-added to prevent errors)
func purchase_upgrade(type: String, cost: int):
	if credits >= cost:
		credits -= cost
		match type:
			"speed": speed_max += 5.0
			"weapon": weapon_cooldown *= 0.8
		_update_ui_state()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 24
path: scripts\resources\market_profile.gd
bytes: 261
sha256: 5DA2ADCC012BEE3B0E6B256B3D3B9AF250333C05163EFE1E34C5531CDA08D1E5
<<< CONTENT >>>
extends Resource
class_name MarketProfile

# This defines a Station's economic personality
@export var station_name: String = "Station"
@export var wealth_tier: float = 1.0
@export var trade_goods: Array[TradeGood] = []
# Future: Add supply/demand curves here

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 25
path: scripts\resources\sector.gd
bytes: 379
sha256: 8D6870C504B81B8DA0645080A994010D2B970F32E6EA164146F1560DC663F3D9
<<< CONTENT >>>
extends Resource
class_name Sector

@export var id: String = "sector_id"
@export var name: String = "Sector Name"
@export var coordinates: Vector2 = Vector2.ZERO # For the 2D Map UI later
@export var connected_ids: Array = [] # List of Strings (IDs of neighbors)

func connect_to(other_id: String):
    if not connected_ids.has(other_id):
        connected_ids.append(other_id)

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 26
path: scripts\resources\trade_good.gd
bytes: 233
sha256: 69D9C850B441D229D84AB974E4DB7B985BDF4B95981259D5518020A2773D308D
<<< CONTENT >>>
extends Resource
class_name TradeGood

@export var id: String = "item_id"
@export var name: String = "Item Name"
@export var base_price: int = 10
@export var volume: float = 1.0 # m3 per unit
@export var is_contraband: bool = false

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 27
path: scripts\spawner.gd
bytes: 1323
sha256: B0FE66F1D1FE7A74DBD0AB802BDA8F85F39D811692B9CE294B46B572FDA3DF1F
<<< CONTENT >>>
extends Node3D

@export var asteroid_scene: PackedScene
@export var enemy_scene: PackedScene
@export var field_radius: float = 100.0
@export var asteroid_count: int = 30
@export var threat_level: float = 0.1 # 10% chance

func _ready():
    # Load enemy scene dynamically if not assigned in Inspector
    if not enemy_scene:
        enemy_scene = load("res://scenes/enemy.tscn")
    
    if not asteroid_scene:
        print("ERROR: No Asteroid Scene assigned!")
        return
        
    print("[SYSTEM] GENERATING SECTOR: Threat Level %s" % threat_level)
    _generate_field()

func _generate_field():
    var rng = RandomNumberGenerator.new()
    rng.randomize()
    
    for i in range(asteroid_count):
        var obj = null
        
        # Roll the dice: Enemy or Rock?
        if rng.randf() < threat_level:
            obj = enemy_scene.instantiate()
        else:
            obj = asteroid_scene.instantiate()
        
        # Position Logic
        var x = rng.randf_range(-field_radius, field_radius)
        var z = rng.randf_range(-field_radius, field_radius)
        if abs(x) < 20 and abs(z) < 20: x += 40 # Clear zone
        
        obj.position = Vector3(x, 0, z)
        obj.rotation.y = rng.randf_range(0, 6.28)
        
        add_child(obj)
        
    print("[SYSTEM] SECTOR POPULATED.")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 28
path: scripts\starfield.gd
bytes: 803
sha256: 18DAEC80B0BC93C274C7EFEC032D5AFCD224802062736B21CF6F5C7385CD82B9
<<< CONTENT >>>
extends Node3D

func _ready():
    var rng = RandomNumberGenerator.new()
    # Create 500 stars for density
    for i in range(500):
        var star = MeshInstance3D.new()
        star.mesh = BoxMesh.new()
        star.mesh.size = Vector3(0.8, 0.8, 0.8) # Large enough to see
        
        # Create a glowing material
        var mat = StandardMaterial3D.new()
        mat.shading_mode = BaseMaterial3D.SHADING_MODE_UNSHADED
        mat.albedo_color = Color(1, 1, 1) # Pure White
        star.mesh.material = mat
        
        # Spread them out WIDE
        var x = rng.randf_range(-300, 300)
        var z = rng.randf_range(-300, 300)
        var y = rng.randf_range(-40, -100) # Deep below player
        
        star.position = Vector3(x, y, z)
        add_child(star)

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 29
path: scripts\station.gd
bytes: 2743
sha256: 9C5D859BA39F79277D9CC7D5A9960C2DDB376B48E509A44144EEF0E82B59CDB5
<<< CONTENT >>>
extends Area3D
class_name GameStation

# --- CONFIGURATION ---
@export var market_update_interval: float = 5.0
@export var fuel_cost_per_unit: int = 2

# --- MARKET DATA ---
var base_prices = { "ore_iron": 50, "ore_gold": 100 }
var current_prices = {}
var market_trend = { "ore_iron": 0, "ore_gold": 0 } # -1 Bear, 1 Bull

var timer: float = 0.0

func _ready():
    monitoring = true
    monitorable = true
    body_entered.connect(_on_body_entered)
    
    # Initialize Market
    for item in base_prices:
        current_prices[item] = base_prices[item]
    
    print("[STATION] COMMODITY EXCHANGE OPEN.")

func _process(delta):
    # Update Market every X seconds
    timer += delta
    if timer >= market_update_interval:
        timer = 0.0
        _fluctuate_market()

func _fluctuate_market():
    var rng = RandomNumberGenerator.new()
    rng.randomize()
    
    for item in base_prices:
        # 1. Shift Trend (10% chance)
        if rng.randf() < 0.1:
            market_trend[item] = rng.randi_range(-1, 1)
            
        # 2. Apply Volatility
        var volatility = rng.randf_range(-5, 5) + (market_trend[item] * 2)
        current_prices[item] += int(volatility)
        
        # 3. Safety Clamp (50% to 200% of base)
        var min_p = int(base_prices[item] * 0.5)
        var max_p = int(base_prices[item] * 2.0)
        current_prices[item] = clamp(current_prices[item], min_p, max_p)
    
    print("[MARKET] TICK: %s" % current_prices)

func _on_body_entered(body):
    if body.has_method("dock_at_station"):
        print("!!! DOCKING SEQUENCE INITIATED !!!")
        _refuel_ship(body)
        body.dock_at_station(self)

func _refuel_ship(player):
    if not player.has_method("get_fuel_status"): return
    
    var needed = player.max_fuel - player.fuel
    if needed > 1.0:
        var cost = int(needed * fuel_cost_per_unit)
        if player.credits >= cost:
            player.credits -= cost
            player.fuel = player.max_fuel
            player.receive_payment(0) # Force UI Update
            print("[STATION] FULL TANK: -$%s" % cost)
        else:
            # Partial Fill
            var units = int(player.credits / fuel_cost_per_unit)
            if units > 0:
                player.credits -= (units * fuel_cost_per_unit)
                player.fuel += units
                player.receive_payment(0)
                print("[STATION] PARTIAL FILL: +%s units" % units)

# API
func get_market_price(item_id: String) -> int:
    return current_prices.get(item_id, 0)

func sell_cargo(player, item_id, amount):
    var price = get_market_price(item_id)
    var total = price * amount
    player.receive_payment(total)
    print("[MARKET] SOLD %s x%s @ $%s" % [item_id, amount, price])

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 30
path: scripts\tests\test_economy_core.gd
bytes: 1914
sha256: FA93CC877FAEA8E0E82194F69D180F46807020E6D753A31CCEBA979D72E74A9B
<<< CONTENT >>>
extends Node

# Explicit loads for headless stability
const EconomyEngine = preload("res://scripts/core/economy_engine.gd")
const TradeGood = preload("res://scripts/resources/trade_good.gd")

func _ready():
    print("--- STARTING ECONOMY INTEGRATION TESTS ---")
    run_all_tests()
    print("--- TESTS COMPLETE ---")
    get_tree().quit() # Auto-close on success

func run_all_tests():
    test_affordability_check()
    test_cargo_limits()
    test_price_algorithm()

func test_affordability_check():
    var balance = 1000
    var price = 50
    var can_buy_10 = EconomyEngine.can_afford(balance, price, 10)
    var can_buy_25 = EconomyEngine.can_afford(balance, price, 25)
    _assert(can_buy_10 == true, "Affordability: Should afford 10 items")
    _assert(can_buy_25 == false, "Affordability: Should NOT afford 25 items")

func test_cargo_limits():
    var max_vol = 100.0
    var current_vol = 90.0
    var item_vol = 2.0
    var can_fit_4 = EconomyEngine.has_cargo_space(current_vol, max_vol, item_vol, 4)
    var can_fit_6 = EconomyEngine.has_cargo_space(current_vol, max_vol, item_vol, 6)
    _assert(can_fit_4 == true, "Cargo: Should fit 4 units")
    _assert(can_fit_6 == false, "Cargo: Should NOT fit 6 units")

func test_price_algorithm():
    # Instantiate the Resource manually
    var iron = TradeGood.new()
    iron.base_price = 100
    
    # We pass the object. The Engine treats it as a generic Resource.
    var cheap_price = EconomyEngine.calculate_price(iron, 200, 100)
    var high_price = EconomyEngine.calculate_price(iron, 50, 100)
    
    _assert(cheap_price < 100, "Economics: High supply should lower price (Got: %s)" % cheap_price)
    _assert(high_price > 100, "Economics: Low supply should raise price (Got: %s)" % high_price)

func _assert(condition: bool, message: String):
    if condition:
        print("[PASS] " + message)
    else:
        printerr("[FAIL] " + message)

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 31
path: scripts\tests\test_galaxy_core.gd
bytes: 1442
sha256: 3A5F8309263DA6C6F7B9308BBC4665BF2F6C7E38BF78352FD716971823680668
<<< CONTENT >>>
extends Node

# Explicit Preloads for Headless Stability
const Sector = preload("res://scripts/resources/sector.gd")
const GalaxyGraph = preload("res://scripts/core/galaxy_graph.gd")

func _ready():
    print("--- STARTING GALAXY NAVIGATION TESTS ---")
    run_tests()
    print("--- GALAXY TESTS COMPLETE ---")
    get_tree().quit()

func run_tests():
    # SETUP: Create a Map: A <-> B <-> C
    var graph = GalaxyGraph.new()
    
    var s1 = Sector.new(); s1.id = "A"; graph.add_sector(s1)
    var s2 = Sector.new(); s2.id = "B"; graph.add_sector(s2)
    var s3 = Sector.new(); s3.id = "C"; graph.add_sector(s3)
    
    graph.connect_sectors("A", "B")
    graph.connect_sectors("B", "C")
    
    # TEST 1: Direct Neighbor
    var route_ab = graph.get_route("A", "B")
    _assert(route_ab.size() == 2, "Path A->B should be 2 steps. Got: %s" % str(route_ab))
    
    # TEST 2: Multi-Jump
    var route_ac = graph.get_route("A", "C")
    _assert(route_ac.size() == 3, "Path A->C should be 3 steps (A,B,C). Got: %s" % str(route_ac))
    
    # TEST 3: Invalid Path (Isolated Node)
    var s4 = Sector.new(); s4.id = "D"; graph.add_sector(s4) # D is alone
    var route_ad = graph.get_route("A", "D")
    _assert(route_ad.size() == 0, "Path A->D should be empty. Got: %s" % str(route_ad))

func _assert(condition: bool, message: String):
    if condition:
        print("[PASS] " + message)
    else:
        printerr("[FAIL] " + message)

<<< END FILE >>>

=== OMITTED FILES (NOT INLINED) ===
omitted_count: 0
===================================

=== ERRORS ===
error_count: 0
==============

=== DUMP SUMMARY ===
inline_file_count: 31
inline_total_bytes: 78069
third_party_dirs_referenced: addons, third_party, vendor, externals, external
max_inline_bytes: 52428800
====================

=== END OF DUMP ===


<<< END FILE >>>

<<< BEGIN FILE >>>
index: 2
path: _PROJECT_CONTEXT.md
bytes: 2467
sha256: D54B50F35A67B58B9BB1E04AE8B796903F55C1C7DEE3FAE07A44F6E7AA4D99C1
<<< CONTENT >>>
# SPACE TRADE EMPIRE - MASTER CONTEXT
# ===================================

## 1. THE FOUNDER PROTOCOL
# ------------------------
# - **Voice:** Pragmatic, Commercial, Technical.
# - **Output:** Direct Code Blocks -> Implementation Steps -> Verification.
# - **Meta-Rule:** If the project structure changes significantly (new systems), you MUST propose an updated version of this file.

## 2. RECOVERY & TOOLCHAIN
# ------------------------
# [DevTools Recovery Block]
#   If `DevTool.ps1` is lost, write a script that:
#   1. Concatenates all .gd/.tscn files into `_FullProjectContext.txt`.
#   2. Wraps `git add/commit` and `git reset --hard` into GUI buttons.
#
# [PhantomCamera Status]
#   The `addons/phantom_camera` folder may exist on disk, but it is not enabled as a plugin and no autoload is configured.
#   Do not use PhantomCamera unless we explicitly choose it and update this document.
## 3. ARCHITECTURE & STANDARDS (STRICT)
# -------------------------------------
# - **File Org:**
#     - `/scenes`: Visuals & Prefabs.
#     - `/scripts`: Logic.
#     - `/assets`: Raw imports (models, sounds).
# - **Naming:** #     - Nodes: PascalCase (e.g., `ScoreLabel`).
#     - Scripts/Files: snake_case (e.g., `game_manager.gd`).
# - **Design Patterns:**
#     - **Signal Bus (CURRENT):** Use direct signals for now (e.g., Player -> HUD). Add an Autoload bus only when two unrelated systems need it.
#     - **Composition:** Avoid deep inheritance. Use Child Nodes to add features.
# - **Camera Law (ACTIVE)**
#     - Camera is defined in `scenes/player.tscn` at `CameraMount/Camera3D`.
#     - No runtime camera creation in scripts. (`Camera3D.new()` is banned in gameplay code.)
#     - Only `scripts/player.gd` may set `my_camera.current = true`, and only for `CameraMount/Camera3D`.
#     - No other scene may define a gameplay camera without an explicit decision and doc update.
#     - Debug cameras must live in dedicated debug-only scenes (never attached to production nodes).

## 4. CURRENT SPRINT STATUS
# -------------------------
# - **Phase:** Phase 0 Cleanup (truth alignment + hygiene)
# - **Done:**
#     - Player camera is scene-defined at `scenes/player.tscn` -> `CameraMount/Camera3D`.
#     - No runtime camera spawning in gameplay scripts.
#     - PhantomCamera plugin and autoload are disabled in `project.godot` (addon may exist on disk).
# - **Next (Phase 1):** Economy spine unification and 2-station arbitrage loop (buy, haul, sell).

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 3
path: DevTool - Copy.ps1
bytes: 7502
sha256: 722D8AA673A8F6C54081D8840232136D8DCE0DE95CAF4593695C277CF4769776
<<< CONTENT >>>
<#
.SYNOPSIS
    SPACE TRADE EMPIRE - MISSION CONTROL (v4.2)
    Fix: Strict Type Casting for Godot Path to prevent array errors.
#>

Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# --- CONFIGURATION ---
$ProjectRoot = Get-Location
$ContextFile = Join-Path $ProjectRoot "_FullProjectContext.txt"
$TestScene   = "scenes/tests/test_economy_core.tscn"
$ConfigPath  = Join-Path $ProjectRoot "godot_path.cfg"

# --- GUI SETUP ---
$form = New-Object System.Windows.Forms.Form
$form.Text = "STE :: Mission Control v4.2"
$form.Size = New-Object System.Drawing.Size(450, 520)
$form.StartPosition = "CenterScreen"
$form.BackColor = "#1e1e1e"
$form.ForeColor = "#ffffff"

$fontHeader = New-Object System.Drawing.Font("Consolas", 12, [System.Drawing.FontStyle]::Bold)
$fontNormal = New-Object System.Drawing.Font("Segoe UI", 10, [System.Drawing.FontStyle]::Bold)
$fontLog    = New-Object System.Drawing.Font("Consolas", 9)

# --- LOGIC ---

function Log-Output($message) {
    $txtOutput.AppendText("[$((Get-Date).ToString('HH:mm:ss'))] $message`r`n")
    $txtOutput.ScrollToCaret()
}

function Get-GodotExe {
    $exePath = $null

    # 1. Check saved config
    if (Test-Path $ConfigPath) {
        $raw = Get-Content $ConfigPath -Raw
        if ($raw) { $exePath = $raw.Trim() }
    }

    # 2. If valid, return immediately
    if ($exePath -and (Test-Path $exePath)) { 
        return $exePath 
    }

    # 3. If invalid, ask user
    [System.Windows.Forms.MessageBox]::Show("Godot executable not found.`n`nPlease select your godot.exe file.", "Setup Required")
    
    $dlg = New-Object System.Windows.Forms.OpenFileDialog
    $dlg.Title = "SELECT GODOT EXECUTABLE (godot.exe)"
    $dlg.Filter = "Executable|*.exe"
    
    if ($dlg.ShowDialog() -eq "OK") {
        $exePath = $dlg.FileName
        Set-Content -Path $ConfigPath -Value $exePath
        return $exePath
    }
    
    return $null
}

function Run-Tests {
    Log-Output ">>> EXEC: ECONOMY TEST SUITE"
    
    # FORCE STRING CAST (The Fix)
    # We take the last item in case pipeline pollution occurred
    $godotRaw = Get-GodotExe
    $godotExe = @($godotRaw)[-1] 

    if (-not $godotExe -or -not (Test-Path $godotExe)) {
        Log-Output "ERROR: Godot path missing or invalid."
        return
    }

    Log-Output "Target: $godotExe"

    try {
        Log-Output "Running simulation..."
        # Runs Godot in headless mode (-s) or standard, waiting for exit
        $process = Start-Process -FilePath "$godotExe" -ArgumentList "$TestScene" -NoNewWindow -Wait -PassThru
        
        if ($process.ExitCode -eq 0) {
            Log-Output "Cycle Complete. Check Console window."
        } else {
            Log-Output "WARNING: Process exited with code $($process.ExitCode)"
        }
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

function Run-ContextGen {
    Log-Output ">>> EXEC: SMART CONTEXT DUMP"
    try {
        $content = "=== SPACE TRADE EMPIRE PROJECT DUMP ===`n"
        $content += "dump_timestamp: $(Get-Date)`n`n"
        
        $content += "=== LIVE PROJECT STRUCTURE ===`n"
        try {
            $tree = Get-ChildItem -Path $ProjectRoot -Recurse | 
                Where-Object { $_.FullName -notmatch "\\.godot|\\.git|\\.import" } |
                ForEach-Object { 
                    $rel = $_.FullName.Replace($ProjectRoot.Path, "")
                    $indent = "  " * ($rel.Split('\').Count - 1)
                    if ($_.PSIsContainer) { "+ $indent[$($_.Name)]" } else { "- $indent$($_.Name)" }
                }
            $content += $tree
        } catch {}
        $content += "`n================================`n"

        $files = Get-ChildItem -Path $ProjectRoot -Recurse -Include *.gd, *.tscn, *.shader, *.ps1 | 
                 Where-Object { $_.FullName -notmatch ".git" -and $_.FullName -notmatch ".import" }

        foreach ($file in $files) {
            $relPath = $file.FullName.Replace($ProjectRoot.Path, "")
            $content += "`n--- FILE: $relPath ---`n"
            $content += "---------------------------------`n"
            $content += Get-Content $file.FullName -Raw
            $content += "`n"
        }
        
        Set-Content -Path $ContextFile -Value $content -Encoding UTF8
        Log-Output "SUCCESS: Context refreshed."
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

function Run-GitSave {
    Log-Output ">>> EXEC: GIT SNAPSHOT"
    git add .
    $res = git commit -m "Manual Save Point $(Get-Date)" 2>&1
    Log-Output $res
    Log-Output "State Saved."
}

function Run-GitReset {
    $confirm = [System.Windows.Forms.MessageBox]::Show("NUKE IT? This reverts to the last SAVE.", "DANGER ZONE", [System.Windows.Forms.MessageBoxButtons]::YesNo, [System.Windows.Forms.MessageBoxIcon]::Warning)
    if ($confirm -eq "Yes") {
        Log-Output ">>> EXEC: HARD RESET"
        git reset --hard 2>&1 | Out-Null
        git clean -fd 2>&1 | Out-Null
        Log-Output "SUCCESS: Time machine activated. Changes reverted."
    }
}

# --- UI COMPONENTS ---

# Header
$lblHeader = New-Object System.Windows.Forms.Label
$lblHeader.Text = "COMMAND DECK"
$lblHeader.Location = New-Object System.Drawing.Point(20, 10)
$lblHeader.Font = $fontHeader
$lblHeader.AutoSize = $true
$form.Controls.Add($lblHeader)

# 1. TEST (Blue)
$btnTest = New-Object System.Windows.Forms.Button
$btnTest.Text = "1. RUN UNIT TESTS"
$btnTest.Location = New-Object System.Drawing.Point(20, 40)
$btnTest.Size = New-Object System.Drawing.Size(400, 45)
$btnTest.Font = $fontNormal
$btnTest.BackColor = "#007acc"
$btnTest.ForeColor = "White"
$btnTest.FlatStyle = "Flat"
$btnTest.Add_Click({ Run-Tests })
$form.Controls.Add($btnTest)

# 2. DUMP (Gray)
$btnContext = New-Object System.Windows.Forms.Button
$btnContext.Text = "2. GENERATE CONTEXT"
$btnContext.Location = New-Object System.Drawing.Point(20, 95)
$btnContext.Size = New-Object System.Drawing.Size(400, 45)
$btnContext.Font = $fontNormal
$btnContext.BackColor = "#2d2d30"
$btnContext.ForeColor = "White"
$btnContext.FlatStyle = "Flat"
$btnContext.Add_Click({ Run-ContextGen })
$form.Controls.Add($btnContext)

# 3. SAVE (Green)
$btnSave = New-Object System.Windows.Forms.Button
$btnSave.Location = New-Object System.Drawing.Point(20, 150)
$btnSave.Size = New-Object System.Drawing.Size(195, 45)
$btnSave.Text = "3. SAVE STATE"
$btnSave.BackColor = "#228822"
$btnSave.ForeColor = "White"
$btnSave.Font = $fontNormal
$btnSave.FlatStyle = "Flat"
$btnSave.Add_Click({ Run-GitSave })
$form.Controls.Add($btnSave)

# 4. RESET (Red)
$btnUndo = New-Object System.Windows.Forms.Button
$btnUndo.Location = New-Object System.Drawing.Point(225, 150)
$btnUndo.Size = New-Object System.Drawing.Size(195, 45)
$btnUndo.Text = "4. HARD RESET"
$btnUndo.BackColor = "#cc2222"
$btnUndo.ForeColor = "White"
$btnUndo.Font = $fontNormal
$btnUndo.FlatStyle = "Flat"
$btnUndo.Add_Click({ Run-GitReset })
$form.Controls.Add($btnUndo)

# Console Output
$txtOutput = New-Object System.Windows.Forms.TextBox
$txtOutput.Location = New-Object System.Drawing.Point(20, 210)
$txtOutput.Size = New-Object System.Drawing.Size(400, 250)
$txtOutput.Multiline = $true
$txtOutput.ScrollBars = "Vertical"
$txtOutput.BackColor = "#000000"
$txtOutput.ForeColor = "#00ff00"
$txtOutput.Font = $fontLog
$txtOutput.Text = "Mission Control v4.2 Online...`r`n"
$form.Controls.Add($txtOutput)

# --- LAUNCH ---
$form.Add_Shown({ $form.Activate() })
[void] $form.ShowDialog()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 4
path: DevTool.ps1
bytes: 18195
sha256: D4DC9883D9DCB9DCA17C3F70B08531EB164B5D981766412172F135461A101652
<<< CONTENT >>>
<#
SPACE TRADE EMPIRE - MISSION CONTROL (v5.0)

What changed vs v4.2
- Keeps all existing buttons + behavior (tests, save, reset, GUI)
- Context dump now:
  - Inlines first-party: .gd .tscn .shader .ps1 project.godot export_presets.cfg .tres .res .cfg .ini .md .txt .json .csv .yml .yaml
  - References 3rd party dirs (inventory + appears in tree) but does NOT inline their contents
  - Adds per-file bytes + SHA256 + deterministic ordering
  - Adds omitted/errors lists + END OF DUMP marker
  - Excludes editor/system junk: .git .import .godot
  - Excludes the dump file itself from being re-inlined
- Adds strong provenance: script path + script hash written into the dump header

How to install correctly (do this exactly)
1) Save THIS file as: C:\Users\marsh\Documents\Space Trade Empire\DevTool.ps1
2) In PowerShell, verify it is v5.0:
   Select-String -Path .\DevTool.ps1 -Pattern "v4\.2","v5\.0" | ft LineNumber,Line -AutoSize
   (should show v5.0, nothing for v4.2)
3) Run it:
   powershell.exe -NoProfile -ExecutionPolicy Bypass -File .\DevTool.ps1

If you still see v4.2 after that, you did not overwrite the right file.
#>

Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# --- CONFIGURATION ---
$ProjectRoot = Get-Location
$ContextFile = Join-Path $ProjectRoot "_FullProjectContext.txt"
$TestScene   = "scenes/tests/test_economy_core.tscn"
$ConfigPath  = Join-Path $ProjectRoot "godot_path.cfg"
$DevToolVersion = "5.0"

# --- GUI SETUP ---
$form = New-Object System.Windows.Forms.Form
$form.Text = "STE :: Mission Control v$DevToolVersion"
$form.Size = New-Object System.Drawing.Size(450, 520)
$form.StartPosition = "CenterScreen"
$form.BackColor = "#1e1e1e"
$form.ForeColor = "#ffffff"

$fontHeader = New-Object System.Drawing.Font("Consolas", 12, [System.Drawing.FontStyle]::Bold)
$fontNormal = New-Object System.Drawing.Font("Segoe UI", 10, [System.Drawing.FontStyle]::Bold)
$fontLog    = New-Object System.Drawing.Font("Consolas", 9)

# Console Output (declared early so Log-Output can be used anywhere)
$txtOutput = New-Object System.Windows.Forms.TextBox
$txtOutput.Location = New-Object System.Drawing.Point(20, 210)
$txtOutput.Size = New-Object System.Drawing.Size(400, 250)
$txtOutput.Multiline = $true
$txtOutput.ScrollBars = "Vertical"
$txtOutput.BackColor = "#000000"
$txtOutput.ForeColor = "#00ff00"
$txtOutput.Font = $fontLog
$txtOutput.Text = "Mission Control v$DevToolVersion Online...`r`n"
$form.Controls.Add($txtOutput)

function Log-Output($message) {
    $txtOutput.AppendText("[$((Get-Date).ToString('HH:mm:ss'))] $message`r`n")
    $txtOutput.ScrollToCaret()
}

function Get-GodotExe {
    $exePath = $null

    if (Test-Path $ConfigPath) {
        $raw = Get-Content $ConfigPath -Raw
        if ($raw) { $exePath = $raw.Trim() }
    }

    if ($exePath -and (Test-Path $exePath)) {
        return $exePath
    }

    [System.Windows.Forms.MessageBox]::Show("Godot executable not found.`n`nPlease select your godot.exe file.", "Setup Required")

    $dlg = New-Object System.Windows.Forms.OpenFileDialog
    $dlg.Title = "SELECT GODOT EXECUTABLE (godot.exe)"
    $dlg.Filter = "Executable|*.exe"

    if ($dlg.ShowDialog() -eq "OK") {
        $exePath = $dlg.FileName
        Set-Content -Path $ConfigPath -Value $exePath
        return $exePath
    }

    return $null
}

function Run-Tests {
    Log-Output ">>> EXEC: ECONOMY TEST SUITE"

    $godotRaw = Get-GodotExe
    $godotExe = @($godotRaw)[-1]

    if (-not $godotExe -or -not (Test-Path $godotExe)) {
        Log-Output "ERROR: Godot path missing or invalid."
        return
    }

    Log-Output "Target: $godotExe"

    try {
        Log-Output "Running simulation..."
        $process = Start-Process -FilePath "$godotExe" -ArgumentList "$TestScene" -NoNewWindow -Wait -PassThru

        if ($process.ExitCode -eq 0) {
            Log-Output "Cycle Complete. Check Console window."
        } else {
            Log-Output "WARNING: Process exited with code $($process.ExitCode)"
        }
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

# ----------------------------
# CONTEXT DUMP HELPERS
# ----------------------------

function Normalize-RelPath([string]$fullPath) {
    $rp = $fullPath.Replace($ProjectRoot.Path, "")
    $rp = $rp.TrimStart("\","/")
    return $rp -replace "/", "\"
}

function Is-UnderAnyDir([string]$fullPath, [string[]]$dirNames) {
    foreach ($d in $dirNames) {
        if ($fullPath -match [regex]::Escape("\$d\") -or $fullPath.EndsWith("\$d")) { return $true }
        if ($fullPath -match [regex]::Escape("/$d/") -or $fullPath.EndsWith("/$d")) { return $true }
    }
    return $false
}

function Get-Sha256([string]$path) {
    try {
        return (Get-FileHash -Algorithm SHA256 -Path $path).Hash
    } catch {
        return "HASH_ERROR"
    }
}

function Try-ReadText([string]$path) {
    try {
        return Get-Content -Path $path -Raw -ErrorAction Stop
    } catch {
        return $null
    }
}

function Build-TreeListing([string]$rootPath, [string[]]$treeExclusionRegex) {
    $lines = New-Object System.Collections.Generic.List[string]
    try {
        $items = Get-ChildItem -Path $rootPath -Recurse -Force -ErrorAction Stop
        foreach ($it in $items) {
            $full = $it.FullName
            $excluded = $false
            foreach ($rx in $treeExclusionRegex) {
                if ($full -match $rx) { $excluded = $true; break }
            }
            if ($excluded) { continue }

            $rel = Normalize-RelPath $full
            $depth = ($rel.Split('\').Count - 1)
            $indent = "  " * $depth
            if ($it.PSIsContainer) {
                $lines.Add("+ $indent[$($it.Name)]")
            } else {
                $lines.Add("- $indent$($it.Name)")
            }
        }
    } catch {
        $lines.Add("TREE_ERROR: $($_.Exception.Message)")
    }
    return $lines
}

function Summarize-DirInventory([string]$dirPath, [string]$label, [string[]]$excludeRegexForCounting) {
    $summary = [ordered]@{
        label = $label
        path  = (Normalize-RelPath $dirPath)
        file_count = 0
        total_bytes = 0
        top_extensions = @()
    }

    if (-not (Test-Path $dirPath)) { return $summary }

    $extCount = @{}
    try {
        $files = Get-ChildItem -Path $dirPath -Recurse -File -Force -ErrorAction Stop | Where-Object {
            $ok = $true
            foreach ($rx in $excludeRegexForCounting) {
                if ($_.FullName -match $rx) { $ok = $false; break }
            }
            $ok
        }
        $summary.file_count = $files.Count
        $summary.total_bytes = ($files | Measure-Object -Property Length -Sum).Sum

        foreach ($f in $files) {
            $e = [IO.Path]::GetExtension($f.Name).ToLowerInvariant()
            if (-not $e) { $e = "<none>" }
            if (-not $extCount.ContainsKey($e)) { $extCount[$e] = 0 }
            $extCount[$e]++
        }

        $top = $extCount.GetEnumerator() | Sort-Object -Property Value -Descending | Select-Object -First 12
        $summary.top_extensions = $top | ForEach-Object { "$($_.Key):$($_.Value)" }
    } catch {
        $summary.top_extensions = @("INVENTORY_ERROR:$($_.Exception.Message)")
    }

    return $summary
}

function Run-ContextGen {
    Log-Output ">>> EXEC: FULL CONTEXT DUMP (SCOPED, VERIFIED)"

    # Text extensions we embed
    $IncludeExtensions = @(
        ".gd", ".tscn", ".shader", ".ps1",
        ".godot",
        ".tres", ".res",
        ".cfg", ".ini",
        ".md", ".txt",
        ".json", ".csv", ".tsv",
        ".yml", ".yaml"
    )

    # Always include these if present
    $AlwaysIncludeRel = @(
        "project.godot",
        "export_presets.cfg",
        "_PROJECT_CONTEXT.md"
    )

    # Exclude from embedded text dump (but still referenced in inventory + tree)
    $ThirdPartyDirs = @("addons", "third_party", "vendor", "externals", "external")

    # Exclude from everything (tree + inline + inventory)
    $HardExcludeRegex = @(
        "\\.git\\", "/\.git/",
        "\\.import\\", "/\.import/",
        "\\.godot\\", "/\.godot/"
    )

    # For TREE view, hide only system folders. Keep third party visible.
    $TreeExcludeRegex = $HardExcludeRegex

    # Very high cap to avoid surprising first-party omissions.
    # If you want truly unlimited, set this to [int64]::MaxValue
    $MaxInlineBytes = 50MB

    $errors = New-Object System.Collections.Generic.List[string]
    $omitted = New-Object System.Collections.Generic.List[string]

    try {
        $scriptHash = if ($PSCommandPath -and (Test-Path $PSCommandPath)) { (Get-FileHash -Algorithm SHA256 -Path $PSCommandPath).Hash } else { "UNKNOWN" }

        $header = New-Object System.Text.StringBuilder
        $null = $header.AppendLine("=== SPACE TRADE EMPIRE PROJECT DUMP ===")
        $null = $header.AppendLine("format_version: $DevToolVersion")
        $null = $header.AppendLine("dump_timestamp: $(Get-Date -Format o)")
        $null = $header.AppendLine("project_root: $($ProjectRoot.Path)")
        $null = $header.AppendLine("devtool_path: $PSCommandPath")
        $null = $header.AppendLine("devtool_sha256: $scriptHash")
        $null = $header.AppendLine("max_inline_bytes: $MaxInlineBytes")
        $null = $header.AppendLine()

        # Project tree
        $null = $header.AppendLine("=== LIVE PROJECT STRUCTURE (SYSTEM FOLDERS HIDDEN) ===")
        $treeLines = Build-TreeListing -rootPath $ProjectRoot -treeExclusionRegex $TreeExcludeRegex
        foreach ($line in $treeLines) { $null = $header.AppendLine($line) }
        $null = $header.AppendLine("========================================")
        $null = $header.AppendLine()

        # Third party inventory
        $null = $header.AppendLine("=== THIRD PARTY / EXTERNAL INVENTORY (REFERENCED, NOT INLINED) ===")
        $null = $header.AppendLine("third_party_dirs: " + ($ThirdPartyDirs -join ", "))
        foreach ($d in $ThirdPartyDirs) {
            $p = Join-Path $ProjectRoot $d
            if (Test-Path $p) {
                $inv = Summarize-DirInventory -dirPath $p -label "third_party" -excludeRegexForCounting $HardExcludeRegex
                $null = $header.AppendLine("INVENTORY: $($inv.path)")
                $null = $header.AppendLine("  file_count: $($inv.file_count)")
                $null = $header.AppendLine("  total_bytes: $($inv.total_bytes)")
                $null = $header.AppendLine("  top_extensions: $($inv.top_extensions -join ', ')")
            }
        }
        $null = $header.AppendLine("========================================")
        $null = $header.AppendLine()

        # Discover files
        $allFiles = Get-ChildItem -Path $ProjectRoot -Recurse -File -Force -ErrorAction Stop

        # Always include set
        $alwaysFull = @()
        foreach ($rel in $AlwaysIncludeRel) {
            $fp = Join-Path $ProjectRoot $rel
            if (Test-Path $fp) { $alwaysFull += (Get-Item $fp).FullName }
        }

        $inlineFiles = New-Object System.Collections.Generic.List[System.IO.FileInfo]

        foreach ($f in $allFiles) {
            $full = $f.FullName

            # Exclude system
            $hardExcluded = $false
            foreach ($rx in $HardExcludeRegex) {
                if ($full -match $rx) { $hardExcluded = $true; break }
            }
            if ($hardExcluded) { continue }

            # Never inline the dump itself (avoids self-omission noise)
            if ($full -ieq $ContextFile) { continue }

            # Exclude third party from inline
            if (Is-UnderAnyDir -fullPath $full -dirNames $ThirdPartyDirs) { continue }

            $ext = [IO.Path]::GetExtension($f.Name).ToLowerInvariant()

            if ($alwaysFull -contains $full) {
                $inlineFiles.Add($f)
                continue
            }

            if ($IncludeExtensions -contains $ext) {
                $inlineFiles.Add($f)
            }
        }

        $inlineFilesSorted = $inlineFiles | Sort-Object -Property FullName

        # Build dump
        $sb = New-Object System.Text.StringBuilder
        $null = $sb.Append($header.ToString())

        $null = $sb.AppendLine("=== INLINE FILE MANIFEST (NON-3RD-PARTY) ===")
        $null = $sb.AppendLine("inline_file_count: $($inlineFilesSorted.Count)")
        $null = $sb.AppendLine("===========================================")
        $null = $sb.AppendLine()

        $totalInlineBytes = 0
        $fileIndex = 0

        foreach ($file in $inlineFilesSorted) {
            $fileIndex++
            $relPath = Normalize-RelPath $file.FullName
            $size = $file.Length
            $hash = Get-Sha256 $file.FullName

            $null = $sb.AppendLine("<<< BEGIN FILE >>>")
            $null = $sb.AppendLine("index: $fileIndex")
            $null = $sb.AppendLine("path: $relPath")
            $null = $sb.AppendLine("bytes: $size")
            $null = $sb.AppendLine("sha256: $hash")
            $null = $sb.AppendLine("<<< CONTENT >>>")

            if ($size -gt $MaxInlineBytes) {
                $omitted.Add("OMITTED_TOO_LARGE|$relPath|bytes=$size|sha256=$hash")
                $null = $sb.AppendLine("[OMITTED: file exceeds max_inline_bytes. See OMITTED FILES section.]")
                $null = $sb.AppendLine("<<< END FILE >>>")
                $null = $sb.AppendLine()
                continue
            }

            $text = Try-ReadText $file.FullName
            if ($null -eq $text) {
                $errors.Add("READ_ERROR|$relPath|bytes=$size|sha256=$hash")
                $null = $sb.AppendLine("[ERROR: could not read file as text. See ERRORS section.]")
                $null = $sb.AppendLine("<<< END FILE >>>")
                $null = $sb.AppendLine()
                continue
            }

            $null = $sb.AppendLine($text)
            if (-not $text.EndsWith("`n")) { $null = $sb.AppendLine() }
            $null = $sb.AppendLine("<<< END FILE >>>")
            $null = $sb.AppendLine()

            $totalInlineBytes += $size
        }

        $null = $sb.AppendLine("=== OMITTED FILES (NOT INLINED) ===")
        $null = $sb.AppendLine("omitted_count: $($omitted.Count)")
        foreach ($o in $omitted) { $null = $sb.AppendLine($o) }
        $null = $sb.AppendLine("===================================")
        $null = $sb.AppendLine()

        $null = $sb.AppendLine("=== ERRORS ===")
        $null = $sb.AppendLine("error_count: $($errors.Count)")
        foreach ($e in $errors) { $null = $sb.AppendLine($e) }
        $null = $sb.AppendLine("==============")
        $null = $sb.AppendLine()

        $null = $sb.AppendLine("=== DUMP SUMMARY ===")
        $null = $sb.AppendLine("inline_file_count: $($inlineFilesSorted.Count)")
        $null = $sb.AppendLine("inline_total_bytes: $totalInlineBytes")
        $null = $sb.AppendLine("third_party_dirs_referenced: " + ($ThirdPartyDirs -join ", "))
        $null = $sb.AppendLine("max_inline_bytes: $MaxInlineBytes")
        $null = $sb.AppendLine("====================")
        $null = $sb.AppendLine()
        $null = $sb.AppendLine("=== END OF DUMP ===")

        Set-Content -Path $ContextFile -Value $sb.ToString() -Encoding UTF8 -ErrorAction Stop

        Log-Output "SUCCESS: Context refreshed."
        Log-Output "Inline files: $($inlineFilesSorted.Count) | Inline bytes: $totalInlineBytes | Omitted: $($omitted.Count) | Errors: $($errors.Count)"
        Log-Output "Dump: $ContextFile"
        Log-Output "Script: $PSCommandPath"
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

function Run-GitSave {
    Log-Output ">>> EXEC: GIT SNAPSHOT"
    git add .
    $res = git commit -m "Manual Save Point $(Get-Date)" 2>&1
    Log-Output $res
    Log-Output "State Saved."
}

function Run-GitReset {
    $confirm = [System.Windows.Forms.MessageBox]::Show("NUKE IT? This reverts to the last SAVE.", "DANGER ZONE", [System.Windows.Forms.MessageBoxButtons]::YesNo, [System.Windows.Forms.MessageBoxIcon]::Warning)
    if ($confirm -eq "Yes") {
        Log-Output ">>> EXEC: HARD RESET"
        git reset --hard 2>&1 | Out-Null
        git clean -fd 2>&1 | Out-Null
        Log-Output "SUCCESS: Time machine activated. Changes reverted."
    }
}

# --- UI COMPONENTS ---

$lblHeader = New-Object System.Windows.Forms.Label
$lblHeader.Text = "COMMAND DECK"
$lblHeader.Location = New-Object System.Drawing.Point(20, 10)
$lblHeader.Font = $fontHeader
$lblHeader.AutoSize = $true
$form.Controls.Add($lblHeader)

$btnTest = New-Object System.Windows.Forms.Button
$btnTest.Text = "1. RUN UNIT TESTS"
$btnTest.Location = New-Object System.Drawing.Point(20, 40)
$btnTest.Size = New-Object System.Drawing.Size(400, 45)
$btnTest.Font = $fontNormal
$btnTest.BackColor = "#007acc"
$btnTest.ForeColor = "White"
$btnTest.FlatStyle = "Flat"
$btnTest.Add_Click({ Run-Tests })
$form.Controls.Add($btnTest)

$btnContext = New-Object System.Windows.Forms.Button
$btnContext.Text = "2. GENERATE CONTEXT"
$btnContext.Location = New-Object System.Drawing.Point(20, 95)
$btnContext.Size = New-Object System.Drawing.Size(400, 45)
$btnContext.Font = $fontNormal
$btnContext.BackColor = "#2d2d30"
$btnContext.ForeColor = "White"
$btnContext.FlatStyle = "Flat"
$btnContext.Add_Click({ Run-ContextGen })
$form.Controls.Add($btnContext)

$btnSave = New-Object System.Windows.Forms.Button
$btnSave.Location = New-Object System.Drawing.Point(20, 150)
$btnSave.Size = New-Object System.Drawing.Size(195, 45)
$btnSave.Text = "3. SAVE STATE"
$btnSave.BackColor = "#228822"
$btnSave.ForeColor = "White"
$btnSave.Font = $fontNormal
$btnSave.FlatStyle = "Flat"
$btnSave.Add_Click({ Run-GitSave })
$form.Controls.Add($btnSave)

$btnUndo = New-Object System.Windows.Forms.Button
$btnUndo.Location = New-Object System.Drawing.Point(225, 150)
$btnUndo.Size = New-Object System.Drawing.Size(195, 45)
$btnUndo.Text = "4. HARD RESET"
$btnUndo.BackColor = "#cc2222"
$btnUndo.ForeColor = "White"
$btnUndo.Font = $fontNormal
$btnUndo.FlatStyle = "Flat"
$btnUndo.Add_Click({ Run-GitReset })
$form.Controls.Add($btnUndo)

$form.Add_Shown({
    $form.Activate()
    Log-Output "DevTool path: $PSCommandPath"
})

[void] $form.ShowDialog()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 5
path: godot_path.cfg
bytes: 40
sha256: E260C63C14FB82B4D261960EE192BF1A27598566F46C6CF7564B2AE3AA48D531
<<< CONTENT >>>
C:\Godot\Godot_v4.5.1-stable_win64.exe

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 6
path: project.godot
bytes: 564
sha256: 7A475CFE7104C5993AA3BF112E9EFECA56E3C41EE442ACA35DEF590078E5DCDC
<<< CONTENT >>>
; Engine configuration file.
; It's best edited using the editor UI and not directly,
; since the parameters that go here are not all obvious.
;
; Format:
;   [section] ; section goes between []
;   param=value ; assign values to parameters

config_version=5

[application]

config/name="Space Trade Empire"
run/main_scene="res://scenes/main.tscn"
config/features=PackedStringArray("4.5", "Forward Plus")

[display]

window/size/viewport_width=1920
window/size/viewport_height=1080
window/stretch/mode="canvas_items"

[editor_plugins]

enabled=PackedStringArray()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 7
path: resources\commodities\iron.tres
bytes: 313
sha256: 1FDFEAC3F509FCDF42B22C5FE3A57EB3FB603952B2CAB4C0E75A58C94CA2F593
<<< CONTENT >>>
[gd_resource type="Resource" script_class="TradeGood" load_steps=2 format=3 uid="uid://tg_iron_001"]

[ext_resource type="Script" path="res://scripts/resources/trade_good.gd" id="1_tg"]

[resource]
script = ExtResource("1_tg")
id = "ore_iron"
name = "Iron Ore"
base_price = 45
volume = 0.5
is_contraband = false

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 8
path: scenes\asteroid.tscn
bytes: 820
sha256: 7497CB978E11CFE2F4EAECBE445546975CEA6EA1F2FD8186A4D44BA6D4444ED1
<<< CONTENT >>>
[gd_scene load_steps=5 format=3 uid="uid://asteroid_base_01"]

[ext_resource type="Script" path="res://scripts/asteroid.gd" id="1_rock"]

[sub_resource type="SphereShape3D" id="SphereShape3D_rock"]
radius = 2.0

[sub_resource type="SphereMesh" id="SphereMesh_rock"]
radius = 2.0
height = 4.0

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_grey"]
albedo_color = Color(0.4, 0.4, 0.4, 1)

[node name="Asteroid" type="StaticBody3D" groups=["Destructible"]]
collision_layer = 2
collision_mask = 0
script = ExtResource("1_rock")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("SphereShape3D_rock")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("SphereMesh_rock")
surface_material_override/0 = SubResource("StandardMaterial3D_grey")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 9
path: scenes\bullet.tscn
bytes: 807
sha256: 833770F44501088845389E358440EF4FBE0327B000D49427AF1B6D64503FA8B9
<<< CONTENT >>>
[gd_scene load_steps=5 format=3 uid="uid://projectile_01"]

[ext_resource type="Script" path="res://scripts/bullet.gd" id="1_b"]

[sub_resource type="BoxShape3D" id="BoxShape3D_b"]
size = Vector3(0.2, 0.2, 1.0)

[sub_resource type="BoxMesh" id="BoxMesh_b"]
size = Vector3(0.2, 0.2, 1.0)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_red"]
albedo_color = Color(1, 0, 0, 1)
emission_enabled = true
emission = Color(1, 0, 0, 1)
emission_energy_multiplier = 2.0

[node name="Bullet" type="Area3D"]
script = ExtResource("1_b")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_b")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("BoxMesh_b")
surface_material_override/0 = SubResource("StandardMaterial3D_red")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 10
path: scenes\enemy.tscn
bytes: 1206
sha256: 1915F48856F12284F778562CA2944F59ABE180D2C6F59678846397420C1A7A26
<<< CONTENT >>>
[gd_scene load_steps=7 format=3 uid="uid://enemy_drone_v2"]

[ext_resource type="Script" path="res://scripts/enemy.gd" id="1_ai"]

[sub_resource type="BoxShape3D" id="BoxShape3D_drone"]
size = Vector3(1.5, 1.5, 2.0)

[sub_resource type="PrismMesh" id="PrismMesh_drone"]
size = Vector3(1.5, 1.5, 2.0)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_hostile"]
albedo_color = Color(1, 0, 0, 1)

[sub_resource type="BoxMesh" id="BoxMesh_eye"]
size = Vector3(0.5, 0.5, 0.5)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_black"]
albedo_color = Color(0, 0, 0, 1)

[node name="EnemyDrone" type="CharacterBody3D"]
collision_layer = 2
collision_mask = 3
script = ExtResource("1_ai")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_drone")

[node name="Body" type="MeshInstance3D" parent="."]
mesh = SubResource("PrismMesh_drone")
surface_material_override/0 = SubResource("StandardMaterial3D_hostile")

[node name="CockpitEye" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.2, -1.0)
mesh = SubResource("BoxMesh_eye")
surface_material_override/0 = SubResource("StandardMaterial3D_black")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 11
path: scenes\main.tscn
bytes: 1918
sha256: B5EF3BA53444039DF06DF69257A1915FB5403D9624E0EFE97985E1984B708296
<<< CONTENT >>>
[gd_scene load_steps=9 format=3 uid="uid://b8j24k1n5q2x"]

[ext_resource type="PackedScene" path="res://scenes/player.tscn" id="2_0wfyh"]
[ext_resource type="PackedScene" path="res://scenes/station.tscn" id="3_sugp2"]
[ext_resource type="PackedScene" path="res://scenes/asteroid.tscn" id="4_asteroid"]
[ext_resource type="PackedScene" path="res://scenes/ui_hud.tscn" id="4_jyhfs"]
[ext_resource type="Script" uid="uid://cdth7i21ieed5" path="res://scripts/spawner.gd" id="5_tbgi4"]

[sub_resource type="Environment" id="Environment_blue"]
background_mode = 1
background_color = Color(0, 0, 0.2, 1)
ambient_light_source = 2
ambient_light_color = Color(1, 1, 1, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_floor"]
albedo_color = Color(0.3, 0.3, 0.3, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_floor"]
material = SubResource("StandardMaterial3D_floor")
size = Vector2(100, 100)

[node name="Main" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_blue")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.5, 0.866025, 0, -0.866025, 0.5, 0, 10, 0)
shadow_enabled = true

[node name="ReferenceFloor" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -2, 0)
mesh = SubResource("PlaneMesh_floor")

[node name="Asteroid" parent="." instance=ExtResource("4_asteroid")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -10)

[node name="Player" parent="." instance=ExtResource("2_0wfyh")]

[node name="Station" parent="." instance=ExtResource("3_sugp2")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 8.094528, 0.91242695, -15.825881)

[node name="HUD" parent="." instance=ExtResource("4_jyhfs")]

[node name="Spawner" type="Node3D" parent="."]
script = ExtResource("5_tbgi4")
asteroid_scene = ExtResource("4_asteroid")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 12
path: scenes\player.tscn
bytes: 1014
sha256: 45BDC245C89B9046000818CF1DCA74F8691F81ED7CDCCE9FD58837FC37B3D92E
<<< CONTENT >>>
[gd_scene load_steps=4 format=3 uid="uid://player_asset_01"]

[ext_resource type="Script" path="res://scripts/player.gd" id="1_script"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_hitbox"]
radius = 1.0
height = 2.0

[sub_resource type="CapsuleMesh" id="CapsuleMesh_visual"]
radius = 1.0
height = 2.0

[node name="Player" type="CharacterBody3D"]
collision_layer = 1
collision_mask = 1
script = ExtResource("1_script")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
shape = SubResource("CapsuleShape3D_hitbox")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
mesh = SubResource("CapsuleMesh_visual")

[node name="CameraMount" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.906308, 0.422618, 0, -0.422618, 0.906308, 0, 3, 5)

[node name="Camera3D" type="Camera3D" parent="CameraMount"]

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 13
path: scenes\station.tscn
bytes: 763
sha256: 42AE952D456EF86A598C59B005BF0DCA02ED89BAA835D4D9B32CE3079EF57A4A
<<< CONTENT >>>
[gd_scene load_steps=4 format=3 uid="uid://station_alpha_01"]

[ext_resource type="Script" path="res://scripts/station.gd" id="1_stn"]

[sub_resource type="BoxShape3D" id="BoxShape3D_dock"]
size = Vector3(10, 5, 10)

[sub_resource type="BoxMesh" id="BoxMesh_station"]
size = Vector3(10, 5, 10)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_green"]
transparency = 1
albedo_color = Color(0, 1, 0, 0.3)

[node name="Station" type="Area3D"]
script = ExtResource("1_stn")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_dock")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("BoxMesh_station")
surface_material_override/0 = SubResource("StandardMaterial3D_green")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 14
path: scenes\tests\test_economy_core.tscn
bytes: 218
sha256: 80A54139698AE93EA99B0CA38B7A22C9D962F733F4C246C37401D6DAE83EEBFB
<<< CONTENT >>>
[gd_scene load_steps=2 format=3 uid="uid://test_econ_01"]

[ext_resource type="Script" path="res://scripts/tests/test_economy_core.gd" id="1_test"]

[node name="TestRunner" type="Node"]
script = ExtResource("1_test")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 15
path: scenes\tests\test_galaxy_core.tscn
bytes: 222
sha256: A152414BB595AFCA06622DB308CF17805EB7A4E69DC8937C8A0C43AD871C8992
<<< CONTENT >>>
[gd_scene load_steps=2 format=3 uid="uid://test_gal_01"]

[ext_resource type="Script" path="res://scripts/tests/test_galaxy_core.gd" id="1_testgal"]

[node name="TestGalaxy" type="Node"]
script = ExtResource("1_testgal")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 16
path: scenes\ui_hud.tscn
bytes: 4141
sha256: BC9C06E90AF1851BC1EC1BBBA5A4357F3E68830466793FFDE3AEFBFD0A2F07C6
<<< CONTENT >>>
[gd_scene load_steps=4 format=3 uid="uid://ui_hud_04"]

[ext_resource type="Script" path="res://scripts/hud.gd" id="1_ui"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_green"]
bg_color = Color(0.2, 0.8, 0.2, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_yellow"]
bg_color = Color(0.8, 0.8, 0.2, 1)

[node name="HUD" type="CanvasLayer"]
script = ExtResource("1_ui")

[node name="Control" type="Control" parent="."]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="Panel" type="Panel" parent="Control"]
layout_mode = 0
offset_left = 20.0
offset_top = 20.0
offset_right = 320.0
offset_bottom = 240.0

[node name="VBoxContainer" type="VBoxContainer" parent="Control/Panel"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 15.0
offset_top = 15.0
offset_right = -15.0
offset_bottom = -15.0
grow_horizontal = 2
grow_vertical = 2

[node name="MoneyLabel" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 24
text = "CREDITS: $0"

[node name="HSeparator1" type="HSeparator" parent="Control/Panel/VBoxContainer"]
layout_mode = 2

[node name="LabelHull" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 12
text = "SHIELD INTEGRITY"

[node name="HealthBar" type="ProgressBar" parent="Control/Panel/VBoxContainer"]
custom_minimum_size = Vector2(0, 15)
layout_mode = 2
theme_override_styles/fill = SubResource("StyleBoxFlat_green")
value = 100.0
show_percentage = false

[node name="LabelFuel" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 12
text = "FUEL RESERVES"

[node name="FuelBar" type="ProgressBar" parent="Control/Panel/VBoxContainer"]
custom_minimum_size = Vector2(0, 15)
layout_mode = 2
theme_override_styles/fill = SubResource("StyleBoxFlat_yellow")
value = 100.0
show_percentage = false

[node name="HSeparator2" type="HSeparator" parent="Control/Panel/VBoxContainer"]
layout_mode = 2

[node name="CargoLabel" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
text = "CARGO: Empty"

[node name="ShopPanel" type="Panel" parent="Control"]
visible = false
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -250.0
offset_top = -200.0
offset_right = 250.0
offset_bottom = 200.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="Control/ShopPanel"]
layout_mode = 1
anchors_preset = 10
anchor_right = 1.0
offset_bottom = 40.0
grow_horizontal = 2
theme_override_font_sizes/font_size = 20
text = "COMMODITIES MARKET"
horizontal_alignment = 1
vertical_alignment = 1

[node name="VBoxContainer" type="VBoxContainer" parent="Control/ShopPanel"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 20.0
offset_top = 50.0
offset_right = -20.0
offset_bottom = -20.0
grow_horizontal = 2
grow_vertical = 2

[node name="MarketTicker" type="Label" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
theme_override_colors/font_color = Color(0, 1, 0, 1)
text = "IRON: $50 | GOLD: $100"
horizontal_alignment = 1

[node name="HSeparator3" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2

[node name="BtnSellAll" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
theme_override_colors/font_color = Color(0, 1, 0, 1)
text = "SELL ALL CARGO (AT CURRENT RATES)"

[node name="HSeparator4" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2

[node name="BtnSpeed" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "Upgrade Thrusters ($200)"

[node name="BtnWeapon" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "Upgrade Cooling ($500)"

[node name="HSeparator5" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2

[node name="BtnClose" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "UNDOCK"

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 17
path: scripts\asteroid.gd
bytes: 1466
sha256: 8A04EB65B62533AFF33CFE9A52264548294CB2266395D51D94F22BDE682568D9
<<< CONTENT >>>
extends StaticBody3D

@export var resource_type: String = "ore_iron"
@export var resource_amount: int = 1
@export var health: int = 3

func take_damage(amount: int):
    health -= amount
    print("[TARGET] Asteroid Hit! Health: %s" % health)
    
    # Flash Effect (Optional - just creates a visual pop)
    var mesh = $MeshInstance3D
    if mesh:
        var tween = create_tween()
        tween.tween_property(mesh, "scale", Vector3(1.2, 1.2, 1.2), 0.05)
        tween.tween_property(mesh, "scale", Vector3(1.0, 1.0, 1.0), 0.05)

    if health <= 0:
        explode()

func explode():
    print("[TARGET] Asteroid Destroyed! Yield: %s x%s" % [resource_type, resource_amount])
    
    # Give Loot to Player (Simplification: Auto-collect)
    # In a full game, we would spawn floating items.
    var player = get_tree().get_first_node_in_group("Player")
    if player:
        # Check if player has space (using the API we built earlier)
        # Note: We need to ensure 'add_cargo' exists in player.gd or use direct dict access
        if player.has_method("add_cargo"):
            player.add_cargo(resource_type, resource_amount)
        else:
            # Fallback if add_cargo helper is missing
            if not player.cargo.has(resource_type): player.cargo[resource_type] = 0
            player.cargo[resource_type] += resource_amount
            # Force UI Update
            player._update_ui_state() 
            
    queue_free() # Delete the rock

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 18
path: scripts\bullet.gd
bytes: 950
sha256: 37C292357212BB80E57C33DF52CC1459DC99D848D32014B95A57CF4D4168303D
<<< CONTENT >>>
extends Area3D

# --- PHYSICS CONSTANTS ---
var speed = 60.0
var damage = 1
var lifetime = 2.0
var shooter = null # IFF TAG

func _ready():
    # Layer 1 (World) + Layer 2 (Enemies/Player)
    collision_mask = 1 | 2 
    body_entered.connect(_on_body_entered)
    
    # Failsafe: Die after 2 seconds to prevent memory leaks
    await get_tree().create_timer(lifetime).timeout
    queue_free()

func _physics_process(delta):
    # LAW: Bullets ALWAYS travel Negative Z (Local Forward)
    position -= transform.basis.z * speed * delta

func _on_body_entered(body):
    # LAW: Do not hit the shooter
    if body == shooter: return

    print("IMPACT: %s -> %s" % [shooter.name if shooter else "Unknown", body.name])
    
    if body.has_method("take_damage"):
        body.take_damage(damage)
        queue_free()
    elif body.name != "Player" and body.name != "EnemyDrone":
        # Destroy on static objects (Station, Walls)
        queue_free()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 19
path: scripts\core\economy_engine.gd
bytes: 946
sha256: F914951A8C925F1D4B14534016E6E41B7FCF6B3CF16D5AD7AB810ECDC5AE6AE1
<<< CONTENT >>>
extends RefCounted
class_name EconomyEngine

const MINIMUM_PRICE = 1

# Note: 'good' is typed as Resource to prevent headless dependency errors
static func calculate_price(good: Resource, local_supply: int, base_demand: int) -> int:
    # MVP Algorithm: Simple Scarcity
    # We access properties dynamically
    var base = good.get("base_price")
    if base == null:
        base = 10 # Fallback
        
    var scarcity_factor = float(base_demand) / max(1.0, float(local_supply))
    var final_price = int(base * scarcity_factor)
    return max(final_price, MINIMUM_PRICE)

static func can_afford(wallet_balance: int, price_per_unit: int, quantity: int) -> bool:
    return wallet_balance >= (price_per_unit * quantity)

static func has_cargo_space(current_volume: float, max_volume: float, item_volume: float, quantity: int) -> bool:
    var required_space = item_volume * quantity
    return (current_volume + required_space) <= max_volume

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 20
path: scripts\core\galaxy_graph.gd
bytes: 1490
sha256: 6B9ACBA0472711035D0EA2DBFAE9833B6F8034DCDD7BB9141DB5464D86C851DA
<<< CONTENT >>>
extends RefCounted
class_name GalaxyGraph

# The Master Ledger of all stars
var sectors: Dictionary = {} # { "id": Sector }

func add_sector(sec: Resource):
    sectors[sec.id] = sec

func connect_sectors(id_a: String, id_b: String):
    if sectors.has(id_a) and sectors.has(id_b):
        sectors[id_a].connect_to(id_b)
        sectors[id_b].connect_to(id_a) # Bidirectional Jump Gate

# BFS Pathfinding: Returns list of IDs [start, ... , end]
func get_route(start_id: String, end_id: String) -> Array:
    if start_id == end_id: return [start_id]
    
    var queue = []
    var visited = { start_id: true }
    var parents = {} # To reconstruct path
    
    queue.append(start_id)
    
    while queue.size() > 0:
        var current = queue.pop_front()
        
        if current == end_id:
            return _reconstruct_path(parents, start_id, end_id)
            
        var current_sector = sectors.get(current)
        if current_sector:
            for neighbor in current_sector.connected_ids:
                if not visited.has(neighbor):
                    visited[neighbor] = true
                    parents[neighbor] = current
                    queue.append(neighbor)
                    
    return [] # No path found

func _reconstruct_path(parents: Dictionary, start: String, end: String) -> Array:
    var path = []
    var curr = end
    while curr != start:
        path.push_front(curr)
        curr = parents[curr]
    path.push_front(start)
    return path

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 21
path: scripts\debug\camera_follow.gd
bytes: 864
sha256: 536FAB2A38C25D83E18B29EAFACD38F3E844472D49C81A88BCA7E0382B9800BE
<<< CONTENT >>>
extends Camera3D

# SETTINGS: 40 meters up, 25 meters back
var offset = Vector3(0, 40, 25)
var target_node

func _ready():
	# 1. THE EJECT BUTTON
	# This tells the engine: "Ignore my parent's rotation. Use Global coordinates."
	set_as_top_level(true)
	
	# 2. FIND THE SHIP
	# If we are inside the ship, our parent is the ship.
	var parent = get_parent()
	if parent.name == "Player":
		target_node = parent
	else:
		# If we are neighbors, find it by name
		target_node = parent.get_node_or_null("Player")

	if target_node:
		# Teleport to starting position
		global_position = target_node.global_position + offset
		look_at(target_node.global_position)

func _physics_process(_delta):
	if target_node:
		# 3. CHASE THE SHIP
		# Since we are "Top Level" now, we must manually update our position every frame.
		global_position = target_node.global_position + offset

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 22
path: scripts\enemy.gd
bytes: 1392
sha256: 14C7B3F64274ACC7C0DC14D499043E30B4CFCBAE87869E0E02543B75E1068A8F
<<< CONTENT >>>
extends CharacterBody3D

@export var speed: float = 15.0
@export var health: int = 3
@export var detection_range: float = 100.0
@export var attack_range: float = 30.0 
@export var loot_table: String = "ore_gold"

var target: Node3D = null
var bullet_scene = preload("res://scenes/bullet.tscn")
var can_shoot: bool = true
var cooldown: float = 1.5

func _ready():
	target = get_tree().get_first_node_in_group("Player")
	add_to_group("Hostile")

func _physics_process(_delta):
	if not target: return
	
	var dist = global_position.distance_to(target.global_position)
	
	if dist < detection_range:
		# POINT NEGATIVE Z AT PLAYER
		look_at(target.global_position, Vector3.UP)
		
		if dist > attack_range:
			# Move along -Z (Forward)
			velocity = -transform.basis.z * speed
		else:
			velocity = Vector3.ZERO
			_attempt_fire()
			
		move_and_slide()

func _attempt_fire():
	if can_shoot:
		can_shoot = false
		var b = bullet_scene.instantiate()
		
		# SPAWN IN FRONT (-Z)
		b.position = position - (transform.basis.z * 2.5) 
		b.rotation = rotation
		b.shooter = self
		
		get_parent().add_child(b)
		
		await get_tree().create_timer(cooldown).timeout
		can_shoot = true

func take_damage(amount: int):
	health -= amount
	print("[ENEMY] Integrity: %s" % health)
	if health <= 0: _die()

func _die():
	if target and target.has_method("add_cargo"):
		target.add_cargo(loot_table, 2)
	queue_free()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 23
path: scripts\hud.gd
bytes: 3366
sha256: 3F1E4AA63C640D3151D1D23696C55E80F06211E9B716A6AAB9A679FA1D0A4DE3
<<< CONTENT >>>
extends CanvasLayer

@onready var money_label = $Control/Panel/VBoxContainer/MoneyLabel
@onready var health_bar = $Control/Panel/VBoxContainer/HealthBar
@onready var fuel_bar = $Control/Panel/VBoxContainer/FuelBar
@onready var cargo_label = $Control/Panel/VBoxContainer/CargoLabel

@onready var shop_panel = $Control/ShopPanel
@onready var market_ticker = $Control/ShopPanel/VBoxContainer/MarketTicker
@onready var btn_sell = $Control/ShopPanel/VBoxContainer/BtnSellAll
@onready var btn_speed = $Control/ShopPanel/VBoxContainer/BtnSpeed
@onready var btn_weapon = $Control/ShopPanel/VBoxContainer/BtnWeapon
@onready var btn_close = $Control/ShopPanel/VBoxContainer/BtnClose

var player_ref = null
var current_station = null

func _ready():
    shop_panel.visible = false
    btn_sell.pressed.connect(_on_sell_all)
    btn_speed.pressed.connect(_on_buy_speed)
    btn_weapon.pressed.connect(_on_buy_weapon)
    btn_close.pressed.connect(_on_close_shop)

    _find_player()

func _find_player():
    var player = get_tree().get_first_node_in_group("Player")
    if player:
        player_ref = player
        player.credits_updated.connect(_on_credits_updated)
        player.cargo_updated.connect(_on_cargo_updated)
        player.health_updated.connect(_on_health_updated)
        player.fuel_updated.connect(_on_fuel_updated)
        player.shop_toggled.connect(_on_shop_toggled)
        
        # Init
        _on_credits_updated(player.credits)
        _on_cargo_updated(player.cargo)
        _on_health_updated(player.health, player.max_health)
        _on_fuel_updated(player.fuel, player.max_fuel)
    else:
        await get_tree().create_timer(0.1).timeout
        _find_player()

func _on_credits_updated(amount):
    money_label.text = "CREDITS: $%s" % amount

func _on_health_updated(current, max_val):
    if health_bar:
        health_bar.max_value = max_val
        health_bar.value = current

func _on_fuel_updated(current, max_val):
    if fuel_bar:
        fuel_bar.max_value = max_val
        fuel_bar.value = current

func _on_cargo_updated(manifest):
    var text = "CARGO: "
    if manifest.is_empty():
        text += "Empty"
    else:
        for item in manifest:
            text += "%s(%s) " % [item.replace("ore_", "").capitalize(), manifest[item]]
    cargo_label.text = text

func _on_shop_toggled(is_open, station_ref):
    shop_panel.visible = is_open
    current_station = station_ref
    
    if is_open:
        Input.mouse_mode = Input.MOUSE_MODE_VISIBLE
        _update_ticker()
    else:
        Input.mouse_mode = Input.MOUSE_MODE_CAPTURED

func _update_ticker():
    if not current_station: return
    var p_iron = current_station.get_market_price("ore_iron")
    var p_gold = current_station.get_market_price("ore_gold")
    market_ticker.text = "IRON: $%s | GOLD: $%s" % [p_iron, p_gold]

func _on_sell_all():
    if not player_ref or not current_station: return
    
    var manifest = player_ref.cargo.duplicate()
    for item in manifest:
        current_station.sell_cargo(player_ref, item, manifest[item])
        player_ref.remove_cargo(item, manifest[item])
    
    _update_ticker()

func _on_buy_speed():
    if player_ref: player_ref.purchase_upgrade("speed", 200)

func _on_buy_weapon():
    if player_ref: player_ref.purchase_upgrade("weapon", 500)

func _on_close_shop():
    if player_ref: player_ref.undock()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 24
path: scripts\player.gd
bytes: 4174
sha256: C1ED5AFA3B91CFD02A8BAAF4E6BE79E2CD0C9C5B5288DBF22FD43F9E6BE28D3A
<<< CONTENT >>>
extends CharacterBody3D

# --- CONFIG ---
@export_group("Ship Settings")
@export var speed_max := 25.0
@export var acceleration := 40.0
@export var friction := 15.0
@export var rotation_speed := 5.0
@export var max_health := 10
@export var max_fuel := 1000.0
@export var fuel_burn_rate := 15.0 # Cost to fly

@export_group("Weapon Systems")
@export var weapon_cooldown := 0.25
@export var invert_mesh_fire: bool = true

# --- STATE ---
var health: int = 10
var fuel: float = 1000.0
var credits: int = 100
var cargo: Dictionary = {} 
var cargo_capacity: int = 10
var is_docked: bool = false
var can_shoot : bool = true
var current_station = null

# --- SIGNALS ---
signal credits_updated(amount)
signal cargo_updated(manifest)
signal health_updated(current, max)
signal fuel_updated(current, max) # NEW
signal shop_toggled(is_open, station_ref) # UPDATED

# --- INTERNAL ---
var bullet_scene = preload("res://scenes/bullet.tscn")
var my_camera : Camera3D = null

func _ready():
		add_to_group("Player")
		Input.mouse_mode = Input.MOUSE_MODE_CAPTURED
		health = max_health
		fuel = max_fuel

		# Cam Init (scene camera only)
		my_camera = get_node_or_null("CameraMount/Camera3D")
		if my_camera:
				my_camera.current = true

		await get_tree().process_frame
		_update_ui_state()

func _physics_process(delta):
	if is_docked: return
	
	var input_dir = Input.get_vector("ui_left", "ui_right", "ui_up", "ui_down")
	var direction = Vector3(input_dir.x, 0, input_dir.y).normalized()

	# FUEL LOGIC
	if direction and fuel > 0:
		velocity = velocity.move_toward(direction * speed_max, acceleration * delta)
		
		# Burn Fuel
		fuel -= fuel_burn_rate * delta
		emit_signal("fuel_updated", int(fuel), int(max_fuel))
		
		# Rotation
		var target_rotation = atan2(velocity.x, velocity.z)
		rotation.y = lerp_angle(rotation.y, target_rotation, rotation_speed * delta)
	else:
		# Drift if no input or empty tank
		velocity = velocity.move_toward(Vector3.ZERO, friction * delta)

	move_and_slide()

	if Input.is_action_pressed("ui_accept") and can_shoot:
		shoot()
		
	if my_camera:
		var target_pos = global_position + Vector3(0, 40, 20)
		my_camera.global_position = my_camera.global_position.lerp(target_pos, 5.0 * delta)
		my_camera.look_at(global_position)

func shoot():
	if not bullet_scene: return
	can_shoot = false
	var new_bullet = bullet_scene.instantiate()
	new_bullet.position = position 
	new_bullet.rotation = rotation
	if invert_mesh_fire: new_bullet.rotate_object_local(Vector3.UP, PI)
	new_bullet.position += new_bullet.transform.basis.z * -2.0
	new_bullet.shooter = self
	get_parent().add_child(new_bullet)
	await get_tree().create_timer(weapon_cooldown).timeout
	can_shoot = true

func take_damage(amount: int):
	health -= amount
	emit_signal("health_updated", health, max_health)
	if health <= 0: _die()

func _die():
		print("CRITICAL FAILURE.")
		# Defer scene reload to avoid removing nodes during physics callbacks
		get_tree().call_deferred("reload_current_scene")

func _update_ui_state():
	emit_signal("credits_updated", credits)
	emit_signal("cargo_updated", cargo)
	emit_signal("health_updated", health, max_health)
	emit_signal("fuel_updated", int(fuel), int(max_fuel))

func add_cargo(item_id: String, amount: int):
	if not cargo.has(item_id): cargo[item_id] = 0
	cargo[item_id] += amount
	_update_ui_state()

func remove_cargo(item_id: String, amount: int):
	if cargo.has(item_id):
		cargo[item_id] -= amount
		if cargo[item_id] <= 0: cargo.erase(item_id)
		_update_ui_state()

func receive_payment(amount: int):
	credits += amount
	_update_ui_state()

func dock_at_station(station_node):
	if is_docked: return
	is_docked = true
	current_station = station_node
	velocity = Vector3.ZERO
	emit_signal("shop_toggled", true, current_station)

func undock():
	is_docked = false
	current_station = null
	emit_signal("shop_toggled", false, null)
	position -= transform.basis.z * 5.0
	
func get_fuel_status():
	return fuel
	
# PURCHASE UPGRADE API (Re-added to prevent errors)
func purchase_upgrade(type: String, cost: int):
	if credits >= cost:
		credits -= cost
		match type:
			"speed": speed_max += 5.0
			"weapon": weapon_cooldown *= 0.8
		_update_ui_state()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 25
path: scripts\resources\market_profile.gd
bytes: 261
sha256: 5DA2ADCC012BEE3B0E6B256B3D3B9AF250333C05163EFE1E34C5531CDA08D1E5
<<< CONTENT >>>
extends Resource
class_name MarketProfile

# This defines a Station's economic personality
@export var station_name: String = "Station"
@export var wealth_tier: float = 1.0
@export var trade_goods: Array[TradeGood] = []
# Future: Add supply/demand curves here

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 26
path: scripts\resources\sector.gd
bytes: 379
sha256: 8D6870C504B81B8DA0645080A994010D2B970F32E6EA164146F1560DC663F3D9
<<< CONTENT >>>
extends Resource
class_name Sector

@export var id: String = "sector_id"
@export var name: String = "Sector Name"
@export var coordinates: Vector2 = Vector2.ZERO # For the 2D Map UI later
@export var connected_ids: Array = [] # List of Strings (IDs of neighbors)

func connect_to(other_id: String):
    if not connected_ids.has(other_id):
        connected_ids.append(other_id)

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 27
path: scripts\resources\trade_good.gd
bytes: 233
sha256: 69D9C850B441D229D84AB974E4DB7B985BDF4B95981259D5518020A2773D308D
<<< CONTENT >>>
extends Resource
class_name TradeGood

@export var id: String = "item_id"
@export var name: String = "Item Name"
@export var base_price: int = 10
@export var volume: float = 1.0 # m3 per unit
@export var is_contraband: bool = false

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 28
path: scripts\spawner.gd
bytes: 1323
sha256: B0FE66F1D1FE7A74DBD0AB802BDA8F85F39D811692B9CE294B46B572FDA3DF1F
<<< CONTENT >>>
extends Node3D

@export var asteroid_scene: PackedScene
@export var enemy_scene: PackedScene
@export var field_radius: float = 100.0
@export var asteroid_count: int = 30
@export var threat_level: float = 0.1 # 10% chance

func _ready():
    # Load enemy scene dynamically if not assigned in Inspector
    if not enemy_scene:
        enemy_scene = load("res://scenes/enemy.tscn")
    
    if not asteroid_scene:
        print("ERROR: No Asteroid Scene assigned!")
        return
        
    print("[SYSTEM] GENERATING SECTOR: Threat Level %s" % threat_level)
    _generate_field()

func _generate_field():
    var rng = RandomNumberGenerator.new()
    rng.randomize()
    
    for i in range(asteroid_count):
        var obj = null
        
        # Roll the dice: Enemy or Rock?
        if rng.randf() < threat_level:
            obj = enemy_scene.instantiate()
        else:
            obj = asteroid_scene.instantiate()
        
        # Position Logic
        var x = rng.randf_range(-field_radius, field_radius)
        var z = rng.randf_range(-field_radius, field_radius)
        if abs(x) < 20 and abs(z) < 20: x += 40 # Clear zone
        
        obj.position = Vector3(x, 0, z)
        obj.rotation.y = rng.randf_range(0, 6.28)
        
        add_child(obj)
        
    print("[SYSTEM] SECTOR POPULATED.")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 29
path: scripts\starfield.gd
bytes: 803
sha256: 18DAEC80B0BC93C274C7EFEC032D5AFCD224802062736B21CF6F5C7385CD82B9
<<< CONTENT >>>
extends Node3D

func _ready():
    var rng = RandomNumberGenerator.new()
    # Create 500 stars for density
    for i in range(500):
        var star = MeshInstance3D.new()
        star.mesh = BoxMesh.new()
        star.mesh.size = Vector3(0.8, 0.8, 0.8) # Large enough to see
        
        # Create a glowing material
        var mat = StandardMaterial3D.new()
        mat.shading_mode = BaseMaterial3D.SHADING_MODE_UNSHADED
        mat.albedo_color = Color(1, 1, 1) # Pure White
        star.mesh.material = mat
        
        # Spread them out WIDE
        var x = rng.randf_range(-300, 300)
        var z = rng.randf_range(-300, 300)
        var y = rng.randf_range(-40, -100) # Deep below player
        
        star.position = Vector3(x, y, z)
        add_child(star)

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 30
path: scripts\station.gd
bytes: 2743
sha256: 9C5D859BA39F79277D9CC7D5A9960C2DDB376B48E509A44144EEF0E82B59CDB5
<<< CONTENT >>>
extends Area3D
class_name GameStation

# --- CONFIGURATION ---
@export var market_update_interval: float = 5.0
@export var fuel_cost_per_unit: int = 2

# --- MARKET DATA ---
var base_prices = { "ore_iron": 50, "ore_gold": 100 }
var current_prices = {}
var market_trend = { "ore_iron": 0, "ore_gold": 0 } # -1 Bear, 1 Bull

var timer: float = 0.0

func _ready():
    monitoring = true
    monitorable = true
    body_entered.connect(_on_body_entered)
    
    # Initialize Market
    for item in base_prices:
        current_prices[item] = base_prices[item]
    
    print("[STATION] COMMODITY EXCHANGE OPEN.")

func _process(delta):
    # Update Market every X seconds
    timer += delta
    if timer >= market_update_interval:
        timer = 0.0
        _fluctuate_market()

func _fluctuate_market():
    var rng = RandomNumberGenerator.new()
    rng.randomize()
    
    for item in base_prices:
        # 1. Shift Trend (10% chance)
        if rng.randf() < 0.1:
            market_trend[item] = rng.randi_range(-1, 1)
            
        # 2. Apply Volatility
        var volatility = rng.randf_range(-5, 5) + (market_trend[item] * 2)
        current_prices[item] += int(volatility)
        
        # 3. Safety Clamp (50% to 200% of base)
        var min_p = int(base_prices[item] * 0.5)
        var max_p = int(base_prices[item] * 2.0)
        current_prices[item] = clamp(current_prices[item], min_p, max_p)
    
    print("[MARKET] TICK: %s" % current_prices)

func _on_body_entered(body):
    if body.has_method("dock_at_station"):
        print("!!! DOCKING SEQUENCE INITIATED !!!")
        _refuel_ship(body)
        body.dock_at_station(self)

func _refuel_ship(player):
    if not player.has_method("get_fuel_status"): return
    
    var needed = player.max_fuel - player.fuel
    if needed > 1.0:
        var cost = int(needed * fuel_cost_per_unit)
        if player.credits >= cost:
            player.credits -= cost
            player.fuel = player.max_fuel
            player.receive_payment(0) # Force UI Update
            print("[STATION] FULL TANK: -$%s" % cost)
        else:
            # Partial Fill
            var units = int(player.credits / fuel_cost_per_unit)
            if units > 0:
                player.credits -= (units * fuel_cost_per_unit)
                player.fuel += units
                player.receive_payment(0)
                print("[STATION] PARTIAL FILL: +%s units" % units)

# API
func get_market_price(item_id: String) -> int:
    return current_prices.get(item_id, 0)

func sell_cargo(player, item_id, amount):
    var price = get_market_price(item_id)
    var total = price * amount
    player.receive_payment(total)
    print("[MARKET] SOLD %s x%s @ $%s" % [item_id, amount, price])

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 31
path: scripts\tests\test_economy_core.gd
bytes: 1914
sha256: FA93CC877FAEA8E0E82194F69D180F46807020E6D753A31CCEBA979D72E74A9B
<<< CONTENT >>>
extends Node

# Explicit loads for headless stability
const EconomyEngine = preload("res://scripts/core/economy_engine.gd")
const TradeGood = preload("res://scripts/resources/trade_good.gd")

func _ready():
    print("--- STARTING ECONOMY INTEGRATION TESTS ---")
    run_all_tests()
    print("--- TESTS COMPLETE ---")
    get_tree().quit() # Auto-close on success

func run_all_tests():
    test_affordability_check()
    test_cargo_limits()
    test_price_algorithm()

func test_affordability_check():
    var balance = 1000
    var price = 50
    var can_buy_10 = EconomyEngine.can_afford(balance, price, 10)
    var can_buy_25 = EconomyEngine.can_afford(balance, price, 25)
    _assert(can_buy_10 == true, "Affordability: Should afford 10 items")
    _assert(can_buy_25 == false, "Affordability: Should NOT afford 25 items")

func test_cargo_limits():
    var max_vol = 100.0
    var current_vol = 90.0
    var item_vol = 2.0
    var can_fit_4 = EconomyEngine.has_cargo_space(current_vol, max_vol, item_vol, 4)
    var can_fit_6 = EconomyEngine.has_cargo_space(current_vol, max_vol, item_vol, 6)
    _assert(can_fit_4 == true, "Cargo: Should fit 4 units")
    _assert(can_fit_6 == false, "Cargo: Should NOT fit 6 units")

func test_price_algorithm():
    # Instantiate the Resource manually
    var iron = TradeGood.new()
    iron.base_price = 100
    
    # We pass the object. The Engine treats it as a generic Resource.
    var cheap_price = EconomyEngine.calculate_price(iron, 200, 100)
    var high_price = EconomyEngine.calculate_price(iron, 50, 100)
    
    _assert(cheap_price < 100, "Economics: High supply should lower price (Got: %s)" % cheap_price)
    _assert(high_price > 100, "Economics: Low supply should raise price (Got: %s)" % high_price)

func _assert(condition: bool, message: String):
    if condition:
        print("[PASS] " + message)
    else:
        printerr("[FAIL] " + message)

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 32
path: scripts\tests\test_galaxy_core.gd
bytes: 1442
sha256: 3A5F8309263DA6C6F7B9308BBC4665BF2F6C7E38BF78352FD716971823680668
<<< CONTENT >>>
extends Node

# Explicit Preloads for Headless Stability
const Sector = preload("res://scripts/resources/sector.gd")
const GalaxyGraph = preload("res://scripts/core/galaxy_graph.gd")

func _ready():
    print("--- STARTING GALAXY NAVIGATION TESTS ---")
    run_tests()
    print("--- GALAXY TESTS COMPLETE ---")
    get_tree().quit()

func run_tests():
    # SETUP: Create a Map: A <-> B <-> C
    var graph = GalaxyGraph.new()
    
    var s1 = Sector.new(); s1.id = "A"; graph.add_sector(s1)
    var s2 = Sector.new(); s2.id = "B"; graph.add_sector(s2)
    var s3 = Sector.new(); s3.id = "C"; graph.add_sector(s3)
    
    graph.connect_sectors("A", "B")
    graph.connect_sectors("B", "C")
    
    # TEST 1: Direct Neighbor
    var route_ab = graph.get_route("A", "B")
    _assert(route_ab.size() == 2, "Path A->B should be 2 steps. Got: %s" % str(route_ab))
    
    # TEST 2: Multi-Jump
    var route_ac = graph.get_route("A", "C")
    _assert(route_ac.size() == 3, "Path A->C should be 3 steps (A,B,C). Got: %s" % str(route_ac))
    
    # TEST 3: Invalid Path (Isolated Node)
    var s4 = Sector.new(); s4.id = "D"; graph.add_sector(s4) # D is alone
    var route_ad = graph.get_route("A", "D")
    _assert(route_ad.size() == 0, "Path A->D should be empty. Got: %s" % str(route_ad))

func _assert(condition: bool, message: String):
    if condition:
        print("[PASS] " + message)
    else:
        printerr("[FAIL] " + message)

<<< END FILE >>>

=== OMITTED FILES (NOT INLINED) ===
omitted_count: 0
===================================

=== ERRORS ===
error_count: 0
==============

=== DUMP SUMMARY ===
inline_file_count: 32
inline_total_bytes: 159117
third_party_dirs_referenced: addons, third_party, vendor, externals, external
max_inline_bytes: 52428800
====================

=== END OF DUMP ===


<<< END FILE >>>

<<< BEGIN FILE >>>
index: 2
path: _PROJECT_CONTEXT.md
bytes: 2512
sha256: 69AD0AD0FC02454500C0A13CA382849FBADCC407446B8B1328D6A7F67B912C86
<<< CONTENT >>>
# SPACE TRADE EMPIRE - MASTER CONTEXT
# ===================================

## 1. THE FOUNDER PROTOCOL
# ------------------------
# - **Voice:** Pragmatic, Commercial, Technical.
# - **Output:** Direct Code Blocks -> Implementation Steps -> Verification.
# - **Meta-Rule:** If the project structure changes significantly (new systems), you MUST propose an updated version of this file.

## 2. RECOVERY & TOOLCHAIN
# ------------------------
# [DevTools Recovery Block]
#   If `DevTool.ps1` is lost, write a script that:
#   1. Concatenates all .gd/.tscn files into `_FullProjectContext.txt`.
#   2. Wraps `git add/commit` and `git reset --hard` into GUI buttons.
#
# [PhantomCamera Status]
#   The `addons/phantom_camera` folder may exist on disk, but it is not enabled as a plugin and no autoload is configured.
#   Do not use PhantomCamera unless we explicitly choose it and update this document.
## 3. ARCHITECTURE & STANDARDS (STRICT)
# -------------------------------------
# - **File Org:**
#     - `/scenes`: Visuals & Prefabs.
#     - `/scripts`: Logic.
#     - `/assets`: Raw imports (models, sounds).
# - **Naming:** #     - Nodes: PascalCase (e.g., `ScoreLabel`).
#     - Scripts/Files: snake_case (e.g., `game_manager.gd`).
# - **Design Patterns:**
#     - **Signal Bus (CURRENT):** Use direct signals for now (e.g., Player -> HUD). Add an Autoload bus only when two unrelated systems need it.
#     - **Composition:** Avoid deep inheritance. Use Child Nodes to add features.
# - **Camera Law (ACTIVE)**
#     - Camera is defined in `scenes/player.tscn` at `CameraMount/Camera3D`.
#     - No runtime camera creation in scripts. (`Camera3D.new()` is banned in gameplay code.)
#     - Only `scripts/player.gd` may set `my_camera.current = true`, and only for `CameraMount/Camera3D`.
#     - No other scene may define a gameplay camera without an explicit decision and doc update.
#     - Debug cameras must live in dedicated debug-only scenes (never attached to production nodes).

## 4. CURRENT SPRINT STATUS
# -------------------------
# - **Phase:** Phase 0 Cleanup (truth alignment + hygiene)
# - **Done:**
#     - Player camera is scene-defined at `scenes/player.tscn` -> `CameraMount/Camera3D`.
#     - No runtime camera spawning in gameplay scripts.
#     - PhantomCamera plugin and autoload are disabled in `project.godot` (addon may exist on disk).
# - **Next (Phase 1):** Economy spine unification and 2-station arbitrage loop (buy, haul, sell).

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 3
path: DevTool - Copy.ps1
bytes: 7502
sha256: 722D8AA673A8F6C54081D8840232136D8DCE0DE95CAF4593695C277CF4769776
<<< CONTENT >>>
<#
.SYNOPSIS
    SPACE TRADE EMPIRE - MISSION CONTROL (v4.2)
    Fix: Strict Type Casting for Godot Path to prevent array errors.
#>

Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# --- CONFIGURATION ---
$ProjectRoot = Get-Location
$ContextFile = Join-Path $ProjectRoot "_FullProjectContext.txt"
$TestScene   = "scenes/tests/test_economy_core.tscn"
$ConfigPath  = Join-Path $ProjectRoot "godot_path.cfg"

# --- GUI SETUP ---
$form = New-Object System.Windows.Forms.Form
$form.Text = "STE :: Mission Control v4.2"
$form.Size = New-Object System.Drawing.Size(450, 520)
$form.StartPosition = "CenterScreen"
$form.BackColor = "#1e1e1e"
$form.ForeColor = "#ffffff"

$fontHeader = New-Object System.Drawing.Font("Consolas", 12, [System.Drawing.FontStyle]::Bold)
$fontNormal = New-Object System.Drawing.Font("Segoe UI", 10, [System.Drawing.FontStyle]::Bold)
$fontLog    = New-Object System.Drawing.Font("Consolas", 9)

# --- LOGIC ---

function Log-Output($message) {
    $txtOutput.AppendText("[$((Get-Date).ToString('HH:mm:ss'))] $message`r`n")
    $txtOutput.ScrollToCaret()
}

function Get-GodotExe {
    $exePath = $null

    # 1. Check saved config
    if (Test-Path $ConfigPath) {
        $raw = Get-Content $ConfigPath -Raw
        if ($raw) { $exePath = $raw.Trim() }
    }

    # 2. If valid, return immediately
    if ($exePath -and (Test-Path $exePath)) { 
        return $exePath 
    }

    # 3. If invalid, ask user
    [System.Windows.Forms.MessageBox]::Show("Godot executable not found.`n`nPlease select your godot.exe file.", "Setup Required")
    
    $dlg = New-Object System.Windows.Forms.OpenFileDialog
    $dlg.Title = "SELECT GODOT EXECUTABLE (godot.exe)"
    $dlg.Filter = "Executable|*.exe"
    
    if ($dlg.ShowDialog() -eq "OK") {
        $exePath = $dlg.FileName
        Set-Content -Path $ConfigPath -Value $exePath
        return $exePath
    }
    
    return $null
}

function Run-Tests {
    Log-Output ">>> EXEC: ECONOMY TEST SUITE"
    
    # FORCE STRING CAST (The Fix)
    # We take the last item in case pipeline pollution occurred
    $godotRaw = Get-GodotExe
    $godotExe = @($godotRaw)[-1] 

    if (-not $godotExe -or -not (Test-Path $godotExe)) {
        Log-Output "ERROR: Godot path missing or invalid."
        return
    }

    Log-Output "Target: $godotExe"

    try {
        Log-Output "Running simulation..."
        # Runs Godot in headless mode (-s) or standard, waiting for exit
        $process = Start-Process -FilePath "$godotExe" -ArgumentList "$TestScene" -NoNewWindow -Wait -PassThru
        
        if ($process.ExitCode -eq 0) {
            Log-Output "Cycle Complete. Check Console window."
        } else {
            Log-Output "WARNING: Process exited with code $($process.ExitCode)"
        }
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

function Run-ContextGen {
    Log-Output ">>> EXEC: SMART CONTEXT DUMP"
    try {
        $content = "=== SPACE TRADE EMPIRE PROJECT DUMP ===`n"
        $content += "dump_timestamp: $(Get-Date)`n`n"
        
        $content += "=== LIVE PROJECT STRUCTURE ===`n"
        try {
            $tree = Get-ChildItem -Path $ProjectRoot -Recurse | 
                Where-Object { $_.FullName -notmatch "\\.godot|\\.git|\\.import" } |
                ForEach-Object { 
                    $rel = $_.FullName.Replace($ProjectRoot.Path, "")
                    $indent = "  " * ($rel.Split('\').Count - 1)
                    if ($_.PSIsContainer) { "+ $indent[$($_.Name)]" } else { "- $indent$($_.Name)" }
                }
            $content += $tree
        } catch {}
        $content += "`n================================`n"

        $files = Get-ChildItem -Path $ProjectRoot -Recurse -Include *.gd, *.tscn, *.shader, *.ps1 | 
                 Where-Object { $_.FullName -notmatch ".git" -and $_.FullName -notmatch ".import" }

        foreach ($file in $files) {
            $relPath = $file.FullName.Replace($ProjectRoot.Path, "")
            $content += "`n--- FILE: $relPath ---`n"
            $content += "---------------------------------`n"
            $content += Get-Content $file.FullName -Raw
            $content += "`n"
        }
        
        Set-Content -Path $ContextFile -Value $content -Encoding UTF8
        Log-Output "SUCCESS: Context refreshed."
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

function Run-GitSave {
    Log-Output ">>> EXEC: GIT SNAPSHOT"
    git add .
    $res = git commit -m "Manual Save Point $(Get-Date)" 2>&1
    Log-Output $res
    Log-Output "State Saved."
}

function Run-GitReset {
    $confirm = [System.Windows.Forms.MessageBox]::Show("NUKE IT? This reverts to the last SAVE.", "DANGER ZONE", [System.Windows.Forms.MessageBoxButtons]::YesNo, [System.Windows.Forms.MessageBoxIcon]::Warning)
    if ($confirm -eq "Yes") {
        Log-Output ">>> EXEC: HARD RESET"
        git reset --hard 2>&1 | Out-Null
        git clean -fd 2>&1 | Out-Null
        Log-Output "SUCCESS: Time machine activated. Changes reverted."
    }
}

# --- UI COMPONENTS ---

# Header
$lblHeader = New-Object System.Windows.Forms.Label
$lblHeader.Text = "COMMAND DECK"
$lblHeader.Location = New-Object System.Drawing.Point(20, 10)
$lblHeader.Font = $fontHeader
$lblHeader.AutoSize = $true
$form.Controls.Add($lblHeader)

# 1. TEST (Blue)
$btnTest = New-Object System.Windows.Forms.Button
$btnTest.Text = "1. RUN UNIT TESTS"
$btnTest.Location = New-Object System.Drawing.Point(20, 40)
$btnTest.Size = New-Object System.Drawing.Size(400, 45)
$btnTest.Font = $fontNormal
$btnTest.BackColor = "#007acc"
$btnTest.ForeColor = "White"
$btnTest.FlatStyle = "Flat"
$btnTest.Add_Click({ Run-Tests })
$form.Controls.Add($btnTest)

# 2. DUMP (Gray)
$btnContext = New-Object System.Windows.Forms.Button
$btnContext.Text = "2. GENERATE CONTEXT"
$btnContext.Location = New-Object System.Drawing.Point(20, 95)
$btnContext.Size = New-Object System.Drawing.Size(400, 45)
$btnContext.Font = $fontNormal
$btnContext.BackColor = "#2d2d30"
$btnContext.ForeColor = "White"
$btnContext.FlatStyle = "Flat"
$btnContext.Add_Click({ Run-ContextGen })
$form.Controls.Add($btnContext)

# 3. SAVE (Green)
$btnSave = New-Object System.Windows.Forms.Button
$btnSave.Location = New-Object System.Drawing.Point(20, 150)
$btnSave.Size = New-Object System.Drawing.Size(195, 45)
$btnSave.Text = "3. SAVE STATE"
$btnSave.BackColor = "#228822"
$btnSave.ForeColor = "White"
$btnSave.Font = $fontNormal
$btnSave.FlatStyle = "Flat"
$btnSave.Add_Click({ Run-GitSave })
$form.Controls.Add($btnSave)

# 4. RESET (Red)
$btnUndo = New-Object System.Windows.Forms.Button
$btnUndo.Location = New-Object System.Drawing.Point(225, 150)
$btnUndo.Size = New-Object System.Drawing.Size(195, 45)
$btnUndo.Text = "4. HARD RESET"
$btnUndo.BackColor = "#cc2222"
$btnUndo.ForeColor = "White"
$btnUndo.Font = $fontNormal
$btnUndo.FlatStyle = "Flat"
$btnUndo.Add_Click({ Run-GitReset })
$form.Controls.Add($btnUndo)

# Console Output
$txtOutput = New-Object System.Windows.Forms.TextBox
$txtOutput.Location = New-Object System.Drawing.Point(20, 210)
$txtOutput.Size = New-Object System.Drawing.Size(400, 250)
$txtOutput.Multiline = $true
$txtOutput.ScrollBars = "Vertical"
$txtOutput.BackColor = "#000000"
$txtOutput.ForeColor = "#00ff00"
$txtOutput.Font = $fontLog
$txtOutput.Text = "Mission Control v4.2 Online...`r`n"
$form.Controls.Add($txtOutput)

# --- LAUNCH ---
$form.Add_Shown({ $form.Activate() })
[void] $form.ShowDialog()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 4
path: DevTool.ps1
bytes: 19105
sha256: 95954056E9EB5BF7509D9627A705DBA882A3A84A1993742D8A6DD0FBFE81135C
<<< CONTENT >>>
<#
SPACE TRADE EMPIRE - MISSION CONTROL (v5.0)

What changed vs v4.2
- Keeps all existing buttons + behavior (tests, save, reset, GUI)
- Context dump now:
  - Inlines first-party: .gd .tscn .shader .ps1 project.godot export_presets.cfg .tres .res .cfg .ini .md .txt .json .csv .yml .yaml
  - References 3rd party dirs (inventory + appears in tree) but does NOT inline their contents
  - Adds per-file bytes + SHA256 + deterministic ordering
  - Adds omitted/errors lists + END OF DUMP marker
  - Excludes editor/system junk: .git .import .godot
  - Excludes the dump file itself from being re-inlined
- Adds strong provenance: script path + script hash written into the dump header

How to install correctly (do this exactly)
1) Save THIS file as: C:\Users\marsh\Documents\Space Trade Empire\DevTool.ps1
2) In PowerShell, verify it is v5.0:
   Select-String -Path .\DevTool.ps1 -Pattern "v4\.2","v5\.0" | ft LineNumber,Line -AutoSize
   (should show v5.0, nothing for v4.2)
3) Run it:
   powershell.exe -NoProfile -ExecutionPolicy Bypass -File .\DevTool.ps1

If you still see v4.2 after that, you did not overwrite the right file.
#>

Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# --- CONFIGURATION ---
$ProjectRoot = Get-Location
$ContextFile = Join-Path $ProjectRoot "_FullProjectContext.txt"
$TestScene   = "scenes/tests/test_economy_core.tscn"
$ConfigPath  = Join-Path $ProjectRoot "godot_path.cfg"
$DevToolVersion = "5.0"

# --- GUI SETUP ---
$form = New-Object System.Windows.Forms.Form
$form.Text = "STE :: Mission Control v$DevToolVersion"
$form.Size = New-Object System.Drawing.Size(450, 520)
$form.StartPosition = "CenterScreen"
$form.BackColor = "#1e1e1e"
$form.ForeColor = "#ffffff"

$fontHeader = New-Object System.Drawing.Font("Consolas", 12, [System.Drawing.FontStyle]::Bold)
$fontNormal = New-Object System.Drawing.Font("Segoe UI", 10, [System.Drawing.FontStyle]::Bold)
$fontLog    = New-Object System.Drawing.Font("Consolas", 9)

# Console Output (declared early so Log-Output can be used anywhere)
$txtOutput = New-Object System.Windows.Forms.TextBox
$txtOutput.Location = New-Object System.Drawing.Point(20, 210)
$txtOutput.Size = New-Object System.Drawing.Size(400, 250)
$txtOutput.Multiline = $true
$txtOutput.ScrollBars = "Vertical"
$txtOutput.BackColor = "#000000"
$txtOutput.ForeColor = "#00ff00"
$txtOutput.Font = $fontLog
$txtOutput.Text = "Mission Control v$DevToolVersion Online...`r`n"
$form.Controls.Add($txtOutput)

function Log-Output($message) {
    $txtOutput.AppendText("[$((Get-Date).ToString('HH:mm:ss'))] $message`r`n")
    $txtOutput.ScrollToCaret()
}

function Get-GodotExe {
    $exePath = $null

    if (Test-Path $ConfigPath) {
        $raw = Get-Content $ConfigPath -Raw
        if ($raw) { $exePath = $raw.Trim() }
    }

    if ($exePath -and (Test-Path $exePath)) {
        return $exePath
    }

    [System.Windows.Forms.MessageBox]::Show("Godot executable not found.`n`nPlease select your godot.exe file.", "Setup Required")

    $dlg = New-Object System.Windows.Forms.OpenFileDialog
    $dlg.Title = "SELECT GODOT EXECUTABLE (godot.exe)"
    $dlg.Filter = "Executable|*.exe"

    if ($dlg.ShowDialog() -eq "OK") {
        $exePath = $dlg.FileName
        Set-Content -Path $ConfigPath -Value $exePath
        return $exePath
    }

    return $null
}

function Run-Tests {
    Log-Output ">>> EXEC: ECONOMY TEST SUITE"

    $godotRaw = Get-GodotExe
    $godotExe = @($godotRaw)[-1]

    if (-not $godotExe -or -not (Test-Path $godotExe)) {
        Log-Output "ERROR: Godot path missing or invalid."
        return
    }

    Log-Output "Target: $godotExe"

    try {
        Log-Output "Running simulation..."
        $process = Start-Process -FilePath "$godotExe" -ArgumentList "$TestScene" -NoNewWindow -Wait -PassThru

        if ($process.ExitCode -eq 0) {
            Log-Output "Cycle Complete. Check Console window."
        } else {
            Log-Output "WARNING: Process exited with code $($process.ExitCode)"
        }
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

# ----------------------------
# CONTEXT DUMP HELPERS
# ----------------------------

function Normalize-RelPath([string]$fullPath) {
    $rp = $fullPath.Replace($ProjectRoot.Path, "")
    $rp = $rp.TrimStart("\","/")
    return $rp -replace "/", "\"
}

function Is-UnderAnyDir([string]$fullPath, [string[]]$dirNames) {
    foreach ($d in $dirNames) {
        if ($fullPath -match [regex]::Escape("\$d\") -or $fullPath.EndsWith("\$d")) { return $true }
        if ($fullPath -match [regex]::Escape("/$d/") -or $fullPath.EndsWith("/$d")) { return $true }
    }
    return $false
}

function Get-Sha256([string]$path) {
    try {
        return (Get-FileHash -Algorithm SHA256 -Path $path).Hash
    } catch {
        return "HASH_ERROR"
    }
}

function Try-ReadText([string]$path) {
    try {
        return Get-Content -Path $path -Raw -ErrorAction Stop
    } catch {
        return $null
    }
}

function Build-TreeListing([string]$rootPath, [string[]]$treeExclusionRegex) {
    $lines = New-Object System.Collections.Generic.List[string]
    try {
        $items = Get-ChildItem -Path $rootPath -Recurse -Force -ErrorAction Stop
        foreach ($it in $items) {
            $full = $it.FullName
            $excluded = $false
            foreach ($rx in $treeExclusionRegex) {
                if ($full -match $rx) { $excluded = $true; break }
            }
            if ($excluded) { continue }

            $rel = Normalize-RelPath $full
            $depth = ($rel.Split('\').Count - 1)
            $indent = "  " * $depth
            if ($it.PSIsContainer) {
                $lines.Add("+ $indent[$($it.Name)]")
            } else {
                $lines.Add("- $indent$($it.Name)")
            }
        }
    } catch {
        $lines.Add("TREE_ERROR: $($_.Exception.Message)")
    }
    return $lines
}

function Summarize-DirInventory([string]$dirPath, [string]$label, [string[]]$excludeRegexForCounting) {
    $summary = [ordered]@{
        label = $label
        path  = (Normalize-RelPath $dirPath)
        file_count = 0
        total_bytes = 0
        top_extensions = @()
    }

    if (-not (Test-Path $dirPath)) { return $summary }

    $extCount = @{}
    try {
        $files = Get-ChildItem -Path $dirPath -Recurse -File -Force -ErrorAction Stop | Where-Object {
            $ok = $true
            foreach ($rx in $excludeRegexForCounting) {
                if ($_.FullName -match $rx) { $ok = $false; break }
            }
            $ok
        }
        $summary.file_count = $files.Count
        $summary.total_bytes = ($files | Measure-Object -Property Length -Sum).Sum

        foreach ($f in $files) {
            $e = [IO.Path]::GetExtension($f.Name).ToLowerInvariant()
            if (-not $e) { $e = "<none>" }
            if (-not $extCount.ContainsKey($e)) { $extCount[$e] = 0 }
            $extCount[$e]++
        }

        $top = $extCount.GetEnumerator() | Sort-Object -Property Value -Descending | Select-Object -First 12
        $summary.top_extensions = $top | ForEach-Object { "$($_.Key):$($_.Value)" }
    } catch {
        $summary.top_extensions = @("INVENTORY_ERROR:$($_.Exception.Message)")
    }

    return $summary
}

function Run-ContextGen {
    Log-Output ">>> EXEC: FULL CONTEXT DUMP (SCOPED, VERIFIED)"

    # Text extensions we embed
    $IncludeExtensions = @(
        ".gd", ".tscn", ".shader", ".ps1",
        ".godot",
        ".tres", ".res",
        ".cfg", ".ini",
        ".md", ".txt",
        ".json", ".csv", ".tsv",
        ".yml", ".yaml"
    )

    # Always include these if present
    $AlwaysIncludeRel = @(
        "project.godot",
        "export_presets.cfg",
        "_PROJECT_CONTEXT.md"
    )

    # Exclude from embedded text dump (but still referenced in inventory + tree)
    $ThirdPartyDirs = @("addons", "third_party", "vendor", "externals", "external")

    # Exclude from everything (tree + inline + inventory)
    $HardExcludeRegex = @(
        "\\.git\\", "/\.git/",
        "\\.import\\", "/\.import/",
        "\\.godot\\", "/\.godot/"
    )

    # For TREE view, hide only system folders. Keep third party visible.
    $TreeExcludeRegex = $HardExcludeRegex

    # Very high cap to avoid surprising first-party omissions.
    # If you want truly unlimited, set this to [int64]::MaxValue
    $MaxInlineBytes = 50MB

    $errors = New-Object System.Collections.Generic.List[string]
    $omitted = New-Object System.Collections.Generic.List[string]

    try {
        $scriptHash = if ($PSCommandPath -and (Test-Path $PSCommandPath)) { (Get-FileHash -Algorithm SHA256 -Path $PSCommandPath).Hash } else { "UNKNOWN" }

        $header = New-Object System.Text.StringBuilder
        $null = $header.AppendLine("=== SPACE TRADE EMPIRE PROJECT DUMP ===")
        $null = $header.AppendLine("format_version: $DevToolVersion")
        $null = $header.AppendLine("dump_timestamp: $(Get-Date -Format o)")
        $null = $header.AppendLine("project_root: $($ProjectRoot.Path)")
        $null = $header.AppendLine("devtool_path: $PSCommandPath")
        $null = $header.AppendLine("devtool_sha256: $scriptHash")
        $null = $header.AppendLine("max_inline_bytes: $MaxInlineBytes")
        $null = $header.AppendLine()

        # Project tree
        $null = $header.AppendLine("=== LIVE PROJECT STRUCTURE (SYSTEM FOLDERS HIDDEN) ===")
        $treeLines = Build-TreeListing -rootPath $ProjectRoot -treeExclusionRegex $TreeExcludeRegex
        foreach ($line in $treeLines) { $null = $header.AppendLine($line) }
        $null = $header.AppendLine("========================================")
        $null = $header.AppendLine()

        # Third party inventory
        $null = $header.AppendLine("=== THIRD PARTY / EXTERNAL INVENTORY (REFERENCED, NOT INLINED) ===")
        $null = $header.AppendLine("third_party_dirs: " + ($ThirdPartyDirs -join ", "))
        foreach ($d in $ThirdPartyDirs) {
            $p = Join-Path $ProjectRoot $d
            if (Test-Path $p) {
                $inv = Summarize-DirInventory -dirPath $p -label "third_party" -excludeRegexForCounting $HardExcludeRegex
                $null = $header.AppendLine("INVENTORY: $($inv.path)")
                $null = $header.AppendLine("  file_count: $($inv.file_count)")
                $null = $header.AppendLine("  total_bytes: $($inv.total_bytes)")
                $null = $header.AppendLine("  top_extensions: $($inv.top_extensions -join ', ')")
            }
        }
        $null = $header.AppendLine("========================================")
        $null = $header.AppendLine()

        # Discover files
        $allFiles = Get-ChildItem -Path $ProjectRoot -Recurse -File -Force -ErrorAction Stop

        # Always include set
        $alwaysFull = @()
        foreach ($rel in $AlwaysIncludeRel) {
            $fp = Join-Path $ProjectRoot $rel
            if (Test-Path $fp) { $alwaysFull += (Get-Item $fp).FullName }
        }

        $inlineFiles = New-Object System.Collections.Generic.List[System.IO.FileInfo]

        foreach ($f in $allFiles) {
            $full = $f.FullName

            # Exclude system
            $hardExcluded = $false
            foreach ($rx in $HardExcludeRegex) {
                if ($full -match $rx) { $hardExcluded = $true; break }
            }
            if ($hardExcluded) { continue }

            # Never inline the dump itself (avoids self-omission noise)
            if ($full -ieq $ContextFile) { continue }

            # Exclude third party from inline
            if (Is-UnderAnyDir -fullPath $full -dirNames $ThirdPartyDirs) { continue }

            $ext = [IO.Path]::GetExtension($f.Name).ToLowerInvariant()

            if ($alwaysFull -contains $full) {
                $inlineFiles.Add($f)
                continue
            }

            if ($IncludeExtensions -contains $ext) {
                $inlineFiles.Add($f)
            }
        }

        $inlineFilesSorted = $inlineFiles | Sort-Object -Property FullName

        # Build dump
        $sb = New-Object System.Text.StringBuilder
        $null = $sb.Append($header.ToString())

        $null = $sb.AppendLine("=== INLINE FILE MANIFEST (NON-3RD-PARTY) ===")
        $null = $sb.AppendLine("inline_file_count: $($inlineFilesSorted.Count)")
        $null = $sb.AppendLine("===========================================")
        $null = $sb.AppendLine()

        $totalInlineBytes = 0
        $fileIndex = 0

        foreach ($file in $inlineFilesSorted) {
            $fileIndex++
            $relPath = Normalize-RelPath $file.FullName
            $size = $file.Length
            $hash = Get-Sha256 $file.FullName

            $null = $sb.AppendLine("<<< BEGIN FILE >>>")
            $null = $sb.AppendLine("index: $fileIndex")
            $null = $sb.AppendLine("path: $relPath")
            $null = $sb.AppendLine("bytes: $size")
            $null = $sb.AppendLine("sha256: $hash")
            $null = $sb.AppendLine("<<< CONTENT >>>")

            if ($size -gt $MaxInlineBytes) {
                $omitted.Add("OMITTED_TOO_LARGE|$relPath|bytes=$size|sha256=$hash")
                $null = $sb.AppendLine("[OMITTED: file exceeds max_inline_bytes. See OMITTED FILES section.]")
                $null = $sb.AppendLine("<<< END FILE >>>")
                $null = $sb.AppendLine()
                continue
            }

            $text = Try-ReadText $file.FullName
            if ($null -eq $text) {
                $errors.Add("READ_ERROR|$relPath|bytes=$size|sha256=$hash")
                $null = $sb.AppendLine("[ERROR: could not read file as text. See ERRORS section.]")
                $null = $sb.AppendLine("<<< END FILE >>>")
                $null = $sb.AppendLine()
                continue
            }

            $null = $sb.AppendLine($text)
            if (-not $text.EndsWith("`n")) { $null = $sb.AppendLine() }
            $null = $sb.AppendLine("<<< END FILE >>>")
            $null = $sb.AppendLine()

            $totalInlineBytes += $size
        }

        $null = $sb.AppendLine("=== OMITTED FILES (NOT INLINED) ===")
        $null = $sb.AppendLine("omitted_count: $($omitted.Count)")
        foreach ($o in $omitted) { $null = $sb.AppendLine($o) }
        $null = $sb.AppendLine("===================================")
        $null = $sb.AppendLine()

        $null = $sb.AppendLine("=== ERRORS ===")
        $null = $sb.AppendLine("error_count: $($errors.Count)")
        foreach ($e in $errors) { $null = $sb.AppendLine($e) }
        $null = $sb.AppendLine("==============")
        $null = $sb.AppendLine()

        $null = $sb.AppendLine("=== DUMP SUMMARY ===")
        $null = $sb.AppendLine("inline_file_count: $($inlineFilesSorted.Count)")
        $null = $sb.AppendLine("inline_total_bytes: $totalInlineBytes")
        $null = $sb.AppendLine("third_party_dirs_referenced: " + ($ThirdPartyDirs -join ", "))
        $null = $sb.AppendLine("max_inline_bytes: $MaxInlineBytes")
        $null = $sb.AppendLine("====================")
        $null = $sb.AppendLine()
        $null = $sb.AppendLine("=== END OF DUMP ===")

        Set-Content -Path $ContextFile -Value $sb.ToString() -Encoding UTF8 -ErrorAction Stop

        Log-Output "SUCCESS: Context refreshed."
        Log-Output "Inline files: $($inlineFilesSorted.Count) | Inline bytes: $totalInlineBytes | Omitted: $($omitted.Count) | Errors: $($errors.Count)"
        Log-Output "Dump: $ContextFile"
        Log-Output "Script: $PSCommandPath"
    }
    catch {
        Log-Output "ERROR: $($_.Exception.Message)"
    }
}

function Run-GitSave {
    Log-Output ">>> EXEC: GIT SNAPSHOT"
    git add .
    $res = git commit -m "Manual Save Point $((Get-Date).ToString('o'))" 2>&1
    Log-Output $res

    # Savepoint tag used by HARD RESET
    git tag -f ste_savepoint 2>&1 | Out-Null
    Log-Output "Savepoint updated: ste_savepoint"

    Log-Output "State Saved."
}

function Run-GitReset {
    $confirm = [System.Windows.Forms.MessageBox]::Show(
        "Reset tracked files back to the last SAVE (ste_savepoint)?",
        "DANGER ZONE",
        [System.Windows.Forms.MessageBoxButtons]::YesNo,
        [System.Windows.Forms.MessageBoxIcon]::Warning
    )

    if ($confirm -ne "Yes") { return }

    Log-Output ">>> EXEC: HARD RESET (to ste_savepoint)"

    $tag = (git rev-parse -q --verify ste_savepoint 2>$null)
    if (-not $tag) {
        Log-Output "ERROR: ste_savepoint not found. Click SAVE STATE once to create it."
        return
    }

    git reset --hard ste_savepoint 2>&1 | Out-Null
    Log-Output "Tracked files reset to ste_savepoint."

    $confirmClean = [System.Windows.Forms.MessageBox]::Show(
        "Also delete ALL untracked (non-ignored) files and folders (git clean -fd)?",
        "DELETE UNTRACKED FILES",
        [System.Windows.Forms.MessageBoxButtons]::YesNo,
        [System.Windows.Forms.MessageBoxIcon]::Warning
    )

    if ($confirmClean -eq "Yes") {
        git clean -fd 2>&1 | Out-Null
        Log-Output "Untracked files deleted."
    } else {
        Log-Output "Untracked files preserved."
    }

    Log-Output "SUCCESS: Reset complete."
}

# --- UI COMPONENTS ---

$lblHeader = New-Object System.Windows.Forms.Label
$lblHeader.Text = "COMMAND DECK"
$lblHeader.Location = New-Object System.Drawing.Point(20, 10)
$lblHeader.Font = $fontHeader
$lblHeader.AutoSize = $true
$form.Controls.Add($lblHeader)

$btnTest = New-Object System.Windows.Forms.Button
$btnTest.Text = "1. RUN UNIT TESTS"
$btnTest.Location = New-Object System.Drawing.Point(20, 40)
$btnTest.Size = New-Object System.Drawing.Size(400, 45)
$btnTest.Font = $fontNormal
$btnTest.BackColor = "#007acc"
$btnTest.ForeColor = "White"
$btnTest.FlatStyle = "Flat"
$btnTest.Add_Click({ Run-Tests })
$form.Controls.Add($btnTest)

$btnContext = New-Object System.Windows.Forms.Button
$btnContext.Text = "2. GENERATE CONTEXT"
$btnContext.Location = New-Object System.Drawing.Point(20, 95)
$btnContext.Size = New-Object System.Drawing.Size(400, 45)
$btnContext.Font = $fontNormal
$btnContext.BackColor = "#2d2d30"
$btnContext.ForeColor = "White"
$btnContext.FlatStyle = "Flat"
$btnContext.Add_Click({ Run-ContextGen })
$form.Controls.Add($btnContext)

$btnSave = New-Object System.Windows.Forms.Button
$btnSave.Location = New-Object System.Drawing.Point(20, 150)
$btnSave.Size = New-Object System.Drawing.Size(195, 45)
$btnSave.Text = "3. SAVE STATE"
$btnSave.BackColor = "#228822"
$btnSave.ForeColor = "White"
$btnSave.Font = $fontNormal
$btnSave.FlatStyle = "Flat"
$btnSave.Add_Click({ Run-GitSave })
$form.Controls.Add($btnSave)

$btnUndo = New-Object System.Windows.Forms.Button
$btnUndo.Location = New-Object System.Drawing.Point(225, 150)
$btnUndo.Size = New-Object System.Drawing.Size(195, 45)
$btnUndo.Text = "4. HARD RESET"
$btnUndo.BackColor = "#cc2222"
$btnUndo.ForeColor = "White"
$btnUndo.Font = $fontNormal
$btnUndo.FlatStyle = "Flat"
$btnUndo.Add_Click({ Run-GitReset })
$form.Controls.Add($btnUndo)

$form.Add_Shown({
    $form.Activate()
    Log-Output "DevTool path: $PSCommandPath"
})

[void] $form.ShowDialog()


<<< END FILE >>>

<<< BEGIN FILE >>>
index: 5
path: godot_path.cfg
bytes: 40
sha256: E260C63C14FB82B4D261960EE192BF1A27598566F46C6CF7564B2AE3AA48D531
<<< CONTENT >>>
C:\Godot\Godot_v4.5.1-stable_win64.exe

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 6
path: project.godot
bytes: 564
sha256: 7A475CFE7104C5993AA3BF112E9EFECA56E3C41EE442ACA35DEF590078E5DCDC
<<< CONTENT >>>
; Engine configuration file.
; It's best edited using the editor UI and not directly,
; since the parameters that go here are not all obvious.
;
; Format:
;   [section] ; section goes between []
;   param=value ; assign values to parameters

config_version=5

[application]

config/name="Space Trade Empire"
run/main_scene="res://scenes/main.tscn"
config/features=PackedStringArray("4.5", "Forward Plus")

[display]

window/size/viewport_width=1920
window/size/viewport_height=1080
window/stretch/mode="canvas_items"

[editor_plugins]

enabled=PackedStringArray()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 7
path: resources\commodities\gold.tres
bytes: 290
sha256: 50DEAEFB7C2B99198250799B34F2746A4C0EA981EAD13381ABAF173D3D775E1E
<<< CONTENT >>>
[gd_resource type="Resource" script_class="TradeGood" load_steps=2 format=3]

[ext_resource type="Script" path="res://scripts/resources/trade_good.gd" id="1_tg"]

[resource]
script = ExtResource("1_tg")
id = "ore_gold"
name = "Gold Ore"
base_price = 100
volume = 0.8
is_contraband = false

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 8
path: resources\commodities\iron.tres
bytes: 313
sha256: 1FDFEAC3F509FCDF42B22C5FE3A57EB3FB603952B2CAB4C0E75A58C94CA2F593
<<< CONTENT >>>
[gd_resource type="Resource" script_class="TradeGood" load_steps=2 format=3 uid="uid://tg_iron_001"]

[ext_resource type="Script" path="res://scripts/resources/trade_good.gd" id="1_tg"]

[resource]
script = ExtResource("1_tg")
id = "ore_iron"
name = "Iron Ore"
base_price = 45
volume = 0.5
is_contraband = false

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 9
path: resources\markets\station_alpha_profile.tres
bytes: 539
sha256: 76C4EE379432A2F15FA08808D1F1A454EF6500720E229FFCED4CE299D6E6F639
<<< CONTENT >>>
[gd_resource type="Resource" script_class="MarketProfile" load_steps=4 format=3]

[ext_resource type="Script" path="res://scripts/resources/market_profile.gd" id="1_mp"]
[ext_resource type="Resource" path="res://resources/commodities/iron.tres" id="2_iron"]
[ext_resource type="Resource" path="res://resources/commodities/gold.tres" id="3_gold"]

[resource]
script = ExtResource("1_mp")
station_name = "Alpha"
wealth_tier = 1.2
trade_goods = [ExtResource("2_iron"), ExtResource("3_gold")]
base_demands = {"ore_iron": 80, "ore_gold": 180}

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 10
path: resources\markets\station_beta_profile.tres
bytes: 538
sha256: D95003C0FF7B25DDEB17B1584B626A2CDE2A4B0C99F256273777DE1CD14144F0
<<< CONTENT >>>
[gd_resource type="Resource" script_class="MarketProfile" load_steps=4 format=3]

[ext_resource type="Script" path="res://scripts/resources/market_profile.gd" id="1_mp"]
[ext_resource type="Resource" path="res://resources/commodities/iron.tres" id="2_iron"]
[ext_resource type="Resource" path="res://resources/commodities/gold.tres" id="3_gold"]

[resource]
script = ExtResource("1_mp")
station_name = "Beta"
wealth_tier = 0.9
trade_goods = [ExtResource("2_iron"), ExtResource("3_gold")]
base_demands = {"ore_iron": 200, "ore_gold": 60}

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 11
path: scenes\asteroid.tscn
bytes: 820
sha256: 7497CB978E11CFE2F4EAECBE445546975CEA6EA1F2FD8186A4D44BA6D4444ED1
<<< CONTENT >>>
[gd_scene load_steps=5 format=3 uid="uid://asteroid_base_01"]

[ext_resource type="Script" path="res://scripts/asteroid.gd" id="1_rock"]

[sub_resource type="SphereShape3D" id="SphereShape3D_rock"]
radius = 2.0

[sub_resource type="SphereMesh" id="SphereMesh_rock"]
radius = 2.0
height = 4.0

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_grey"]
albedo_color = Color(0.4, 0.4, 0.4, 1)

[node name="Asteroid" type="StaticBody3D" groups=["Destructible"]]
collision_layer = 2
collision_mask = 0
script = ExtResource("1_rock")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("SphereShape3D_rock")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("SphereMesh_rock")
surface_material_override/0 = SubResource("StandardMaterial3D_grey")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 12
path: scenes\bullet.tscn
bytes: 807
sha256: 833770F44501088845389E358440EF4FBE0327B000D49427AF1B6D64503FA8B9
<<< CONTENT >>>
[gd_scene load_steps=5 format=3 uid="uid://projectile_01"]

[ext_resource type="Script" path="res://scripts/bullet.gd" id="1_b"]

[sub_resource type="BoxShape3D" id="BoxShape3D_b"]
size = Vector3(0.2, 0.2, 1.0)

[sub_resource type="BoxMesh" id="BoxMesh_b"]
size = Vector3(0.2, 0.2, 1.0)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_red"]
albedo_color = Color(1, 0, 0, 1)
emission_enabled = true
emission = Color(1, 0, 0, 1)
emission_energy_multiplier = 2.0

[node name="Bullet" type="Area3D"]
script = ExtResource("1_b")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_b")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("BoxMesh_b")
surface_material_override/0 = SubResource("StandardMaterial3D_red")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 13
path: scenes\enemy.tscn
bytes: 1206
sha256: 1915F48856F12284F778562CA2944F59ABE180D2C6F59678846397420C1A7A26
<<< CONTENT >>>
[gd_scene load_steps=7 format=3 uid="uid://enemy_drone_v2"]

[ext_resource type="Script" path="res://scripts/enemy.gd" id="1_ai"]

[sub_resource type="BoxShape3D" id="BoxShape3D_drone"]
size = Vector3(1.5, 1.5, 2.0)

[sub_resource type="PrismMesh" id="PrismMesh_drone"]
size = Vector3(1.5, 1.5, 2.0)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_hostile"]
albedo_color = Color(1, 0, 0, 1)

[sub_resource type="BoxMesh" id="BoxMesh_eye"]
size = Vector3(0.5, 0.5, 0.5)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_black"]
albedo_color = Color(0, 0, 0, 1)

[node name="EnemyDrone" type="CharacterBody3D"]
collision_layer = 2
collision_mask = 3
script = ExtResource("1_ai")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_drone")

[node name="Body" type="MeshInstance3D" parent="."]
mesh = SubResource("PrismMesh_drone")
surface_material_override/0 = SubResource("StandardMaterial3D_hostile")

[node name="CockpitEye" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.2, -1.0)
mesh = SubResource("BoxMesh_eye")
surface_material_override/0 = SubResource("StandardMaterial3D_black")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 14
path: scenes\main.tscn
bytes: 2525
sha256: B5D99D3565E20288B462A1321BE6EBBDFBED3DC53C7312ED07299FAF2E4BC713
<<< CONTENT >>>
[gd_scene load_steps=9 format=3 uid="uid://b8j24k1n5q2x"]

[ext_resource type="PackedScene" path="res://scenes/player.tscn" id="2_0wfyh"]
[ext_resource type="PackedScene" path="res://scenes/station.tscn" id="3_sugp2"]
[ext_resource type="PackedScene" path="res://scenes/asteroid.tscn" id="4_asteroid"]
[ext_resource type="PackedScene" path="res://scenes/ui_hud.tscn" id="4_jyhfs"]
[ext_resource type="Script" uid="uid://cdth7i21ieed5" path="res://scripts/spawner.gd" id="5_tbgi4"]
[ext_resource type="Resource" path="res://resources/markets/station_alpha_profile.tres" id="98_alpha_profile"]
[ext_resource type="Resource" path="res://resources/markets/station_beta_profile.tres" id="99_beta_profile"]

[sub_resource type="Environment" id="Environment_blue"]
background_mode = 1
background_color = Color(0, 0, 0.2, 1)
ambient_light_source = 2
ambient_light_color = Color(1, 1, 1, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_floor"]
albedo_color = Color(0.3, 0.3, 0.3, 1)

[sub_resource type="PlaneMesh" id="PlaneMesh_floor"]
material = SubResource("StandardMaterial3D_floor")
size = Vector2(100, 100)

[node name="Main" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_blue")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.5, 0.866025, 0, -0.866025, 0.5, 0, 10, 0)
shadow_enabled = true

[node name="ReferenceFloor" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -2, 0)
mesh = SubResource("PlaneMesh_floor")

[node name="Asteroid" parent="." instance=ExtResource("4_asteroid")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -10)

[node name="Player" parent="." instance=ExtResource("2_0wfyh")]

[node name="Station" parent="." instance=ExtResource("3_sugp2")]

market_profile = ExtResource("98_alpha_profile")
local_supply = {"ore_iron": 120, "ore_gold": 15}
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 8.094528, 0.91242695, -15.825881)

[node name="HUD" parent="." instance=ExtResource("4_jyhfs")]

[node name="Spawner" type="Node3D" parent="."]
script = ExtResource("5_tbgi4")
asteroid_scene = ExtResource("4_asteroid")

[node name="StationBeta" parent="." instance=ExtResource("3_sugp2")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -12.0, 0.9, 18.0)
market_profile = ExtResource("99_beta_profile")
local_supply = {"ore_iron": 25, "ore_gold": 140}


<<< END FILE >>>

<<< BEGIN FILE >>>
index: 15
path: scenes\player.tscn
bytes: 1283
sha256: 664CF3764D544CEB8D76A907936E67F98857D4F13A007D7B8D905CD49E9687D8
<<< CONTENT >>>
[gd_scene load_steps=4 format=3 uid="uid://player_asset_01"]

[ext_resource type="Script" path="res://scripts/player.gd" id="1_script"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_hitbox"]
radius = 1.0
height = 2.0

[sub_resource type="CapsuleMesh" id="CapsuleMesh_visual"]
radius = 1.0
height = 2.0

[node name="Player" type="CharacterBody3D"]

trade_goods = [ExtResource("91_iron"), ExtResource("92_gold")]
max_cargo_volume = 10.0
collision_layer = 1
collision_mask = 1
script = ExtResource("1_script")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
shape = SubResource("CapsuleShape3D_hitbox")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
mesh = SubResource("CapsuleMesh_visual")

[node name="CameraMount" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.906308, 0.422618, 0, -0.422618, 0.906308, 0, 3, 5)

[node name="Camera3D" type="Camera3D" parent="CameraMount"]

[ext_resource type="Resource" path="res://resources/commodities/iron.tres" id="91_iron"]
[ext_resource type="Resource" path="res://resources/commodities/gold.tres" id="92_gold"]


<<< END FILE >>>

<<< BEGIN FILE >>>
index: 16
path: scenes\station.tscn
bytes: 763
sha256: 42AE952D456EF86A598C59B005BF0DCA02ED89BAA835D4D9B32CE3079EF57A4A
<<< CONTENT >>>
[gd_scene load_steps=4 format=3 uid="uid://station_alpha_01"]

[ext_resource type="Script" path="res://scripts/station.gd" id="1_stn"]

[sub_resource type="BoxShape3D" id="BoxShape3D_dock"]
size = Vector3(10, 5, 10)

[sub_resource type="BoxMesh" id="BoxMesh_station"]
size = Vector3(10, 5, 10)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_green"]
transparency = 1
albedo_color = Color(0, 1, 0, 0.3)

[node name="Station" type="Area3D"]
script = ExtResource("1_stn")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("BoxShape3D_dock")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("BoxMesh_station")
surface_material_override/0 = SubResource("StandardMaterial3D_green")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 17
path: scenes\tests\test_economy_core.tscn
bytes: 218
sha256: 80A54139698AE93EA99B0CA38B7A22C9D962F733F4C246C37401D6DAE83EEBFB
<<< CONTENT >>>
[gd_scene load_steps=2 format=3 uid="uid://test_econ_01"]

[ext_resource type="Script" path="res://scripts/tests/test_economy_core.gd" id="1_test"]

[node name="TestRunner" type="Node"]
script = ExtResource("1_test")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 18
path: scenes\tests\test_galaxy_core.tscn
bytes: 222
sha256: A152414BB595AFCA06622DB308CF17805EB7A4E69DC8937C8A0C43AD871C8992
<<< CONTENT >>>
[gd_scene load_steps=2 format=3 uid="uid://test_gal_01"]

[ext_resource type="Script" path="res://scripts/tests/test_galaxy_core.gd" id="1_testgal"]

[node name="TestGalaxy" type="Node"]
script = ExtResource("1_testgal")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 19
path: scenes\ui_hud.tscn
bytes: 4486
sha256: EC03CA02CCA3FE5534CC933630A2921A63E108B5F371E2750E816250C372B1A3
<<< CONTENT >>>
[gd_scene load_steps=4 format=3 uid="uid://ui_hud_04"]

[ext_resource type="Script" path="res://scripts/hud.gd" id="1_ui"]

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_green"]
bg_color = Color(0.2, 0.8, 0.2, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_yellow"]
bg_color = Color(0.8, 0.8, 0.2, 1)

[node name="HUD" type="CanvasLayer"]
script = ExtResource("1_ui")

[node name="Control" type="Control" parent="."]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2

[node name="Panel" type="Panel" parent="Control"]
layout_mode = 0
offset_left = 20.0
offset_top = 20.0
offset_right = 320.0
offset_bottom = 240.0

[node name="VBoxContainer" type="VBoxContainer" parent="Control/Panel"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 15.0
offset_top = 15.0
offset_right = -15.0
offset_bottom = -15.0
grow_horizontal = 2
grow_vertical = 2

[node name="MoneyLabel" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 24
text = "CREDITS: $0"

[node name="HSeparator1" type="HSeparator" parent="Control/Panel/VBoxContainer"]
layout_mode = 2

[node name="LabelHull" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 12
text = "SHIELD INTEGRITY"

[node name="HealthBar" type="ProgressBar" parent="Control/Panel/VBoxContainer"]
custom_minimum_size = Vector2(0, 15)
layout_mode = 2
theme_override_styles/fill = SubResource("StyleBoxFlat_green")
value = 100.0
show_percentage = false

[node name="LabelFuel" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 12
text = "FUEL RESERVES"

[node name="FuelBar" type="ProgressBar" parent="Control/Panel/VBoxContainer"]
custom_minimum_size = Vector2(0, 15)
layout_mode = 2
theme_override_styles/fill = SubResource("StyleBoxFlat_yellow")
value = 100.0
show_percentage = false

[node name="HSeparator2" type="HSeparator" parent="Control/Panel/VBoxContainer"]
layout_mode = 2

[node name="CargoLabel" type="Label" parent="Control/Panel/VBoxContainer"]
layout_mode = 2
text = "CARGO: Empty"

[node name="ShopPanel" type="Panel" parent="Control"]
visible = false
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -250.0
offset_top = -200.0
offset_right = 250.0
offset_bottom = 200.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="Control/ShopPanel"]
layout_mode = 1
anchors_preset = 10
anchor_right = 1.0
offset_bottom = 40.0
grow_horizontal = 2
theme_override_font_sizes/font_size = 20
text = "COMMODITIES MARKET"
horizontal_alignment = 1
vertical_alignment = 1

[node name="VBoxContainer" type="VBoxContainer" parent="Control/ShopPanel"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 20.0
offset_top = 50.0
offset_right = -20.0
offset_bottom = -20.0
grow_horizontal = 2
grow_vertical = 2

[node name="MarketTicker" type="Label" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
theme_override_colors/font_color = Color(0, 1, 0, 1)
text = "IRON: $50 | GOLD: $100"
horizontal_alignment = 1

[node name="HSeparator3" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2

[node name="BtnSellAll" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
theme_override_colors/font_color = Color(0, 1, 0, 1)
text = "SELL ALL CARGO (AT CURRENT RATES)"

[node name="HSeparator4" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2

[node name="BtnSpeed" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "Upgrade Thrusters ($200)"

[node name="BtnWeapon" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "Upgrade Cooling ($500)"

[node name="HSeparator5" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2

[node name="BtnClose" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "UNDOCK"
[node name="BtnBuyIron" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "BUY IRON (x1)"

[node name="BtnBuyGold" type="Button" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2
text = "BUY GOLD (x1)"

[node name="HSeparatorBuy" type="HSeparator" parent="Control/ShopPanel/VBoxContainer"]
layout_mode = 2


<<< END FILE >>>

<<< BEGIN FILE >>>
index: 20
path: scripts\asteroid.gd
bytes: 1466
sha256: 8A04EB65B62533AFF33CFE9A52264548294CB2266395D51D94F22BDE682568D9
<<< CONTENT >>>
extends StaticBody3D

@export var resource_type: String = "ore_iron"
@export var resource_amount: int = 1
@export var health: int = 3

func take_damage(amount: int):
    health -= amount
    print("[TARGET] Asteroid Hit! Health: %s" % health)
    
    # Flash Effect (Optional - just creates a visual pop)
    var mesh = $MeshInstance3D
    if mesh:
        var tween = create_tween()
        tween.tween_property(mesh, "scale", Vector3(1.2, 1.2, 1.2), 0.05)
        tween.tween_property(mesh, "scale", Vector3(1.0, 1.0, 1.0), 0.05)

    if health <= 0:
        explode()

func explode():
    print("[TARGET] Asteroid Destroyed! Yield: %s x%s" % [resource_type, resource_amount])
    
    # Give Loot to Player (Simplification: Auto-collect)
    # In a full game, we would spawn floating items.
    var player = get_tree().get_first_node_in_group("Player")
    if player:
        # Check if player has space (using the API we built earlier)
        # Note: We need to ensure 'add_cargo' exists in player.gd or use direct dict access
        if player.has_method("add_cargo"):
            player.add_cargo(resource_type, resource_amount)
        else:
            # Fallback if add_cargo helper is missing
            if not player.cargo.has(resource_type): player.cargo[resource_type] = 0
            player.cargo[resource_type] += resource_amount
            # Force UI Update
            player._update_ui_state() 
            
    queue_free() # Delete the rock

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 21
path: scripts\bullet.gd
bytes: 950
sha256: 37C292357212BB80E57C33DF52CC1459DC99D848D32014B95A57CF4D4168303D
<<< CONTENT >>>
extends Area3D

# --- PHYSICS CONSTANTS ---
var speed = 60.0
var damage = 1
var lifetime = 2.0
var shooter = null # IFF TAG

func _ready():
    # Layer 1 (World) + Layer 2 (Enemies/Player)
    collision_mask = 1 | 2 
    body_entered.connect(_on_body_entered)
    
    # Failsafe: Die after 2 seconds to prevent memory leaks
    await get_tree().create_timer(lifetime).timeout
    queue_free()

func _physics_process(delta):
    # LAW: Bullets ALWAYS travel Negative Z (Local Forward)
    position -= transform.basis.z * speed * delta

func _on_body_entered(body):
    # LAW: Do not hit the shooter
    if body == shooter: return

    print("IMPACT: %s -> %s" % [shooter.name if shooter else "Unknown", body.name])
    
    if body.has_method("take_damage"):
        body.take_damage(damage)
        queue_free()
    elif body.name != "Player" and body.name != "EnemyDrone":
        # Destroy on static objects (Station, Walls)
        queue_free()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 22
path: scripts\core\economy_engine.gd
bytes: 946
sha256: F914951A8C925F1D4B14534016E6E41B7FCF6B3CF16D5AD7AB810ECDC5AE6AE1
<<< CONTENT >>>
extends RefCounted
class_name EconomyEngine

const MINIMUM_PRICE = 1

# Note: 'good' is typed as Resource to prevent headless dependency errors
static func calculate_price(good: Resource, local_supply: int, base_demand: int) -> int:
    # MVP Algorithm: Simple Scarcity
    # We access properties dynamically
    var base = good.get("base_price")
    if base == null:
        base = 10 # Fallback
        
    var scarcity_factor = float(base_demand) / max(1.0, float(local_supply))
    var final_price = int(base * scarcity_factor)
    return max(final_price, MINIMUM_PRICE)

static func can_afford(wallet_balance: int, price_per_unit: int, quantity: int) -> bool:
    return wallet_balance >= (price_per_unit * quantity)

static func has_cargo_space(current_volume: float, max_volume: float, item_volume: float, quantity: int) -> bool:
    var required_space = item_volume * quantity
    return (current_volume + required_space) <= max_volume

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 23
path: scripts\core\galaxy_graph.gd
bytes: 1490
sha256: 6B9ACBA0472711035D0EA2DBFAE9833B6F8034DCDD7BB9141DB5464D86C851DA
<<< CONTENT >>>
extends RefCounted
class_name GalaxyGraph

# The Master Ledger of all stars
var sectors: Dictionary = {} # { "id": Sector }

func add_sector(sec: Resource):
    sectors[sec.id] = sec

func connect_sectors(id_a: String, id_b: String):
    if sectors.has(id_a) and sectors.has(id_b):
        sectors[id_a].connect_to(id_b)
        sectors[id_b].connect_to(id_a) # Bidirectional Jump Gate

# BFS Pathfinding: Returns list of IDs [start, ... , end]
func get_route(start_id: String, end_id: String) -> Array:
    if start_id == end_id: return [start_id]
    
    var queue = []
    var visited = { start_id: true }
    var parents = {} # To reconstruct path
    
    queue.append(start_id)
    
    while queue.size() > 0:
        var current = queue.pop_front()
        
        if current == end_id:
            return _reconstruct_path(parents, start_id, end_id)
            
        var current_sector = sectors.get(current)
        if current_sector:
            for neighbor in current_sector.connected_ids:
                if not visited.has(neighbor):
                    visited[neighbor] = true
                    parents[neighbor] = current
                    queue.append(neighbor)
                    
    return [] # No path found

func _reconstruct_path(parents: Dictionary, start: String, end: String) -> Array:
    var path = []
    var curr = end
    while curr != start:
        path.push_front(curr)
        curr = parents[curr]
    path.push_front(start)
    return path

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 24
path: scripts\debug\camera_follow.gd
bytes: 864
sha256: 536FAB2A38C25D83E18B29EAFACD38F3E844472D49C81A88BCA7E0382B9800BE
<<< CONTENT >>>
extends Camera3D

# SETTINGS: 40 meters up, 25 meters back
var offset = Vector3(0, 40, 25)
var target_node

func _ready():
	# 1. THE EJECT BUTTON
	# This tells the engine: "Ignore my parent's rotation. Use Global coordinates."
	set_as_top_level(true)
	
	# 2. FIND THE SHIP
	# If we are inside the ship, our parent is the ship.
	var parent = get_parent()
	if parent.name == "Player":
		target_node = parent
	else:
		# If we are neighbors, find it by name
		target_node = parent.get_node_or_null("Player")

	if target_node:
		# Teleport to starting position
		global_position = target_node.global_position + offset
		look_at(target_node.global_position)

func _physics_process(_delta):
	if target_node:
		# 3. CHASE THE SHIP
		# Since we are "Top Level" now, we must manually update our position every frame.
		global_position = target_node.global_position + offset

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 25
path: scripts\enemy.gd
bytes: 1392
sha256: 14C7B3F64274ACC7C0DC14D499043E30B4CFCBAE87869E0E02543B75E1068A8F
<<< CONTENT >>>
extends CharacterBody3D

@export var speed: float = 15.0
@export var health: int = 3
@export var detection_range: float = 100.0
@export var attack_range: float = 30.0 
@export var loot_table: String = "ore_gold"

var target: Node3D = null
var bullet_scene = preload("res://scenes/bullet.tscn")
var can_shoot: bool = true
var cooldown: float = 1.5

func _ready():
	target = get_tree().get_first_node_in_group("Player")
	add_to_group("Hostile")

func _physics_process(_delta):
	if not target: return
	
	var dist = global_position.distance_to(target.global_position)
	
	if dist < detection_range:
		# POINT NEGATIVE Z AT PLAYER
		look_at(target.global_position, Vector3.UP)
		
		if dist > attack_range:
			# Move along -Z (Forward)
			velocity = -transform.basis.z * speed
		else:
			velocity = Vector3.ZERO
			_attempt_fire()
			
		move_and_slide()

func _attempt_fire():
	if can_shoot:
		can_shoot = false
		var b = bullet_scene.instantiate()
		
		# SPAWN IN FRONT (-Z)
		b.position = position - (transform.basis.z * 2.5) 
		b.rotation = rotation
		b.shooter = self
		
		get_parent().add_child(b)
		
		await get_tree().create_timer(cooldown).timeout
		can_shoot = true

func take_damage(amount: int):
	health -= amount
	print("[ENEMY] Integrity: %s" % health)
	if health <= 0: _die()

func _die():
	if target and target.has_method("add_cargo"):
		target.add_cargo(loot_table, 2)
	queue_free()

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 26
path: scripts\hud.gd
bytes: 4518
sha256: B70B6EE5987B0466B377D0CDCAEF6DFC88538EC51E42129FA679719597D2BC4D
<<< CONTENT >>>
extends CanvasLayer

@onready var money_label = $Control/Panel/VBoxContainer/MoneyLabel
@onready var health_bar = $Control/Panel/VBoxContainer/HealthBar
@onready var fuel_bar = $Control/Panel/VBoxContainer/FuelBar
@onready var cargo_label = $Control/Panel/VBoxContainer/CargoLabel

@onready var shop_panel = $Control/ShopPanel
@onready var market_ticker = $Control/ShopPanel/VBoxContainer/MarketTicker
@onready var btn_sell = $Control/ShopPanel/VBoxContainer/BtnSellAll
@onready var btn_speed = $Control/ShopPanel/VBoxContainer/BtnSpeed
@onready var btn_weapon = $Control/ShopPanel/VBoxContainer/BtnWeapon
@onready var btn_close = $Control/ShopPanel/VBoxContainer/BtnClose

var player_ref = null
var current_station = null

func _ready():
	_phase1_bind_buy_buttons()
    shop_panel.visible = false
    btn_sell.pressed.connect(_on_sell_all)
    btn_speed.pressed.connect(_on_buy_speed)
    btn_weapon.pressed.connect(_on_buy_weapon)
    btn_close.pressed.connect(_on_close_shop)

    _find_player()

func _find_player():
    var player = get_tree().get_first_node_in_group("Player")
    if player:
        player_ref = player
        player.credits_updated.connect(_on_credits_updated)
        player.cargo_updated.connect(_on_cargo_updated)
        player.health_updated.connect(_on_health_updated)
        player.fuel_updated.connect(_on_fuel_updated)
        player.shop_toggled.connect(_on_shop_toggled)
        
        # Init
        _on_credits_updated(player.credits)
        _on_cargo_updated(player.cargo)
        _on_health_updated(player.health, player.max_health)
        _on_fuel_updated(player.fuel, player.max_fuel)
    else:
        await get_tree().create_timer(0.1).timeout
        _find_player()

func _on_credits_updated(amount):
    money_label.text = "CREDITS: $%s" % amount

func _on_health_updated(current, max_val):
    if health_bar:
        health_bar.max_value = max_val
        health_bar.value = current

func _on_fuel_updated(current, max_val):
    if fuel_bar:
        fuel_bar.max_value = max_val
        fuel_bar.value = current

func _on_cargo_updated(manifest):
    var text = "CARGO: "
    if manifest.is_empty():
        text += "Empty"
    else:
        for item in manifest:
            text += "%s(%s) " % [item.replace("ore_", "").capitalize(), manifest[item]]
    cargo_label.text = text

func _on_shop_toggled(is_open, station_ref):
    shop_panel.visible = is_open
    current_station = station_ref
    
    if is_open:
        Input.mouse_mode = Input.MOUSE_MODE_VISIBLE
        _update_ticker()
    else:
        Input.mouse_mode = Input.MOUSE_MODE_CAPTURED

func _update_ticker():
    if not current_station: return
    var p_iron = current_station.get_market_price("ore_iron")
    var p_gold = current_station.get_market_price("ore_gold")
    market_ticker.text = "IRON: $%s | GOLD: $%s" % [p_iron, p_gold]

func _on_sell_all():
    if not player_ref or not current_station: return
    
    var manifest = player_ref.cargo.duplicate()
    for item in manifest:
        current_station.sell_cargo(player_ref, item, manifest[item])
        player_ref.remove_cargo(item, manifest[item])
    
    _update_ticker()

func _on_buy_speed():
    if player_ref: player_ref.purchase_upgrade("speed", 200)

func _on_buy_weapon():
    if player_ref: player_ref.purchase_upgrade("weapon", 500)

func _on_close_shop():
    if player_ref: player_ref.undock()

# =========================
# Phase 1 Economy UI Additions
# =========================

@onready var btn_buy_iron = $Control/ShopPanel/VBoxContainer/BtnBuyIron
@onready var btn_buy_gold = $Control/ShopPanel/VBoxContainer/BtnBuyGold

func _phase1_bind_buy_buttons():
if btn_buy_iron:
btn_buy_iron.pressed.connect(_on_buy_iron)
if btn_buy_gold:
btn_buy_gold.pressed.connect(_on_buy_gold)

func _on_buy_iron():
if not player_ref or not current_station:
return
current_station.buy_cargo(player_ref, "ore_iron", 1)
_phase1_update_ticker()

func _on_buy_gold():
if not player_ref or not current_station:
return
current_station.buy_cargo(player_ref, "ore_gold", 1)
_phase1_update_ticker()

func _phase1_update_ticker():
if not current_station:
return

var iron_ask = current_station.get_ask_price("ore_iron")
var iron_bid = current_station.get_bid_price("ore_iron")
var gold_ask = current_station.get_ask_price("ore_gold")
var gold_bid = current_station.get_bid_price("ore_gold")

market_ticker.text = "IRON: BUY $" + str(iron_ask) + " | SELL $" + str(iron_bid) + "   GOLD: BUY $" + str(gold_ask) + " | SELL $" + str(gold_bid)


<<< END FILE >>>

<<< BEGIN FILE >>>
index: 27
path: scripts\player.gd
bytes: 5977
sha256: 414C4F0DA25119B35AE7CAA9A6A53C8C3F9FD1460D02B58A2205A77B56A64837
<<< CONTENT >>>
extends CharacterBody3D

# --- CONFIG ---
@export_group("Ship Settings")
@export var speed_max := 25.0
@export var acceleration := 40.0
@export var friction := 15.0
@export var rotation_speed := 5.0
@export var max_health := 10
@export var max_fuel := 1000.0
@export var fuel_burn_rate := 15.0 # Cost to fly

@export_group("Weapon Systems")
@export var weapon_cooldown := 0.25
@export var invert_mesh_fire: bool = true

# --- STATE ---
var health: int = 10
var fuel: float = 1000.0
var credits: int = 100
var cargo: Dictionary = {} 
var cargo_capacity: int = 10
var is_docked: bool = false
var can_shoot : bool = true
var current_station = null

# --- SIGNALS ---
signal credits_updated(amount)
signal cargo_updated(manifest)
signal health_updated(current, max)
signal fuel_updated(current, max) # NEW
signal shop_toggled(is_open, station_ref) # UPDATED

# --- INTERNAL ---
var bullet_scene = preload("res://scenes/bullet.tscn")
var my_camera : Camera3D = null

func _ready():
	_phase1_economy_init()
		add_to_group("Player")
		Input.mouse_mode = Input.MOUSE_MODE_CAPTURED
		health = max_health
		fuel = max_fuel

		# Cam Init (scene camera only)
		my_camera = get_node_or_null("CameraMount/Camera3D")
		if my_camera:
				my_camera.current = true

		await get_tree().process_frame
		_update_ui_state()

func _physics_process(delta):
	if is_docked: return
	
	var input_dir = Input.get_vector("ui_left", "ui_right", "ui_up", "ui_down")
	var direction = Vector3(input_dir.x, 0, input_dir.y).normalized()

	# FUEL LOGIC
	if direction and fuel > 0:
		velocity = velocity.move_toward(direction * speed_max, acceleration * delta)
		
		# Burn Fuel
		fuel -= fuel_burn_rate * delta
		emit_signal("fuel_updated", int(fuel), int(max_fuel))
		
		# Rotation
		var target_rotation = atan2(velocity.x, velocity.z)
		rotation.y = lerp_angle(rotation.y, target_rotation, rotation_speed * delta)
	else:
		# Drift if no input or empty tank
		velocity = velocity.move_toward(Vector3.ZERO, friction * delta)

	move_and_slide()

	if Input.is_action_pressed("ui_accept") and can_shoot:
		shoot()
		
	if my_camera:
		var target_pos = global_position + Vector3(0, 40, 20)
		my_camera.global_position = my_camera.global_position.lerp(target_pos, 5.0 * delta)
		my_camera.look_at(global_position)

func shoot():
	if not bullet_scene: return
	can_shoot = false
	var new_bullet = bullet_scene.instantiate()
	new_bullet.position = position 
	new_bullet.rotation = rotation
	if invert_mesh_fire: new_bullet.rotate_object_local(Vector3.UP, PI)
	new_bullet.position += new_bullet.transform.basis.z * -2.0
	new_bullet.shooter = self
	get_parent().add_child(new_bullet)
	await get_tree().create_timer(weapon_cooldown).timeout
	can_shoot = true

func take_damage(amount: int):
	health -= amount
	emit_signal("health_updated", health, max_health)
	if health <= 0: _die()

func _die():
		print("CRITICAL FAILURE.")
		# Defer scene reload to avoid removing nodes during physics callbacks
		get_tree().call_deferred("reload_current_scene")

func _update_ui_state():
	emit_signal("credits_updated", credits)
	emit_signal("cargo_updated", cargo)
	emit_signal("health_updated", health, max_health)
	emit_signal("fuel_updated", int(fuel), int(max_fuel))

func add_cargo(item_id: String, amount: int):
	if not cargo.has(item_id): cargo[item_id] = 0
	cargo[item_id] += amount
	_update_ui_state()

func remove_cargo(item_id: String, amount: int):
	if cargo.has(item_id):
		cargo[item_id] -= amount
		if cargo[item_id] <= 0: cargo.erase(item_id)
		_update_ui_state()

func receive_payment(amount: int):
	credits += amount
	_update_ui_state()

func dock_at_station(station_node):
	if is_docked: return
	is_docked = true
	current_station = station_node
	velocity = Vector3.ZERO
	emit_signal("shop_toggled", true, current_station)

func undock():
	is_docked = false
	current_station = null
	emit_signal("shop_toggled", false, null)
	position -= transform.basis.z * 5.0
	
func get_fuel_status():
	return fuel
	
# PURCHASE UPGRADE API (Re-added to prevent errors)
func purchase_upgrade(type: String, cost: int):
	if credits >= cost:
		credits -= cost
		match type:
			"speed": speed_max += 5.0
			"weapon": weapon_cooldown *= 0.8
		_update_ui_state()

# =========================
# Phase 1 Economy Additions
# =========================
const TradeGood = preload("res://scripts/resources/trade_good.gd")

@export var max_cargo_volume: float = 10.0
@export var trade_goods: Array[TradeGood] = []

var cargo_volume: float = 0.0
var _goods_by_id: Dictionary = {}

func _build_goods_index():
_goods_by_id.clear()
for g in trade_goods:
if g == null:
continue
_goods_by_id[g.id] = g

func _get_item_volume(item_id: String) -> float:
var g: TradeGood = _goods_by_id.get(item_id, null)
if g == null:
return 1.0
return g.volume

# Call this from your existing _ready() once.
func _phase1_economy_init():
_build_goods_index()
_recalc_cargo_volume_from_manifest()

func _recalc_cargo_volume_from_manifest():
cargo_volume = 0.0
for item_id in cargo.keys():
var amt := int(cargo[item_id])
cargo_volume += _get_item_volume(item_id) * float(amt)

# Override add_cargo to enforce volume capacity
func add_cargo(item_id: String, amount: int) -> bool:
if amount <= 0:
return false

var item_vol := _get_item_volume(item_id)
var required := item_vol * float(amount)
if (cargo_volume + required) > max_cargo_volume:
return false

if not cargo.has(item_id):
cargo[item_id] = 0
cargo[item_id] = int(cargo[item_id]) + amount
cargo_volume += required
_update_ui_state()
return true

# Override remove_cargo to track volume
func remove_cargo(item_id: String, amount: int) -> bool:
if amount <= 0:
return false

if not cargo.has(item_id):
return false

var available := int(cargo[item_id])
var removed := min(available, amount)
cargo[item_id] = available - removed
if int(cargo[item_id]) <= 0:
cargo.erase(item_id)

var item_vol := _get_item_volume(item_id)
cargo_volume = max(0.0, cargo_volume - (item_vol * float(removed)))
_update_ui_state()
return true

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 28
path: scripts\resources\market_profile.gd
bytes: 262
sha256: 7FABB9BD4EC0CDD59F0C5762A8A3E3A7AC20260C7AEAA5D6E49A76209F69C8EE
<<< CONTENT >>>
extends Resource
class_name MarketProfile

@export var station_name: String = "Station"
@export var wealth_tier: float = 1.0
@export var trade_goods: Array[TradeGood] = []

# Key: TradeGood.id, Value: base_demand (int)
@export var base_demands: Dictionary = {}

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 29
path: scripts\resources\sector.gd
bytes: 379
sha256: 8D6870C504B81B8DA0645080A994010D2B970F32E6EA164146F1560DC663F3D9
<<< CONTENT >>>
extends Resource
class_name Sector

@export var id: String = "sector_id"
@export var name: String = "Sector Name"
@export var coordinates: Vector2 = Vector2.ZERO # For the 2D Map UI later
@export var connected_ids: Array = [] # List of Strings (IDs of neighbors)

func connect_to(other_id: String):
    if not connected_ids.has(other_id):
        connected_ids.append(other_id)

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 30
path: scripts\resources\trade_good.gd
bytes: 203
sha256: 9F857AAFD54F94955C5062AFF3F9EBE67448BA1EEDA2C1121E7124F83FAD1B3C
<<< CONTENT >>>
extends Resource
class_name TradeGood

@export var id: String = ""
@export var name: String = ""
@export var base_price: int = 10
@export var volume: float = 1.0
@export var is_contraband: bool = false

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 31
path: scripts\spawner.gd
bytes: 1323
sha256: B0FE66F1D1FE7A74DBD0AB802BDA8F85F39D811692B9CE294B46B572FDA3DF1F
<<< CONTENT >>>
extends Node3D

@export var asteroid_scene: PackedScene
@export var enemy_scene: PackedScene
@export var field_radius: float = 100.0
@export var asteroid_count: int = 30
@export var threat_level: float = 0.1 # 10% chance

func _ready():
    # Load enemy scene dynamically if not assigned in Inspector
    if not enemy_scene:
        enemy_scene = load("res://scenes/enemy.tscn")
    
    if not asteroid_scene:
        print("ERROR: No Asteroid Scene assigned!")
        return
        
    print("[SYSTEM] GENERATING SECTOR: Threat Level %s" % threat_level)
    _generate_field()

func _generate_field():
    var rng = RandomNumberGenerator.new()
    rng.randomize()
    
    for i in range(asteroid_count):
        var obj = null
        
        # Roll the dice: Enemy or Rock?
        if rng.randf() < threat_level:
            obj = enemy_scene.instantiate()
        else:
            obj = asteroid_scene.instantiate()
        
        # Position Logic
        var x = rng.randf_range(-field_radius, field_radius)
        var z = rng.randf_range(-field_radius, field_radius)
        if abs(x) < 20 and abs(z) < 20: x += 40 # Clear zone
        
        obj.position = Vector3(x, 0, z)
        obj.rotation.y = rng.randf_range(0, 6.28)
        
        add_child(obj)
        
    print("[SYSTEM] SECTOR POPULATED.")

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 32
path: scripts\starfield.gd
bytes: 803
sha256: 18DAEC80B0BC93C274C7EFEC032D5AFCD224802062736B21CF6F5C7385CD82B9
<<< CONTENT >>>
extends Node3D

func _ready():
    var rng = RandomNumberGenerator.new()
    # Create 500 stars for density
    for i in range(500):
        var star = MeshInstance3D.new()
        star.mesh = BoxMesh.new()
        star.mesh.size = Vector3(0.8, 0.8, 0.8) # Large enough to see
        
        # Create a glowing material
        var mat = StandardMaterial3D.new()
        mat.shading_mode = BaseMaterial3D.SHADING_MODE_UNSHADED
        mat.albedo_color = Color(1, 1, 1) # Pure White
        star.mesh.material = mat
        
        # Spread them out WIDE
        var x = rng.randf_range(-300, 300)
        var z = rng.randf_range(-300, 300)
        var y = rng.randf_range(-40, -100) # Deep below player
        
        star.position = Vector3(x, y, z)
        add_child(star)

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 33
path: scripts\station.gd
bytes: 3437
sha256: 26FF7E8C0E9CE97E96A87DBE70B5D6B2C96DC998AB8915385C4A195787958EB3
<<< CONTENT >>>
extends Area3D
class_name GameStation

const EconomyEngine = preload("res://scripts/core/economy_engine.gd")
const MarketProfile = preload("res://scripts/resources/market_profile.gd")
const TradeGood = preload("res://scripts/resources/trade_good.gd")

@export var fuel_cost_per_unit: int = 2
@export var market_profile: MarketProfile

# Key: item_id, Value: supply signal (higher means cheaper)
@export var local_supply: Dictionary = {
"ore_iron": 100,
"ore_gold": 20,
}

var _goods_by_id: Dictionary = {}

const ASK_MULT := 1.10
const BID_MULT := 0.90

func _ready():
monitoring = true
monitorable = true
body_entered.connect(_on_body_entered)
_build_goods_index()

func _build_goods_index():
_goods_by_id.clear()
if market_profile == null:
return
for g in market_profile.trade_goods:
if g == null:
continue
_goods_by_id[g.id] = g

func get_mid_price(item_id: String) -> int:
var good: TradeGood = _goods_by_id.get(item_id, null)
if good == null:
return 0

var base_demand := 100
if market_profile != null:
base_demand = int(market_profile.base_demands.get(item_id, 100))
base_demand = int(float(base_demand) * market_profile.wealth_tier)

var supply_val := int(local_supply.get(item_id, 1))
return EconomyEngine.calculate_price(good, supply_val, base_demand)

func get_ask_price(item_id: String) -> int:
var mid := get_mid_price(item_id)
return int(ceil(float(mid) * ASK_MULT))

func get_bid_price(item_id: String) -> int:
var mid := get_mid_price(item_id)
return int(floor(float(mid) * BID_MULT))

func _on_body_entered(body):
if body.has_method("dock_at_station"):
_refuel_ship(body)
body.dock_at_station(self)

func _refuel_ship(player):
if not player.has_method("get_fuel_status"):
return

var needed := player.max_fuel - player.fuel
if needed > 1.0:
var cost := int(needed * fuel_cost_per_unit)
if player.credits >= cost:
player.credits -= cost
player.fuel = player.max_fuel
player.receive_payment(0)
else:
var units := int(player.credits / fuel_cost_per_unit)
if units > 0:
player.credits -= (units * fuel_cost_per_unit)
player.fuel += units
player.receive_payment(0)

func buy_cargo(player, item_id: String, amount: int) -> bool:
if amount <= 0:
return false

var good: TradeGood = _goods_by_id.get(item_id, null)
if good == null:
return false

var price := get_ask_price(item_id)
if not EconomyEngine.can_afford(player.credits, price, amount):
return false

if not EconomyEngine.has_cargo_space(player.cargo_volume, player.max_cargo_volume, good.volume, amount):
return false

var total := price * amount
player.credits -= total

var ok := player.add_cargo(item_id, amount)
if not ok:
# Should not happen if has_cargo_space is correct, but keep it safe.
player.credits += total
return false

# Buying increases local supply signal (prices rise)
local_supply[item_id] = int(local_supply.get(item_id, 1)) + amount

player.receive_payment(0)
return true

func sell_cargo(player, item_id: String, amount: int) -> bool:
if amount <= 0:
return false

var price := get_bid_price(item_id)
if price <= 0:
return false

# Ensure player actually has it
if not player.cargo.has(item_id):
return false
if int(player.cargo[item_id]) < amount:
return false

var total := price * amount

var removed := player.remove_cargo(item_id, amount)
if not removed:
return false

player.receive_payment(total)

# Selling decreases local supply signal (prices fall)
local_supply[item_id] = max(1, int(local_supply.get(item_id, 1)) - amount)
return true

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 34
path: scripts\tests\test_economy_core.gd
bytes: 1914
sha256: FA93CC877FAEA8E0E82194F69D180F46807020E6D753A31CCEBA979D72E74A9B
<<< CONTENT >>>
extends Node

# Explicit loads for headless stability
const EconomyEngine = preload("res://scripts/core/economy_engine.gd")
const TradeGood = preload("res://scripts/resources/trade_good.gd")

func _ready():
    print("--- STARTING ECONOMY INTEGRATION TESTS ---")
    run_all_tests()
    print("--- TESTS COMPLETE ---")
    get_tree().quit() # Auto-close on success

func run_all_tests():
    test_affordability_check()
    test_cargo_limits()
    test_price_algorithm()

func test_affordability_check():
    var balance = 1000
    var price = 50
    var can_buy_10 = EconomyEngine.can_afford(balance, price, 10)
    var can_buy_25 = EconomyEngine.can_afford(balance, price, 25)
    _assert(can_buy_10 == true, "Affordability: Should afford 10 items")
    _assert(can_buy_25 == false, "Affordability: Should NOT afford 25 items")

func test_cargo_limits():
    var max_vol = 100.0
    var current_vol = 90.0
    var item_vol = 2.0
    var can_fit_4 = EconomyEngine.has_cargo_space(current_vol, max_vol, item_vol, 4)
    var can_fit_6 = EconomyEngine.has_cargo_space(current_vol, max_vol, item_vol, 6)
    _assert(can_fit_4 == true, "Cargo: Should fit 4 units")
    _assert(can_fit_6 == false, "Cargo: Should NOT fit 6 units")

func test_price_algorithm():
    # Instantiate the Resource manually
    var iron = TradeGood.new()
    iron.base_price = 100
    
    # We pass the object. The Engine treats it as a generic Resource.
    var cheap_price = EconomyEngine.calculate_price(iron, 200, 100)
    var high_price = EconomyEngine.calculate_price(iron, 50, 100)
    
    _assert(cheap_price < 100, "Economics: High supply should lower price (Got: %s)" % cheap_price)
    _assert(high_price > 100, "Economics: Low supply should raise price (Got: %s)" % high_price)

func _assert(condition: bool, message: String):
    if condition:
        print("[PASS] " + message)
    else:
        printerr("[FAIL] " + message)

<<< END FILE >>>

<<< BEGIN FILE >>>
index: 35
path: scripts\tests\test_galaxy_core.gd
bytes: 1442
sha256: 3A5F8309263DA6C6F7B9308BBC4665BF2F6C7E38BF78352FD716971823680668
<<< CONTENT >>>
extends Node

# Explicit Preloads for Headless Stability
const Sector = preload("res://scripts/resources/sector.gd")
const GalaxyGraph = preload("res://scripts/core/galaxy_graph.gd")

func _ready():
    print("--- STARTING GALAXY NAVIGATION TESTS ---")
    run_tests()
    print("--- GALAXY TESTS COMPLETE ---")
    get_tree().quit()

func run_tests():
    # SETUP: Create a Map: A <-> B <-> C
    var graph = GalaxyGraph.new()
    
    var s1 = Sector.new(); s1.id = "A"; graph.add_sector(s1)
    var s2 = Sector.new(); s2.id = "B"; graph.add_sector(s2)
    var s3 = Sector.new(); s3.id = "C"; graph.add_sector(s3)
    
    graph.connect_sectors("A", "B")
    graph.connect_sectors("B", "C")
    
    # TEST 1: Direct Neighbor
    var route_ab = graph.get_route("A", "B")
    _assert(route_ab.size() == 2, "Path A->B should be 2 steps. Got: %s" % str(route_ab))
    
    # TEST 2: Multi-Jump
    var route_ac = graph.get_route("A", "C")
    _assert(route_ac.size() == 3, "Path A->C should be 3 steps (A,B,C). Got: %s" % str(route_ac))
    
    # TEST 3: Invalid Path (Isolated Node)
    var s4 = Sector.new(); s4.id = "D"; graph.add_sector(s4) # D is alone
    var route_ad = graph.get_route("A", "D")
    _assert(route_ad.size() == 0, "Path A->D should be empty. Got: %s" % str(route_ad))

func _assert(condition: bool, message: String):
    if condition:
        print("[PASS] " + message)
    else:
        printerr("[FAIL] " + message)

<<< END FILE >>>

=== OMITTED FILES (NOT INLINED) ===
omitted_count: 0
===================================

=== ERRORS ===
error_count: 0
==============

=== DUMP SUMMARY ===
inline_file_count: 35
inline_total_bytes: 247557
third_party_dirs_referenced: addons, third_party, vendor, externals, external
max_inline_bytes: 52428800
====================

=== END OF DUMP ===

