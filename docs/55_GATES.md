# 55_GATES

## Gate closeout checklist (required)
When a gate moves to DONE:
1) Add a PASS entry to docs/56_SESSION_LOG.md (single line, deterministic format).
2) Update the gate row in docs/55_GATES.md (status DONE + evidence paths).
3) Run scripts/tools/Validate-Gates.ps1 and dotnet test (SimCore.Tests Release).
4) If applicable, update or regenerate docs/generated artifacts referenced by the gate.

## A. Slice 0 discipline gates (always-on)

| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.S0.SEM.001 | DONE | Slice 0 is ALWAYS_ON discipline: even if current tooling/boundary gates are DONE, Slice 0 remains IN_PROGRESS as new invariants and boundaries are added; this doc must state that status semantics unambiguously to avoid historical contradiction | docs/55_GATES.md (this section) |

## B. Slice 1 and 1.5 gates (locked execution gates)

### B1. Workflow and tooling gates
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.TOOL.001 | DONE | Deterministic status packet generation exists (diff-driven, capped) | docs/generated/02_STATUS_PACKET.txt |
| GATE.CONN.001 | DONE | Connectivity scan outputs deterministic manifests | docs/generated/connectivity_manifest.json; docs/generated/connectivity_graph.json |
| GATE.CONN.002 | DONE | Connectivity violations empty for Slice scope | docs/generated/connectivity_violations.json |
| GATE.TEST.001 | DONE | Headless determinism harness exists | SimCore.Tests/GoldenReplayTests.cs |
| GATE.TEST.002 | DONE | Golden world hash regression exists and is stable | docs/generated/snapshots/golden_replay_hashes.txt |
| GATE.EVID.001 | DONE | Context packet reports latest scan + test summary + hash snapshot presence (or explicit “not found” reasons) | docs/generated/01_CONTEXT_PACKET.md ([SYSTEM HEALTH] shows Connectivity OK + Tests OK + Hash Snapshot present) |
| GATE.MAP.001 | DONE | Repo evidence export exists (tests index + grep + map) | docs/generated/evidence/simcore_tests_index.txt; docs/generated/evidence/gate_evidence_grep.txt; docs/generated/evidence/gate_evidence_map.json |
| GATE.FILE.001 | DONE | Runtime File Contract enforced (runtime IO restricted to res:// and user://; SimCore has no System.IO IO) | SimCore.Tests/Invariants/RuntimeFileContractTests.cs |
| GATE.X.API_BOUNDARIES.GUARD.001 | DONE | Enforce UI%SimCore boundaries with a deterministic guard (v0): deterministic scan test enforces scripts/ui/**/*.cs contains no references to SimCore.Entities or SimCore.Systems in code (ignores comments%strings); emits sorted violations as file:line:type; StationMenu routes intel age and sustainment via SimBridge (GetIntelAgeTicks, GetSustainmentSnapshot) so UI stays compliant. Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS | SimCore.Tests/ContainmentTests.cs; scripts/ui/StationMenu.cs; scripts/bridge/SimBridge.cs; docs/30_CONNECTIVITY_AND_INTERFACES.md |
| GATE.X.GAMESHELL.SMOKE.001 | DONE | GameShell headless smoke harness v0: headless Godot runner executes with Seed, runs exactly N=120 ticks, exits code 0; emits deterministic transcript with Seed, tick_count, world_hash@0%60%120 and sorted entity counts; no timestamps; byte-for-byte stable across runs (stdout%stderr stable hashes across 2 runs). Proof: scripts/tools/Validate-GodotScript.ps1 -TargetScript "scripts/core/sim/sim.gd" PASS. Run: resolve Godot exe via scripts/tools/common.ps1 Get-GodotExe, then run --headless --verbose --path <repoRoot> -s scripts/tests/test_sim_skeleton.gd --seed=42 --ticks=120 twice; compare SHA256(stdout) and SHA256(stderr) | scripts/tests/test_sim_skeleton.gd; scripts/core/sim/sim.gd; scenes/main.tscn; scripts/core/game_manager.gd; scripts/tools/common.ps1 |
| GATE.X.SCENARIO.HARNESS.001 | DONE | Deterministic scenario harness v0: minimal builder to create crafted SimCore worlds (nodes, lanes, markets, fleets, prices, fees) with stable IDs and deterministic ordering; no UI%Godot scene construction; emits deterministic scenario summary for diffing; proof: used by at least 2 regression tests (routes and capacity scarcity) | SimCore/Schemas/WorldDefinition.cs; SimCore/Schemas/ScenarioSchema.cs; SimCore.Tests/Systems/RoutePlannerTests.cs; SimCore.Tests/Systems/LaneFlowSystemTests.cs |
| GATE.REPO.HEALTH.001 | DONE | Repo health v0: one-command scripts/tools/Repo-Health.ps1 runs deterministic Scan-Connectivity + dotnet test and emits sorted no-timestamp docs/generated/repo_health_report_v0.txt; FAIL on: file>25MB; forbidden ext {zip,rar,7z,exe,dll,pdb,mp4,mov,avi,mkv,psd,blend} unless allowlisted; backup%junk outside docs/archive/%_archive/; any generated/ dir outside docs/generated/; known generated artifacts outside docs/generated/; LLM size budgets: 01_CONTEXT_PACKET warn>250KB fail>750KB, docs/** warn>150KB fail>400KB, LLM surfaces warn>250KB fail>750KB; connectivity delta FAIL only on NEW cross-layer edges not in baseline%allowlist (baseline mint supported) | SimCore.Tests/Invariants/RuntimeFileContractTests.cs; scripts/tools/Repo-Health.ps1; scripts/tools/Scan-Connectivity.ps1; docs/connectivity/baseline_cross_layer_edges_v0.txt; docs/connectivity/allowlist_cross_layer_edges_v0.txt |
| GATE.X.ROADMAP.CONSISTENCY.001 | DONE | Roadmap consistency v0: deterministic scan enforces HARD_FAIL: (1) every PASS gate in docs/56_SESSION_LOG.md is DONE in docs/55_GATES.md, (2) every DONE gate has exactly one PASS entry OR is allowlisted as legacy, (3) DONE gates must not have evidence=TBD, (4) no gate id duplicates in docs/55_GATES.md, (5) no gate id may be both active in docs/gates/gates.json and DONE in docs/55_GATES.md; WARN_ONLY: epic slice%epic statuses in docs/54_EPICS.md contradict gate completion. Emits docs/generated/roadmap_mismatches_v0.txt with sorted mismatch records (severity, kind, gate_id, details); no timestamps; exits nonzero on HARD_FAIL only | scripts/tools/Scan-RoadmapConsistency.ps1; SimCore.Tests/Invariants/RoadmapConsistencyTests.cs; docs/generated/roadmap_mismatches_v0.txt; docs/roadmap/legacy_done_without_pass_allowlist_v0.txt |
| GATE.X.TWEAKS.DATA.PLUMBING.001 | DONE | Tweak config plumbing v0: SimState has versioned tweak config + canonical SHA256 hash; SimKernel injects deterministic JSON override; no runtime IO in SimCore; goldens unchanged; override determinism covered. Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS | SimCore/SimState.cs; SimCore/SimKernel.cs; SimCore.Tests/Determinism/LongRunWorldHashTests.cs |
| GATE.X.TWEAKS.DATA.SCHEMA.001 | DONE | Tweak config schema contract v0: canonical JSON field list is explicit and append-only (prefix locked); stable defaults encoded; hash locked to SHA256(UTF-8 canonical JSON) uppercase hex; invalid JSON, non-object roots, and schema-invalid types deterministically fall back to defaults. Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS | SimCore/SimState.cs; SimCore.Tests/Invariants/RuntimeFileContractTests.cs |
| GATE.X.TWEAKS.DATA.TRANSCRIPT.001 | DONE | Transcript surfacing v0: deterministic transcript prints tick=0 tweaks_version=<v> tweaks_hash=<H> (no timestamps, fixed formatting); LongRun determinism output includes the line for both runs; exact-line asserts lock format. Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS | SimCore.Tests/Determinism/LongRunWorldHashTests.cs; SimCore/SimState.cs |
| GATE.X.TWEAKS.DATA.HOSTFILE.RUNNER.001 | DONE | Runner-loaded tweak file v0: SimCore.Runner loads Data/Tweaks/tweaks_v0.json (UTF-8 no BOM) when present; strict UTF-8 decode + JSON object check; missing%invalid falls back to defaults; injected via SimKernel(seed, tweakConfigJsonOverride); prints deterministic TweaksHash | SimCore.Runner/Program.cs; SimCore/SimKernel.cs; SimCore/SimState.cs; SimCore.Tests/Invariants/RuntimeFileContractTests.cs |
| GATE.X.TWEAKS.DATA.MIGRATE.MARKET_FEES.001 | DONE | Migrate market fee constants v0: Market fee multipliers sourced from tweak config with stable defaults; determinism override changes fee outcome deterministically | SimCore/Systems/MarketSystem.cs; SimCore/SimState.cs; SimCore.Tests/GoldenReplayTests.cs |
| GATE.X.TWEAKS.DATA.MIGRATE.LANE_CAPACITY.001 | DONE | Migrate lane capacity defaults v0: TotalCapacity<=0 uses Tweaks.DefaultLaneCapacityK when >0 else unlimited (legacy default); deterministic override changes queueing | SimCore/SimState.cs; SimCore/Systems/LaneFlowSystem.cs |
| GATE.X.TWEAKS.DATA.MIGRATE.LOGISTICS_RISK.001 | DONE | Migrate logistics risk knobs v0: RoutePlanner consumes tweak-sourced risk knobs via deterministic fixed-point scoring; determinism test proves override changes chosen route deterministically | SimCore/Systems/RoutePlanner.cs; SimCore.Tests/Determinism/LogisticsOrderingDeterminismTests.cs; docs/tweaks/allowlist_numeric_literals_v0.txt |
| GATE.X.TWEAKS.DATA.MIGRATE.LOOP_SCORING.001 | DONE | Migrate loop scoring knobs v0: loop viability thresholds sourced from tweak config; override deterministically filters supplier candidates and changes planning outcome | SimCore/Systems/LogisticsSystem.cs; SimCore.Tests/Determinism/LogisticsOrderingDeterminismTests.cs |
| GATE.X.TWEAKS.DATA.MIGRATE.WORLDGEN_BOUNDS.001 | DONE | Migrate worldgen bounds v0: GalaxyGenerator sources bounds from tweak config; deterministic enforcement with stable FAIL reporting; deterministic pass%fail under overrides | SimCore/Gen/GalaxyGenerator.cs; SimCore.Tests/Invariants/BasicStateInvariantsTests.cs |
| GATE.X.TWEAKS.DATA.GUARD.001 | DONE | Tweak routing guard v0: deterministic scan flags new numeric literals in SimCore/Systems%SimCore/Gen unless Tweaks-sourced or allowlisted; emits sorted violations report; baseline mint supported via STE_TWEAK_GUARD_MINT_BASELINE | SimCore.Tests/Invariants/RuntimeFileContractTests.cs; docs/tweaks/baseline_numeric_literals_v0.txt |
| GATE.UI.SAFEREAD.NOLOCK.INTEL_AGE.001 | DONE | Fix UI lock recursion v0: inside SimBridge.TryExecuteSafeRead lambdas, UI calls *_NoLock(state, ...) helpers to avoid nested lock acquisition; prevents LockRecursionException and keeps StationMenu stable | scripts/bridge/SimBridge.cs; scripts/ui/StationMenu.cs; SimCore.Tests/Invariants/RuntimeFileContractTests.cs |
| GATE.X.CONTENT_SUBSTRATE.001 | DONE | Content substrate registries v0: deterministic ContentRegistryLoader for versioned goods%recipes%modules registry with schema contract and canonical SHA256 digest; WorldLoader stamps registry version%digest into SimState; emits deterministic docs/generated/content_registry_digest_v0.txt (no timestamps); contract test asserts identical digest and normalized ordering across two loads | docs/56_SESSION_LOG.md (PASS) |

### B2. Slice 1 critical gates
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.TIME.001 | DONE | 60x time contract enforced: 1s real = 1 min sim, no acceleration | SimCore.Tests/TimeContractTests.cs |
| GATE.INTENT.001 | DONE | Deterministic intent pipeline exists | SimCore.Tests/Intents/IntentSystemTests.cs + scripts/bridge/SimBridge.cs (EnqueueIntent) |
| GATE.WORLD.001 | DONE | 2 stations, 1 lane, 2 goods micro-world config | SimCore.Tests/World/World001_MicroWorldLoadTests.cs + SimCore.Tests/Intents/IntentSystemTests.cs (KernelWithWorld001) |
| GATE.STA.001 | DONE | Station inventory ledger and invariants | SimCore.Tests/Systems/InventoryLedgerTests.cs + SimCore.Tests/Invariants/InventoryConservationTests.cs; SimCore.Tests/Invariants/BasicStateInvariantsTests.cs |
| GATE.LANE.001 | DONE | Lane flow with deterministic delay arrivals | SimCore.Tests/Systems/LaneFlowSystemTests.cs |
| GATE.MKT.001 | DONE | Inventory-based pricing with spread | SimCore.Tests/MarketTests.cs + SimCore.Tests/Systems/MarketPublishCadenceTests.cs |
| GATE.MKT.002 | DONE | Price publish cadence every 12 game hours | SimCore.Tests/Systems/MarketPublishCadenceTests.cs |
| GATE.INTEL.001 | DONE | Local truth, remote banded intel + age | SimCore.Tests/Systems/IntelContractTests.cs |
| GATE.UI.001 | DONE | Minimal panel shows inventory, price, intel age | scripts/ui/StationMenu.cs + scripts/bridge/SimBridge.cs |
| GATE.UI.002 | DONE | Buy/sell generates intent, no direct mutation | scripts/ui/StationMenu.cs (SubmitBuyIntent/SubmitSellIntent) + scripts/bridge/SimBridge.cs (EnqueueIntent + BuyIntent/SellIntent) + SimCore.Tests/Intents/IntentSystemTests.cs |
| GATE.DET.001 | DONE | 10,000 tick run stable world hash | SimCore.Tests/Determinism/LongRunWorldHashTests.cs (LongRunWorldHash) + docs/generated/05_TEST_SUMMARY.txt |
| GATE.SAVE.001 | DONE | Save/load round trip preserves hash | SimCore.Tests/SaveLoad/SaveLoadWorldHashTests.cs (SaveLoadWorldHash) + docs/generated/05_TEST_SUMMARY.txt |
| GATE.INV.001 | DONE | Invariants suite passes | SimCore.Tests/Invariants/InventoryConservationTests.cs (InventoryConservation); SimCore.Tests/Invariants/BasicStateInvariantsTests.cs (BasicStateInvariants) + docs/generated/05_TEST_SUMMARY.txt |

### B3. Slice 1.5 sustainment gates
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.TECH.001 | DONE | One tech requires 2 goods per tick to remain enabled | SimCore.Tests/Sustainment/TechUpkeepConsumesGoodsTests.cs |
| GATE.TECH.002 | DONE | Buffers sized in days of game time | SimCore.Tests/Sustainment/BufferSizingDaysTests.cs |
| GATE.TECH.003 | DONE | Deterministic degradation under undersupply | SimCore.Tests/Sustainment/DeterministicDegradationTests.cs |
| GATE.UI.101 | DONE | UI shows sustainment margin and time-to-failure | scripts/ui/StationMenu.cs; scripts/bridge/SimBridge.cs; SimCore/Systems/SustainmentReport.cs |
| GATE.DET.101 | DONE | Sustainment determinism regression passes | SimCore.Tests/Sustainment/SustainmentDeterminismRegressionTests.cs |
| GATE.INV.101 | DONE | Buffer math invariants pass | SimCore.Tests/Sustainment/BufferMathInvariantsTests.cs |

### B4. Slice 2 programs gates (v1)
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.PROG.001 | DONE | Program schema v1 exists (TradeProgram only) and is versioned | SimCore/Schemas/ProgramSchema.json + SimCore.Tests/Programs/ProgramContractTests.cs (PROG_001) |
| GATE.FLEET.001 | DONE | Fleet binding v1 exists (single trader fleet) and is deterministic | SimCore/World/WorldLoader.cs + SimCore.Tests/Programs/FleetBindingContractTests.cs + docs/generated/05_TEST_SUMMARY.txt |
| GATE.DOCTRINE.001 | DONE | DefaultDoctrine exists (max 2 toggles) and is deterministic | SimCore/Programs/DefaultDoctrine.cs + SimCore.Tests/Programs/DefaultDoctrineContractTests.cs |
| GATE.QUOTE.001 | DONE | Liaison Quote is deterministic: request + snapshot => quote (cost/time/risks/constraints) | SimCore/Programs/ProgramQuote.cs + SimCore/Programs/ProgramQuoteSnapshot.cs + SimCore.Tests/Programs/ProgramQuoteContractTests.cs + SimCore.Tests/TestData/Snapshots/program_quote_001.json + docs/generated/05_TEST_SUMMARY.txt |
| GATE.EXPLAIN.001 | DONE | Explain events are schema-bound (no free-text) for quote and outcomes | SimCore.Tests/Programs/ProgramContractTests.cs (EXPLAIN_001) |
| GATE.PROG.EXEC.001 | DONE | Program execution emits intents only, no direct ledger mutation | SimCore.Tests/Programs/ProgramContractTests.cs (PROG_EXEC_001) + SimCore/Programs/ProgramSystem.cs |
| GATE.PROG.EXEC.002 | DONE | TradeProgram drives buy/sell intents against Slice 1 micro-world and affects outcomes only via SimCore tick | SimCore.Tests/Programs/ProgramExecutionIntegrationTests.cs + docs/generated/05_TEST_SUMMARY.txt |
| GATE.BRIDGE.PROG.001 | DONE | GameShell -> SimCore bridge supports program lifecycle (create/start/pause) without direct state mutation | scripts/bridge/SimBridge.cs + SimCore.Tests/Programs/ProgramLifecycleContractTests.cs + SimCore.Tests/Programs/ProgramStatusCommandContractTests.cs |
| GATE.UI.PROG.001 | DONE | Minimal Programs UI: create, view quote, start/pause, last-tick outcomes | scripts/ui/ProgramsMenu.cs + scripts/ui/StationMenu.cs + scripts/bridge/SimBridge.cs + scenes/playable_prototype.tscn |
| GATE.VIEW.001 | DONE | Playable prototype camera is a ship-follow orbit camera (zoom + rotate) and player has a ship placeholder mesh | scripts/view/player_follow_camera.gd + scenes/player.tscn + scenes/playable_prototype.tscn |
| GATE.DET.PROG.001 | DONE | Determinism regression includes program lifecycle (create/start/pause) with stable hash | SimCore.Tests/Determinism/ProgramDeterminismTests.cs + SimCore.Tests/SaveLoad/ProgramSaveLoadContractTests.cs |

### B4.5 Slice 2.5 seed plumbing gates (v0)
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.S2_5.SEEDS.001 | DONE | Axis: seed_input. Plumb Seed into galaxy generation entrypoint and persist on SimState. Acceptance: headless Godot compile smoke clean (no Parse Error%Compilation failed); Seed stored on SimState.seed and used by galaxy_generator.generate_for_state; anti-pattern scan OK (no randomize%wall-clock%global randf%randi in core scan); headless determinism smoke exits 0 and prints digest_1==digest_2 for same Seed+regions. Closure proof: seed_smoke_stdout shows digest match + DETERMINISM_OK; Validate-GodotScript exit code 0 for sim_state.gd and galaxy_generator.gd. | scripts/core/sim/galaxy_generator.gd; scripts/core/state/sim_state.gd; scripts/core/galaxy_graph.gd |
| GATE.S2_5.SEEDS.002 | DONE | Axis: rng_streams. Intent: Define a stable RNG stream contract keyed by Seed + stream name so adding systems does not perturb existing randomness. Delta: RNG stream partitioning exists conceptually but is not gate-specified as the required mechanism for Seed-based worldgen. Acceptance: Godot headless parse passes for scripts/core/sim/rng_streams.gd; each stream is derived from Seed + stable stream key and does not depend on call order from other systems; adding a new stream does not change outputs of existing stream keys for the same Seed; scripts/core/sim/galaxy_generator.gd consumes only named streams for all randomness. Status rules: TODO->IN_PROGRESS once stream-derivation API is explicit and used by worldgen; IN_PROGRESS->DONE when acceptance checks pass; BLOCKED if any consumer uses non-stream RNG in the worldgen path. Closure proof: Validate-GodotScript PASS (exit code 0) for scripts/core/sim/rng_streams.gd and scripts/core/sim/galaxy_generator.gd; legacy keys use fixed offsets from Seed; new keys seed from (Seed, stable_stream_name) hash; galaxy_generator uses STREAM_GALAXY_GEN. | scripts/core/sim/rng_streams.gd; scripts/core/sim/galaxy_generator.gd |
| GATE.S2_5.SEEDS.003 | DONE | Axis: gameshell_regression. Intent: Add a minimal GameShell seed determinism regression test that exercises galaxy generation twice with the same Seed. Delta: No existing GameShell gate asserts identical generation for identical Seed or protects against accidental nondeterminism in .gd worldgen scripts. Acceptance: Godot headless run passes for scripts/tests/test_galaxy_core.gd; test generates twice with the same Seed and asserts identical ordered nodes%edges representation; test generates with two different Seeds and asserts at least one deterministic structural difference; output is stable for diffing (explicit ordering, no timestamps). Status rules: TODO->IN_PROGRESS once the test is written and fails on current nondeterministic behavior (if any); IN_PROGRESS->DONE when test passes and is stable across reruns; BLOCKED if test cannot run headlessly in repo workflow. Closure proof: scripts/tests/test_galaxy_core.gd assertion output proves same-Seed equality and cross-Seed difference. Evidence universe: Anchor=scripts/tests/test_galaxy_core.gd, Extra=scripts/core/sim/galaxy_generator.gd,scripts/core/sim/rng_streams.gd | scripts/tests/test_galaxy_core.gd; scripts/core/sim/galaxy_generator.gd; scripts/core/sim/rng_streams.gd |
| GATE.S2_5.SEEDS.004 | DONE | Axis: save_seed_identity. Intent: Persist Seed as part of SimCore world identity and ensure Serialization round-trip preserves it exactly. Delta: GATE.SAVE.001 proves hash equivalence but does not explicitly require that Seed and worldgen parameters are saved%loaded as identity inputs. Acceptance: dotnet test passes including SimCore.Tests/SaveLoad/SaveLoadWorldHashTests.cs; WorldLoader stores Seed in a stable world identity field (or equivalent) used by downstream worldgen; Serialization payload includes Seed and Load restores it exactly; failure output includes the Seed value used so repro is trivial. Status rules: TODO->IN_PROGRESS once Seed is added to the SimCore identity structure and wired into serialization; IN_PROGRESS->DONE when the save%load test asserts Seed identity and passes; BLOCKED if adding Seed breaks existing save%load hashes without explicit migration note. Closure proof: SaveLoadWorldHashTests asserts Seed preserved across save%load and reports Seed on failure. Evidence universe: Anchor=SimCore/World/WorldLoader.cs, Extra=SimCore/Systems/SerializationSystem.cs,SimCore.Tests/SaveLoad/SaveLoadWorldHashTests.cs. Proof phrase: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release passes; SaveLoadWorldHashTests prints Seed(saved)=123 and Seed(resaved)=123 with matching hashes. | SimCore/World/WorldLoader.cs; SimCore/Systems/SerializationSystem.cs; SimCore.Tests/SaveLoad/SaveLoadWorldHashTests.cs |
| GATE.S2_5.SEEDS.005 | DONE | Axis: determinism_seed_repro. Intent: Make determinism harnesses that create worlds surface the Seed used (input or recorded) so long-run drift is reproducible. Delta: Existing determinism gates did not surface Seed as an explicit repro input%output for the long-run world-creating harness. Acceptance: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release passes including SimCore.Tests/Determinism/LongRunWorldHashTests.cs; long-run harness accepts Seed via STE_LONGRUN_SEED (default stable) and includes Seed in assertion failure messages; re-running with the same Seed yields identical world hash checkpoints at ticks 0, 1000, 5000, 10000 (A vs B); harness introduces no new nondeterminism sources. Status rules: TODO->IN_PROGRESS once Seed is part of the harness configuration or failure reporting; IN_PROGRESS->DONE when acceptance checks pass; BLOCKED if harness cannot be made seed-reproducible without broader refactor. Closure proof: LongRunWorldHashTests includes Seed in assertion messages and prints checkpoint hashes (0%1000%5000%10000) enabling repro via STE_LONGRUN_SEED. Evidence universe: Anchor=SimCore.Tests/Determinism/LongRunWorldHashTests.cs, Extra=SimCore/World/WorldLoader.cs | SimCore.Tests/Determinism/LongRunWorldHashTests.cs; SimCore/World/WorldLoader.cs |
| GATE.S2_5.SEEDS.006 | DONE | Axis: spec_docs. Intent: Define canonical Seed identity vocabulary and determinism%save%load regression reporting requirements in kernel docs, aligned to SaveLoadWorldHashTests. Acceptance: docs/21_90_TERMS_UNITS_IDS.md defines Seed (int32) and Seed%WorldId token; docs/20_TESTING_AND_DETERMINISM.md requires determinism%save%load regressions include Seed for repro and save envelope uses Seed + State; Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release passes incl SaveLoadWorldHashTests; closure proof: docs diffs in docs/21_90_TERMS_UNITS_IDS.md + docs/20_TESTING_AND_DETERMINISM.md and passing tests confirm contract alignment | docs/21_90_TERMS_UNITS_IDS.md; docs/20_TESTING_AND_DETERMINISM.md; SimCore.Tests/SaveLoad/SaveLoadWorldHashTests.cs |

### B4.6 Slice 2.5 worldgen gates (v0)

| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.S2_5.WGEN.GALAXY.001 | DONE | Deterministic galaxy topology v0: for a given Seed generate a connected starter region graph with MIN nodes=12 and MIN lanes=18; enforce MIN nodes at generator boundary; mint stable NodeId%LaneId via deterministic counters (no hash iteration); lane attributes include capacity and risk scalar default (r=0) in dump; emit diff-friendly dump to docs/generated/galaxy_topology_dump_seed_999_starcount_12_radius_100.txt with nodes sorted by NodeId and lanes sorted by FromId,ToId,LaneId; same Seed equals byte-for-byte. Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS | SimCore/Gen/GalaxyGenerator.cs; SimCore.Tests/GalaxyTests.cs; scripts/tests/test_galaxy_core.gd; scripts/core/sim/galaxy_generator.gd; scripts/core/galaxy_graph.gd; scenes/tests/test_galaxy_core.tscn; docs/generated/galaxy_topology_dump_seed_999_starcount_12_radius_100.txt |
| GATE.S2_5.WGEN.DISCOVERY_SEEDING.001 | DONE | Discovery seeding contract v0: added schema-bound DiscoverySeedSurfaceV0 (required fields + stable ID rule) and deterministic generator surface builder with explicit ordinal ordering; contract test hard-fails deterministically on missing fields or unstable IDs; no timestamps | Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release (142%142 PASS) | SimCore/Gen/GalaxyGenerator.cs; SimCore/Schemas/WorldDefinition.cs; SimCore.Tests/Invariants/DiscoverySeedingContractTests.cs |
| GATE.S2_5.WGEN.DISCOVERY_SEEDING.002 | DONE | Deterministic anomaly families + resource marker seeding v0 with per-seed-class guarantees; stable IDs; violations emitted as deterministic table (Seed%WorldClass%ReasonCode%PrimaryId) sorted by ReasonCode then PrimaryId then Seed. Closure: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS (144%144); per-WorldClass guarantees enforced via BuildDiscoverySeedSurfaceV0(state, seed) with stable DiscoveryId minting; violations table uses PrimaryId=WorldClassId and deterministic sort keys; batch guarantee test covers seeds 1..100. | SimCore/Gen/GalaxyGenerator.cs; SimCore/Entities/Node.cs; SimCore/Entities/IntelBook.cs; SimCore.Tests/GalaxyTests.cs |
| GATE.S2_5.WGEN.DISCOVERY_SEEDING.003 | DONE | Corridor trace seeding v0: deterministic corridor%trace seeding order with explicit tie-breaks (Ordinal); FractureTraveling fleet processing uses Ordinal-sorted fleet ids; includes fast ordering test that reports first mismatch deterministically (index%expected%actual); no timestamps | dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release | SimCore/Systems/FractureSystem.cs; SimCore/Entities/Edge.cs; SimCore.Tests/FractureTests.cs |
| GATE.S2_5.WGEN.DISCOVERY_SEEDING.004 | TODO | Deterministic discovery seeding report v0: runner command emits docs/generated/discovery_seeding_report_v0.txt over Seeds 1..100 with identity header (Seed range + worldgen params + content registry version%digest); exits nonzero on violations; stable formatting and ordering; no timestamps. Proof: dotnet run SimCore.Runner discovery-report | SimCore.Runner/Program.cs; SimCore/Gen/GalaxyGenerator.cs; docs/generated/content_registry_digest_v0.txt; docs/generated/discovery_seeding_report_v0.txt |
| GATE.S2_5.WGEN.DISCOVERY_SEEDING.005 | TODO | N-seed scenario proof v0: deterministic test runs discovery report twice and asserts byte-for-byte stability and guarantees; failure prints Seed%Phase%FirstDivergence with stable hashes; uses same formatter as report command | SimCore.Tests/Determinism/DiscoverySeedingScenarioProofTests.cs; SimCore.Tests/Determinism/LongRunWorldHashTests.cs; SimCore.Runner/Program.cs; docs/generated/discovery_seeding_report_v0.txt |
| GATE.S2_5.WGEN.DISCOVERY_SEEDING.006 | TODO | Tool readout v0 (CLI, no Godot UI): runner command emits player-readable Facts%Events style seeded discoveries for one seed; stable ordering and formatting; no timestamps. Proof: dotnet run SimCore.Runner discovery-readout | SimCore.Runner/Program.cs; SimCore/Gen/GalaxyGenerator.cs; docs/generated/discovery_readout_seed_42_v0.txt |
| GATE.S2_5.WGEN.ECON.001 | DONE | Deterministic economy placement v0 for starter region: generator assigns initial inventories plus demand sinks (fuel%ore%metal) for starter markets; define viable early trade loop as: loop hop_count<=4, net_profit_proxy>0 after fees, volume_proxy>0; assert at least 3 distinct loops exist; emit deterministic loop report to docs/generated/econ_loops_report.txt sorted by net_profit_proxy desc then route_id asc; deterministic across runs | SimCore/Gen/GalaxyGenerator.cs; SimCore.Tests/MarketTests.cs; SimCore.Tests/Determinism/LongRunWorldHashTests.cs; SimCore.Tests/GoldenReplayTests.cs; docs/generated/econ_loops_report.txt |
| GATE.S2_5.WGEN.FACTION.001 | DONE | Deterministic faction seeding v0: create exactly 3 factions with fields {FactionId, HomeNodeId, RoleTag, Relations[OtherFactionId] in {-1,0,+1}}; IDs minted deterministically; home selection seed-driven and deterministic; emit diff-friendly table sorted by FactionId plus relations matrix with rows%cols sorted; same Seed yields byte-for-byte identical outputs in both SimCore report and Godot test repr | scripts/core/sim/galaxy_generator.gd; scripts/tests/test_galaxy_core.gd; SimCore/Gen/GalaxyGenerator.cs; SimCore.Tests/GalaxyTests.cs; SimCore/Schemas/WorldDefinition.cs |
| GATE.S2_5.WGEN.WORLD_CLASSES.001 | DONE | Deterministic world classes v0: define exactly 3 classes (CORE, FRONTIER, RIM) and assign every node exactly one class deterministically; single measurable effect is fee_multiplier; invariant enforced: starter region contains at least 1 node of each class; emits deterministic per-node class list sorted by NodeId plus per-class effect summary | scripts/core/sim/galaxy_generator.gd; scripts/tests/test_universe_validator.gd; SimCore/Gen/GalaxyGenerator.cs |
| GATE.S2_5.WGEN.DISTINCTNESS.001 | DONE | World class distinctness report v0 (legacy combined): deterministic class stats extractor aggregates per-class metrics over Seeds 1..100 and enforces separation constraints (fee_multiplier separation and monotonic avg_radius2 ordering CORE < FRONTIER < RIM); negative case forces identical class params + single class assignment and deterministically FAILs with sorted violations; report emitted to docs/generated/class_stats_report_v0.txt (sorted, no timestamps) | SimCore/Gen/GalaxyGenerator.cs; SimCore.Tests/Determinism/LongRunWorldHashTests.cs; docs/generated/class_stats_report_v0.txt |
| GATE.S2_5.WGEN.DISTINCTNESS.REPORT.001 | DONE | World class distinctness report v0: deterministic, byte-for-byte stable CLASS_STATS_REPORT_V0 over seeds 1..100 using worldgen-era signals only (avg_degree, avg_lane_capacity, chokepoint_density, fee_multiplier, avg_radius2); explicit ordinal ordering (WorldClassId, axis) and invariant-culture formatting; no timestamps; test asserts exact stability across reruns and emits docs/generated/class_stats_report_v0.txt; full suite PASS | proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release (PASS) |
| GATE.S2_5.WGEN.DISTINCTNESS.TARGETS.001 | DONE | World class distinctness targets v0: deterministic targets enforcement over v0 report metrics (avg_radius2 ordering + fee_multiplier ordering); requires dominant constraints per class as measurable inequalities; emits deterministic targets report with sorted violations (Code ordinal, then Seed asc) including per-seed metric deltas; no timestamps; full suite PASS | Evidence: SimCore/Gen/GalaxyGenerator.cs;SimCore.Tests/Determinism/LongRunWorldHashTests.cs |
| GATE.S2_5.WGEN.INVARIANTS.001 | DONE | Worldgen onboarding invariants suite v0: CONNECTED_GRAPH, STARTER_REGION_SAFE_PATH (at least 1 path from starter hub to each starter market with max_chokepoints<=1), EARLY_LOOPS_MIN3 (>=3 viable loops as defined above). Harness runs headless and emits deterministic failure records {Seed, InvariantName, PrimaryId, DetailsKV} sorted by InvariantName then PrimaryId then Seed; report is byte-for-byte stable; exits 0 after emitting report and PASS%FAIL summary | scripts/tests/test_universe_validator.gd; scripts/tests/test_galaxy_core.gd; scripts/tests/test_economy_core.gd; scripts/core/sim/rng_streams.gd |
| GATE.S2_5.WGEN.DISTRIBUTION.001 | DONE | Worldgen distribution bounds v0 (ultra-loose) over N=100 seeds: for a small fixed starter goods set, each good must have at least 1 producer station and at least 1 sink station in the starter region (no missing producers or missing sinks); deterministic summary includes counts per good and failing seeds list sorted asc; exits nonzero on violations; report emitted to docs/generated/worldgen_distribution_bounds_report_v0.txt | SimCore.Tests/MarketTests.cs; SimCore/Gen/GalaxyGenerator.cs; SimCore/Systems/MarketSystem.cs; docs/generated/worldgen_distribution_bounds_report_v0.txt |
| GATE.S2_5.WGEN.NSEED.001 | DONE | N-seed batch worldgen test v0: run invariants for Seeds 1..N where N=100; emit deterministic summary with counts per InvariantName and capped failing seed lists (sorted asc) and capped failure records (sorted as invariants gate); exits nonzero if any failure; output byte-for-byte stable; golden SHA256 enforced (update via STE_UPDATE_INVARIANTS_BATCH_GOLDEN) | SimCore.Tests/Determinism/LongRunWorldHashTests.cs; SimCore.Tests/Invariants/BasicStateInvariantsTests.cs; SimCore/Gen/GalaxyGenerator.cs |
| GATE.S2_5.SAVELOAD.WORLDGEN.001 | DONE | Worldgen save%load contract v0 (momentum-safe): save%load crash-free and preserves stable NodeId%LaneId plus core worldgen state (econ placement, faction tables, world classes); post-load world hash matches pre-save; key dumps deterministic (format stable, no timestamps). Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS; SaveLoad seed expected=saved=resaved=123; Before hash == After hash | SimCore.Tests/SaveLoad/SaveLoadWorldHashTests.cs; SimCore/Systems/SerializationSystem.cs; SimCore/World/WorldLoader.cs |
| GATE.S2_5.TOOL.SEED_EXPLORER.001 | DONE | Seed explorer tooling v0: seed-explore emits deterministic artifacts under docs/generated (topology_summary.txt, econ_loops.txt, invariants.txt); seed-diff takes SeedA%SeedB and emits diff_topology.txt (added%removed nodes%lanes) and diff_loops.txt (added%removed loops by route_id); outputs byte-for-byte stable (UTF-8 no BOM) and contain no timestamps; v0 knobs centralized in SeedExplorerV0Config with CLI overrides. Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS | SimCore.Tests/Determinism/LongRunWorldHashTests.cs; SimCore.Runner/Program.cs; SimCore/Gen/GalaxyGenerator.cs; scripts/tools/seed_determinism_smoke.gd |

### B5. Slice 3 logistics gates (v1)
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.ROUTE.001 | DONE | Deterministic route planner exists: from node to node => ordered edges/nodes + total travel ticks (stable tie-breaks by EdgeId/NodeId) | SimCore/Systems/RoutePlanner.cs + SimCore.Tests/Systems/RoutePlannerTests.cs |
| GATE.FLEET.ROUTE.001 | DONE | Fleet travel can follow a planned multi-edge route (lane sequence) without nondeterminism | SimCore/Systems/MovementSystem.cs + SimCore/Entities/Fleet.cs + SimCore.Tests/Systems/FleetRouteTravelTests.cs |
| GATE.LOGI.JOB.001 | DONE | LogisticsJob can represent multi-hop shipments (source, sink, good, qty, route) and is deterministic | SimCore/Entities/LogisticsJob.cs + SimCore.Tests/Systems/LogisticsJobContractTests.cs |

### B6. Slice 3 logistics execution gates (v1)
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.LOGI.CARGO.001 | DONE | Fleet has deterministic cargo storage (dict keyed by GoodId) that round-trips through save/load; cargo changes only via intent resolution (no direct mutation in LogisticsSystem) | SimCore/Entities/Fleet.cs + SimCore/Systems/SerializationSystem.cs + SimCore.Tests/SaveLoad/FleetCargoSaveLoadContractTests.cs |
| GATE.LOGI.XFER.001 | DONE | Deterministic load/unload intents+commands exist: market inventory <-> fleet cargo; operations clamp to available inventory/cargo; never produce negative counts | SimCore/Intents/LoadCargoIntent.cs + SimCore/Intents/UnloadCargoIntent.cs + SimCore/Commands/LoadCargoCommand.cs + SimCore/Commands/UnloadCargoCommand.cs + SimCore.Tests/Systems/LogisticsTransferContractTests.cs |
| GATE.LOGI.EXEC.001 | DONE | LogisticsJob executes end-to-end across ticks under kernel order: follow planned route legs, travel to source, issue load once (latched), travel to target, issue unload once (latched), clear job; no double-issue while idle at node | SimCore/Systems/LogisticsSystem.cs + SimCore/Entities/LogisticsJob.cs + SimCore.Tests/Systems/LogisticsJobExecutionTests.cs |
| GATE.LOGI.DET.001 | DONE | Multi-fleet logistics determinism regression: 2 fleets executing jobs in the same world yields stable final world hash (tie-break by Fleet.Id for lane capacity, job advancement, and intent emission) | SimCore.Tests/Determinism/LogisticsMultiFleetDeterminismTests.cs |
| GATE.LOGI.MUT.001 | DONE | Single mutation pipeline contract: Commands may enqueue intents only; ONLY kernel intent resolution may mutate cargo and market inventory; LogisticsSystem and command handlers must not directly mutate cargo/inventory (guard with tests) | SimCore.Tests/Sustainment/LogisticsMutationPipelineContractTests.cs |
| GATE.LOGI.EVENT.001 | DONE | Logistics emits schema-bound, deterministic events for phase transitions and actions (Assign, ArriveSource, LoadIssued, Loaded, ArriveSink, UnloadIssued, Unloaded, Complete, Canceled); event ordering is stable under ties | SimCore/Events/LogisticsEvents.cs + SimCore.Tests/Systems/LogisticsEventStreamContractTests.cs |
| GATE.LOGI.SAVE.001 | DONE | Save/load preserves active logistics execution: mid-job phase, latched transfer state, route progress index, remaining amount, and any reservations restore deterministically; replay after load matches uninterrupted final hash | SimCore.Tests/SaveLoad/SaveLoadLogisticsMidJobTests.cs |
| GATE.LOGI.ORDER.001 | DONE | Logistics ordering deterministic under contention (multiple fleets, same tick) | SimCore.Tests/Determinism/LogisticsOrderingDeterminismTests.cs |

### B7. Slice 3 logistics fulfillment correctness gates (v1)
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.LOGI.FULFILL.001 | DONE | Partial pickup supported: if supplier inventory < job.Amount, pickup clamps deterministically and job tracks remaining amount (no negatives, no “complete without goods”) | SimCore/Systems/LogisticsSystem.cs + SimCore/Entities/LogisticsJob.cs + SimCore.Tests/Systems/LogisticsPartialFulfillmentTests.cs |
| GATE.LOGI.RETRY.001 | DONE | If pickup yields 0 for N consecutive ticks at source (supplier empty), job deterministically retries up to N observations then cancels (defined behavior; tested) | SimCore/Systems/LogisticsSystem.cs + SimCore/Entities/LogisticsJob.cs + SimCore.Tests/Systems/LogisticsRetryOrCancelContractTests.cs |
| GATE.LOGI.CANCEL.001 | DONE | Job cancel is deterministic: releases any latched transfer state, clears route state safely, and leaves fleet in a consistent Idle state | SimCore/Systems/LogisticsSystem.cs + SimCore.Tests/Systems/LogisticsCancelContractTests.cs |
| GATE.LOGI.RESERVE.001 | DONE | Planner can optionally reserve supplier inventory at assignment time to prevent over-allocation; reservation release is deterministic on cancel/complete | SimCore/Entities/LogisticsReservation.cs + SimCore/SimState.cs + SimCore/Commands/LoadCargoCommand.cs + SimCore/Systems/LogisticsSystem.cs + SimCore.Tests/Systems/LogisticsReservationContractTests.cs |

### B8. Slice 3 fleet control surface gates (v1)
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.UI.FLEET.001 | DONE | Read-only Fleet panel lists fleets sorted by Fleet.Id and shows: current node, state, job phase, job good/remaining, cargo summary, and route progress (edge index/total) | scripts/ui/FleetMenu.cs + scripts/bridge/SimBridge.cs |
| GATE.UI.FLEET.002 | DONE | Player can cancel a fleet job via command (no direct mutation) and sees deterministic state transition (job cleared, route cleared, task updated) | scripts/ui/FleetMenu.cs + scripts/bridge/SimBridge.cs + SimCore/Commands/FleetJobCancelCommand.cs + SimCore.Tests/Systems/FleetJobCancelContractTests.cs |
| GATE.UI.FLEET.003 | DONE | Manual destination override exists via command and persists through save/load; override semantics are defined (overrides job routing until cleared) and deterministic | scripts/ui/FleetMenu.cs + scripts/bridge/SimBridge.cs + SimCore/Commands/FleetSetDestinationCommand.cs + SimCore.Tests/SaveLoad/FleetManualOverrideSaveLoadContractTests.cs |
| GATE.UI.FLEET.AUTH.001 | DONE | Authority and precedence contract is explicit and enforced: each fleet reports ActiveController (None, Program, LogisticsJob, ManualOverride) with deterministic precedence ManualOverride > LogisticsJob > Program > None; issuing ManualOverride deterministically cancels any active LogisticsJob (reason token stable) and clears latched transfer state; clearing ManualOverride does not resume canceled jobs | SimCore/Entities/Fleet.cs + SimCore/Commands/FleetSetDestinationCommand.cs + SimCore.Tests/Systems/FleetAuthorityPrecedenceContractTests.cs |
| GATE.UI.FLEET.EVENT.001 | DONE | Fleet panel shows last N schema-bound events relevant to that fleet (logistics phase transitions, cancel, override) with deterministic ordering and stable serialization; UI renders newest-first event list via SimBridge snapshot | scripts/ui/FleetMenu.cs; scripts/bridge/SimBridge.cs; SimCore/Events/LogisticsEvents.cs; SimCore/Entities/Fleet.cs; SimCore.Tests/Systems/LogisticsEventStreamContractTests.cs; SimCore.Tests/Programs/FleetBindingContractTests.cs |
| GATE.UI.FLEET.DET.001 | DONE | Determinism regression for UI command interleavings: 2 fleets, scripted sequence across ticks (cancel, manual override, clear override) with save/load mid-sequence is deterministic; yields identical final world signature across runs | scripts/ui/FleetMenu.cs; scripts/bridge/SimBridge.cs; SimCore/Entities/Fleet.cs; SimCore.Tests/Determinism/LogisticsMultiFleetDeterminismTests.cs; SimCore.Tests/SaveLoad/FleetManualOverrideSaveLoadContractTests.cs |
| GATE.PROG.UI.001 | DONE | Program vs ManualOverride interaction is defined and deterministic: issuing ManualOverride cancels any active LogisticsJob for that fleet and emits a schema-bound ManualOverrideSet event; ProgramSystem deterministically consumes ManualOverrideSet and pauses fleet-bound programs before intent emission; interaction is contract-tested | SimCore/Programs/ProgramSystem.cs; SimCore/Programs/ProgramBook.cs; scripts/ui/ProgramsMenu.cs; SimCore.Tests/Programs/ProgramContractTests.cs; SimCore.Tests/Programs/ProgramLifecycleContractTests.cs; SimCore/Commands/FleetSetDestinationCommand.cs; SimCore/Events/LogisticsEvents.cs; SimCore/Programs/ProgramInstance.cs |
| GATE.UI.FLEET.PLAY.001 | DONE | First playable fleet capstone is accessible and verifiable in-game: boot playable_prototype scene, dock at station, StationMenu exposes Fleets entrypoint, Fleet panel supports deterministic selection, CancelJob, Override, ClearOverride; selected fleet shows deterministic newest-first event tail; Save/Load mid-sequence preserves visible fleet state and event tail; headless smoke emits deterministic transcript with stable hash including Seed, tick, per-fleet state and ordered event tail | scenes/playable_prototype.tscn + scripts/ui/StationMenu.cs + scripts/ui/FleetMenu.cs + scripts/bridge/SimBridge.cs + SimCore/Entities/Fleet.cs + SimCore/Commands/FleetJobCancelCommand.cs + SimCore/Commands/FleetSetDestinationCommand.cs |

### B9. Slice 3 programs and logistics explainability gates (v1)
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.UI.PROGRAMS.001 | DONE | Programs screen minimal readout via SimBridge facts only; deterministic ordering enforced (ordinal) for program list and detail fields; headless UI smoke clean; gate validation passes | scripts/ui/ProgramsMenu.cs; scripts/bridge/SimBridge.cs; SimCore/Programs/ProgramSystem.cs; SimCore/Programs/ProgramInstance.cs |
| GATE.UI.PROGRAMS.EVENT.001 | DONE | Programs screen shows last N program events with deterministic ordering (Seq-desc, stable ties), stable serialization through save%load (quicksave v2 wraps kernel JSON + program event log), and clickable entity references (id links copy to clipboard). Note: no causal attribution yet from program events to logistics%movement event stream | scripts/ui/ProgramsMenu.cs; scripts/bridge/SimBridge.cs; SimCore/Programs/ProgramExplain.cs; SimCore/Programs/ProgramSystem.cs |
| GATE.UI.LOGISTICS.001 | DONE | Logistics screen minimal readout via SimBridge facts: active jobs touching current market plus bottlenecks summary from buffer deficits; nonblocking snapshot (cached when sim lock busy); deterministic ordering for displayed lists (jobs by fleet_id ordinal; bottlenecks by deficit desc, then good_id ordinal, then site_id ordinal) | scripts/ui/StationMenu.cs; scripts/bridge/SimBridge.cs; SimCore/Systems/LogisticsSystem.cs; SimCore/Entities/LogisticsJob.cs |
| GATE.UI.LOGISTICS.EVENT.001 | DONE | Station logistics panel renders deterministic incident timeline (newest first) sourced from schema-bound LogisticsEventLog; zero-pickup cancel incident expands into traversable cause chain of preceding pickup observations; stable snapshot serialization and ordering (Seq desc with tie-breakers) | scripts/ui/StationMenu.cs; scripts/bridge/SimBridge.cs; SimCore/Events/LogisticsEvents.cs; SimCore/Systems/LogisticsSystem.cs |
| GATE.UI.EXPLAIN.PLAY.001 | DONE | Explainability capstone: guided headless path deterministically triggers one representative failure (credits constraint) and surfaces the full why chain; output captured to docs/generated/phase3_explain_capstone_stdout.txt with stable hash64= for repro; save%load preserves explanation transcript hash (no post-load tick advance); end-to-end headless proof exits 0 | scripts/tests/phase3_explain_capstone.gd; scripts/bridge/SimBridge.cs; scripts/ui/StationMenu.cs; scripts/ui/ProgramsMenu.cs; SimCore/World/WorldLoader.cs; SimCore/Events/LogisticsEvents.cs; docs/generated/phase3_explain_capstone_stdout.txt |
| GATE.UI.DOCK.NONSTATION.001 | DONE | Non-station docking UI market resolution: docking at any StarNode deterministically opens StationMenu without F9; PlayerShip emits shop_toggled(true, dock_id) for both stations and non-stations by resolving id via get_sim_market_id() else sim_market_id meta else node.name; StationMenu remains usable (Undock, Fleets, Save%Load, Explain) while market panel degrades explicitly N/A when dock_id has no market mapping; no ERROR spam from market resolution on non-market nodes | scripts/player.gd; scripts/view/GalaxyView.cs; scripts/view/StarNode.cs; scripts/ui/StationMenu.cs; scripts/bridge/SimBridge.cs; scenes/playable_prototype.tscn |

### B10. Slice 3 scaling and economy gates (v0)

| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.S3.ROUTES.001 | DONE | Multi-route primitives v0: RoutePlanner generates multiple route candidates (>=2) in a crafted map using deterministic DFS over edge-id sorted adjacency; deterministic ordering and selection tie-break is enforced as: fewer hops, then lower risk proxy score, then lex route_id; LogisticsSystem emits schema-bound RouteChosen explain event with fields {OriginId, DestId, ChosenRouteId, CandidateCount, TieBreakReason} (emitted only when CandidateCount>=2 to reduce spam); regression tests cover (1) candidate ordering by hops%risk%route_id and (2) equal-hop stable choice with TieBreakReason=ROUTE_ID plus schema validation for RouteChosen event | SimCore/Systems/RoutePlanner.cs; SimCore/Systems/LogisticsSystem.cs; SimCore/Events/LogisticsEvents.cs; SimCore.Tests/Systems/RoutePlannerTests.cs |
| GATE.S3.FLEET.ROLES.001 | DONE | Fleet roles v0: explicit roles (Trader, Hauler, Patrol) deterministically affect exactly one decision surface (route-choice selection): Trader prefers profit score, Hauler prefers capacity score, Patrol prefers low-risk score; emit schema-bound FleetEvents.RouteChoice for each resolved competing choice; persist chosen route id on Fleet (LastRouteChoiceRouteId) through save%load; ordering%serialization stable | SimCore/Entities/Fleet.cs; SimCore/Systems/IntentSystem.cs; SimCore/SimState.cs; SimCore/Events/FleetEvents.cs; SimCore.Tests/Systems/FleetAuthorityPrecedenceContractTests.cs |
| GATE.S3.CAPACITY_SCARCITY.001 | DONE | Lane capacity scarcity v0 (queueing model): each lane has capacity K per tick enforced at delivery; if >K transfers arrive on same lane same tick, deliver in deterministic order (ArriveTick, LaneId, TransferId) up to K and deterministically queue overflow by bumping ArriveTick=Tick+1; lane utilization report v0 emitted deterministically sorted by lane_id; regression scenario covered: capacity K=5 overload produces partial fill and queued remainder with stable per-transfer remainders across ticks | SimCore/Systems/LaneFlowSystem.cs; SimCore.Tests/Systems/LaneFlowSystemTests.cs; SimCore/Systems/LogisticsSystem.cs; SimCore/Gen/GalaxyGenerator.cs |
| GATE.S3.MARKET_ARB.001 | DONE | Anti-exploit market arb constraint v0: explicit money-printer scenario constrained; unbounded profit prevented via exactly two frictions (v0): transaction_fee (TransactionFeeBps=100 with nonzero fee sink) and lane_capacity scarcity (queueing observed); acceptance: T=600 vs T=300 bounded_check PASS; reason codes emitted (lane_cap_queued_ticks and fee_total_credits%no-fee proxy); outputs deterministic | SimCore.Tests/MarketTests.cs; SimCore/Systems/MarketSystem.cs; SimCore/Systems/LaneFlowSystem.cs; SimCore/Systems/LogisticsSystem.cs; docs/generated/market_arb_constraint_report.txt |
| GATE.S3.RISK_MODEL.001 | DONE | Risk model incidents v0: deterministic lane%route risk bands emit schema-bound SecurityEvents (delay, loss, inspection) with deterministic cause chains; RiskModelV0 routes constants (tweak-guard clean); surfaced in Station timeline via SimBridge; deterministic replay and save%load preserved; non-goal: Slice 5 combat coupling | docs/56_SESSION_LOG.md (GATE.S3.RISK_MODEL.001 PASS) |
| GATE.S3.UI.DASH.001 | DONE | Dashboards v0: StationMenu exposes deterministic metrics from the last snapshot tick via SimBridge snapshot: total_shipments, avg_delay_ticks, top3_bottleneck_lanes, top3_profit_loops; ordering stable (ties broken lex); save%load persists selected Station view index and last dashboard snapshot tick in STE_QUICKSAVE_V2; deterministic serialization preserved. Note: top3_bottleneck_lanes is v0 derived from logistics event note parsing; top3_profit_loops is a price-diff proxy loop metric (v0 scaffolding) | scripts/bridge/SimBridge.cs; scripts/ui/StationMenu.cs; SimCore/Systems/SerializationSystem.cs; SimCore/Systems/SustainmentReport.cs |
| GATE.S3.PERF_BUDGET.001 | DONE | Perf budget v0 for Slice 3: fixed scenario (seed=424242, deterministic map) runs 600 ticks; measures avg tick time over last 300 ticks via Stopwatch around Step(); enforces budget_ms_per_tick constant and emits PERF_BUDGET_REPORT_V0 (invariant formatting); includes deterministic guard test that fails when budget exceeded; scenario load check fleets>=50 and active_transfers>=200 satisfied via deterministic synthetic seeding of SimState.InFlightTransfers (v0 stopgap) | SimCore.Tests/Determinism/LongRunWorldHashTests.cs; SimCore.Tests/GoldenReplayTests.cs; SimCore/SimKernel.cs; SimCore/Systems/BandedTime.cs |
| GATE.S3.SAVELOAD.SCALING.001 | DONE | Scaling save%load contract v0 (momentum-safe): save%load crash-free and preserves lane capacity queues (in-flight deferral ArriveTick>DepartTick for injected lane-pressure transfers), chosen routes (LogisticsEventLog ChosenRouteId%TieBreakReason), and market fee state (WorldClasses FeeMultiplier); replaying from save yields identical per-tick signature (event-stream proxy) and final world hash under the same command script | SimCore.Tests/SaveLoad/SaveLoadLogisticsMidJobTests.cs; SimCore/Systems/LaneFlowSystem.cs; SimCore/Systems/SerializationSystem.cs |
| GATE.UI.PLAY.TRADELOOP.SAVELOAD.001 | DONE | Play loop save%load v0: during an active trade loop, save%load preserves visible state (selected fleet via STE_QUICKSAVE_V2 UiState.SelectedFleetId, active job continuation), and after continuing to completion yields identical final world hash and identical per-fleet event stream across uninterrupted vs save%load runs; FleetMenu restores persisted selection deterministically and clears it if the fleet no longer exists | SimCore.Tests/SaveLoad/SaveLoadLogisticsMidJobTests.cs; scripts/bridge/SimBridge.cs; scripts/ui/FleetMenu.cs |
| GATE.UI.PLAY.TRADELOOP.001 | DONE | First playable trade loop v0: headless buy%ship%sell completes and emits deterministic transcript (no timestamps); repeat-run transcript SHA256 matches 9F3AFB559B9EDFE8D582FA182557AFCFE0D52594872EE6FC98C03DB260E53AE3 | scripts/tests/test_player_trading.gd; artifacts/trade_loop/transcript_run1.txt; artifacts/trade_loop/transcript_run2.txt |

### B10.5 Slice 3.5 content substrate foundations gates (v0)

| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.S3_5.CONTENT_SUBSTRATE.001 | DONE | Content substrate foundations v0: implemented minimal authored-pack contract for ContentRegistry v0 (version=0, schema validation with additionalProperties=false enforced at root and nested objects, canonical IDs, deterministic normalization and load order); emits deterministic docs/generated/content_registry_digest_v0.txt; added negative contract tests rejecting unknown root and nested fields with Ordinal-sorted diagnostics; proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS (137/137) | Evidence: SimCore/Content/ContentRegistryLoader.cs;SimCore/Schemas/ContentRegistrySchema.json;SimCore.Tests/Content/ContentRegistryContractTests.cs;docs/content/content_registry_v0.json;docs/generated/content_registry_digest_v0.txt |
| GATE.S3_5.CONTENT_SUBSTRATE.002 | DONE | Content substrate pack validation report v0: deterministic validator emits docs/generated/content_pack_validation_report_v0.txt (no timestamps; stable ordering; failures sorted Ordinal) and fails deterministically on invalid packs via contract test; full SimCore.Tests Release PASS; report byte-for-byte stable across reruns (SHA256=A9DF4EC8CEED1BC2FC7DA04FB1AE446D16495D22E3E2E85E39C33734A6735688). Evidence: SimCore.Tests/Content/ContentRegistryContractTests.cs;SimCore/Content/ContentRegistryLoader.cs;SimCore/Schemas/ContentRegistrySchema.json;docs/content/content_registry_v0.json;docs/generated/content_pack_validation_report_v0.txt | 2026-02-24 |
| GATE.S3_5.CONTENT_SUBSTRATE.003 | DONE | Content substrate world binding v0: content pack identity (ContentPackIdV0%ContentPackVersionV0) is persisted through save%load and asserted in SaveLoadWorldHashTests; Validate-Gates OK; SimCore.Tests Release PASS. Non-goal: authored pack selection UI. | Evidence: SimCore.Tests/SaveLoad/SaveLoadWorldHashTests.cs | 2026-02-24 |
| GATE.S3_5.CONTENT_SUBSTRATE.004 | DONE | Content substrate integration guard v0: added deterministic contract test scanning SimCore/Systems and SimCore/Gen for hardcoded content IDs (goods%recipes%modules) sourced from ContentRegistryLoader; emits sorted docs/generated/evidence/gate_evidence_grep.txt; fails on non-allowlisted violations; legacy allowlist prints WARN block each run; deterministic ordering path%line%id | Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS |

### B11. Slice 4 industry gates (v0)
| Gate ID | Status | Gate | Evidence |
|---|---|---|---|
| GATE.S4.INDU.MIN_LOOP.001 | DONE | Industry minimal loop v0: deterministic industry site processing with ordinal ordering; opt-in construction pipeline produces cap_module via schema-bound stages; persisted build state and deterministic industry event stream; StationMenu readout via SimBridge; save%load and replay stability preserved; tweak routing guard satisfied via IndustryTweaksV0 | docs/56_SESSION_LOG.md (GATE.S4.INDU.MIN_LOOP.001 PASS) |
| GATE.S4.INDU_STRUCT.001 | DONE | Industry structure v0: extended schema%processing to support deterministic byproducts; enforced bounded input%output%byproduct overlap rules (no input production; byproducts cannot shadow outputs); added contract test proving ordering independence from Dictionary insertion order; save%load stability preserved | 2026-02-24 PASS (dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release; 141 passed). Evidence: SimCore.Tests/industry/IndustryProgramContractTests.cs;SimCore/Systems/IndustrySystem.cs;SimCore/Entities/IndustrySite.cs;SimCore/Schemas/IndustrySchema.json |
| GATE.S4.CONSTR_PROG.001 | DONE | Construction programs v0: added CONSTR_CAP_MODULE_V0 program kind with deterministic executor supplying stage inputs via SellIntent; integration test proves recipe consumption and cap_module production via tick pipeline; full SimCore.Tests Release PASS | 2026-02-24, main, PASS. Evidence: SimCore/Programs/ProgramSystem.cs;SimCore/Programs/ProgramKind.cs;SimCore/Programs/ProgramInstance.cs;SimCore/SimState.cs;SimCore/Schemas/ProgramSchema.json;SimCore.Tests/Programs/ProgramExecutionIntegrationTests.cs |
| GATE.S4.UI_INDU.001 | DONE | Industry UI v0: deterministic “why blocked” chain and “what to build next” suggestion surface for construction%industry using Facts%Events only. SimBridge emits why_blocked_chain and next_actions snapshot fields; StationMenu renders deterministic chain%actions with stable ordering; Validate-Gates PASS; SimCore.Tests Release PASS (142). Evidence: scripts/bridge/SimBridge.cs;scripts/ui/StationMenu.cs;SimCore/Systems/IndustrySystem.cs;SimCore/Programs/ProgramSystem.cs | - 2026-02-25, main, GATE.S4.UI_INDU.001 PASS (Industry UI v0: added SimBridge why_blocked_chain and next_actions Facts-only snapshot fields; StationMenu renders deterministic chain and suggestions with stable ordering; Validate-Gates and tests PASS). Evidence: scripts/ui/StationMenu.cs;scripts/bridge/SimBridge.cs;SimCore/Systems/IndustrySystem.cs;SimCore/Programs/ProgramSystem.cs |
| GATE.S4.PERF_BUDGET.001 | DONE | Perf budget v0 for Slice 4: deterministic scenario runs N ticks with industry%construction active and enforces budget_ms_per_tick with deterministic report; adds Slice 4 budget test with explicit scenario load checks (construction_enabled_sites>=1, industry_build_states>=1) and emits PERF_BUDGET_REPORT_V0 including ticks_total%ticks_measured%budget_ms_per_tick%avg_ms_per_tick | Evidence: SimCore.Tests/Determinism/LongRunWorldHashTests.cs;SimCore/SimKernel.cs;SimCore/Systems/IndustrySystem.cs;docs/20_TESTING_AND_DETERMINISM.md. Proof: dotnet test SimCore.Tests/SimCore.Tests.csproj -c Release PASS (142 tests); PERF_BUDGET_REPORT_V0 emitted for seed=434343 with construction_enabled_sites=1 and industry_build_states=1 |
