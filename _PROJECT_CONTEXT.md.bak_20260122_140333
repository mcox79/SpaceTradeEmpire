# SPACE TRADE EMPIRE - MASTER CONTEXT
# ===================================

## 1. THE FOUNDER PROTOCOL
# ------------------------
# - **Voice:** Pragmatic, Commercial, Technical.
# - **Output:** Direct Code Blocks -> Implementation Steps -> Verification.
# - **Meta-Rule:** If the project structure changes significantly (new systems), you MUST propose an updated version of this file.

## 2. RECOVERY & TOOLCHAIN
# ------------------------
# [DevTools Recovery Block]
#   If `DevTool.ps1` is lost, write a script that:
#   1. Concatenates all .gd/.tscn files into `_FullProjectContext.txt`.
#   2. Wraps `git add/commit` and `git reset --hard` into GUI buttons.

## 3. ARCHITECTURE & STANDARDS (STRICT)
# -------------------------------------
# - **File Org:**
#     - `/scenes`: Visuals & Prefabs.
#     - `/scripts`: Logic.
#     - `/assets`: Raw imports (models, sounds).
# - **Naming:** #     - Nodes: PascalCase (e.g., `ScoreLabel`).
#     - Scripts/Files: snake_case (e.g., `game_manager.gd`).
# - **Design Patterns:**
#     - **Signal Bus (CURRENT):** Use direct signals for now (e.g., Player -> HUD). Add an Autoload bus only when two unrelated systems need it.
#     - **Composition:** Avoid deep inheritance. Use Child Nodes to add features.
# - **Camera Law (ACTIVE)**
#     - Camera is defined in `scenes/player.tscn` at `CameraMount/Camera3D`.
#     - No runtime camera creation in scripts. (`Camera3D.new()` is banned in gameplay code.)
#     - Only `scripts/player.gd` may set `my_camera.current = true`, and only for `CameraMount/Camera3D`.
#     - No other scene may define a gameplay camera without an explicit decision and doc update.
#     - Debug cameras must live in dedicated debug-only scenes (never attached to production nodes).

## 4. CURRENT SPRINT STATUS
# -------------------------
# - **Phase:** MVP Economy Implementation.
# - **Active Task:** Wiring `Asteroid` -> `GameManager` -> `HUD`.
# - **Next Up:** "Infinite Demand" (Spawner System).


## GAME DEFINITION (LOCKED)

### Core Fantasy
You are not the hero pilot.  
You are the logistics backbone of a civilization at war.

Your influence is indirect. You shape outcomes by moving goods, scaling fleets, stabilizing supply chains, and starving enemies of resources.

Combat exists to protect trade. Trade exists to win the war.

---

### Genre
Single-player, long-horizon space trading and fleet management game with light combat and a persistent galactic conflict.

Inspirational reference points: Endless Sky, Starcom  
Structural focus: trading-first, fleet-scale decision making.

---

### Primary Loop (NON-NEGOTIABLE)

1. Scout markets and routes  
2. Acquire goods (mining, purchase, salvage)  
3. Move goods through contested space  
4. Sell or allocate goods to stations and factions  
5. Reinvest profits into ships, fleets, and infrastructure  
6. Repeat at larger scale under increasing pressure

If a mechanic does not reinforce this loop, it is secondary.

---

### Progression Axes

**A. Economic Scale (Primary)**  
- Capital  
- Cargo throughput  
- Market leverage  
- Access to scarce goods and high-impact routes  

**B. Fleet Control (Secondary, Differentiating)**  
- Multiple ship roles: traders, miners, escorts, patrols  
- Delegated behavior: routes, objectives, risk tolerance  
- Loss is possible and meaningful  

**C. Technology (Tertiary)**  
- Unlocks new economic and logistical behaviors  
- Military tech is an enabler, not the end goal  

---

### The War (Framing Constraint)

The war is a systemic pressure, not a narrative RPG.

- Two sides: human civilization vs an aggressive alien force  
- The war advances regardless of player action  
- Player influence is expressed through supply, logistics, and economic stabilization  
- There is no chosen one narrative  

If the player stops trading, the war continues and goes badly.

---

### Run Structure

- Endless, evolving sandbox  
- No hard win or game over state  
- Major inflection points and regional outcomes exist  
- The universe reacts, but does not conclude  

---

### Pressure and Failure

At least two of the following must always apply:

- Escalating external threats (pirates, incursions)  
- Capital risk (ship loss, sunk cost, opportunity loss)  
- Strategic time pressure (markets and war state evolve)  

Fleet management must involve real risk, not just optimization.

---

### Design Invariants

- Trade dominance is the primary source of power  
- Logistics beats tactics  
- Determinism over spectacle  
- Systems over scripts  
- Player agency through scale, not micromanagement  

---

### Explicit Non-Goals

- No realtime multiplayer  
- No live-service mechanics  
- No narrative-heavy branching RPG  
- No crew simulation  
- No high-fidelity physics  
- No tactical fleet combat micromanagement  

## TECHNOLOGY AND STRATEGIC INFLUENCE (LOCKED PRINCIPLES)

### Technology Structure

Technology progression is modeled as a **directed acyclic graph (DAG)**, not a strict tree.

- Each technology node may have **multiple prerequisites**
- Prerequisites may span multiple domains
- Cycles are not allowed
- Unlock logic must be deterministic and testable

The purpose of the graph is to support **multiple viable pathways** to similar capabilities, reflecting different strategic choices rather than linear progression.

---

### Technology Domains

Technology nodes are partitioned into explicit domains:

- **Trade & Logistics** (primary)
- **Fleet Operations**
- **Mining & Extraction**
- **Industry & Manufacturing**
- **Defense & Combat**
- **Intelligence & Espionage**

Domains exist to enforce design constraints, not to silo systems.

---

### Cross-Domain Governance Rules

To prevent uncontrolled graph complexity:

- A technology node may have **at most two cross-domain prerequisites**
- Any **Combat-domain** technology must require at least one prerequisite from:
  - Trade & Logistics, or
  - Fleet Operations
- Trade & Logistics technologies may never require Combat prerequisites

These rules enforce the invariant that **logistics and trade remain foundational**, and combat remains subordinate.

---

### Unlock Vectors

Technology unlocks may be gated by one or more of the following vectors:

1. **Economic Contribution**
   - Credits accumulated
   - Goods delivered
   - Sustained trade volume
2. **Strategic Support**
   - Supplying specific regions or fronts
   - Maintaining logistics under pressure
   - Stabilizing critical systems
3. **Intelligence Actions**
   - Espionage investments
   - Information acquisition
   - Long-horizon, probabilistic outcomes

Unlock conditions may combine vectors, but must be expressible as explicit rules.

---

### Regional and Factional Specialization

Some technologies are **contextually unlocked**:

- Certain regions or factions enable access to specialized technology paths
- Access is earned through sustained logistical or strategic support
- These unlocks reflect **capability transfer**, not allegiance or narrative choice

Technology access may be global once unlocked, or restricted by context, but this must be explicit per node.

---

### Espionage (System Boundary)

Espionage is a **strategic, abstract system**, not a tactical mechanic.

- Player commits resources
- Time passes
- Outcomes are uncertain but bounded
- Results unlock information, technology access, or economic advantages

Espionage does not involve:
- Tactical gameplay
- Character control
- Stealth mechanics

It exists to introduce **risk, delay, and alternative pathways** into the tech graph.

---

### Technology Effects

Technology unlocks grant **capabilities**, not narrative rewards.

Examples of effects:
- New ship behaviors
- New fleet-level automation
- Access to new goods or manufacturing
- Improved routing, sensing, or risk mitigation

Technologies should enable **new economic behaviors**, not simply increase numeric stats.

---

### Design Invariants (Reinforced)

- Technology reinforces trade-first gameplay
- Multiple pathways are always preferred to linear progression
- Player agency comes from strategic choice, not grind
- Systems remain deterministic and testable
- Content is layered atop structure, not baked into it


## INFORMATION FLOW AND PLAYER KNOWLEDGE (LOCKED PRINCIPLES)

### Information as a Strategic Resource

Information is **incomplete, delayed, and unevenly distributed**.

Perfect knowledge is never assumed. Improving information quality is a core axis of progression, on par with ships, fleets, and technology.

The player wins by **making better decisions with imperfect data**, not by reacting instantly.

---

### Baseline Visibility

At any moment, the player has access to:

- Confirmed information about:
  - Their own assets (ships, fleets, cargo, credits)
  - Locations and status of owned fleets
- Partial or delayed information about:
  - Market prices outside visited regions
  - Route safety and threat levels
  - War state beyond nearby fronts

Unvisited or unsupported regions are opaque by default.

---

### Discovery and First Contact

The player ship is the primary tool for **initial information acquisition**.

- New stations, regions, and factions require physical presence to:
  - Reveal market structure
  - Establish trade access
  - Unlock regional information flow
- Fleets cannot operate autonomously in unknown regions until discovery is complete

This preserves player embodiment and makes exploration meaningful.

---

### Information Delay and Uncertainty

Information degrades with distance, time, and lack of infrastructure.

Examples:
- Market prices may be outdated
- Threat assessments may be probabilistic
- Fleet status updates may arrive late

Delays are intentional and legible, not random.

The player should understand:
- What is known
- What is estimated
- What is unknown

---

### Improving Information Quality

Information quality improves through:

- Sustained trade and presence in a region
- Dedicated intelligence or sensor technologies
- Espionage investments
- Infrastructure (relay stations, hubs, etc.)

Higher information quality reduces variance and delay, but never eliminates uncertainty entirely.

---

### Feedback and Causality

Outcomes must be **explainable**, even when uncertain.

When events occur (losses, delays, price shifts), the player should be able to trace them to:
- Known risks
- Incomplete information
- Strategic choices

Surprise is acceptable. Confusion is not.

---

### War State Visibility

The galactic war is visible only in aggregate.

- Frontline movement
- Regional instability
- Supply shortages

The player does not see tactical details, only **logistical consequences**.

This reinforces the fantasy of influencing the war indirectly.

---

### Relationship to Automation

Automation does not grant perfect information.

- Automated fleets operate on available data
- Poor information leads to suboptimal execution
- Better intelligence improves automation outcomes

This prevents automation from becoming a “set and forget” solution.

---

### Design Invariants (Reinforced)

- Information is power
- Uncertainty is intentional and bounded
- Discovery requires presence
- Better data improves decisions, not guarantees outcomes
- The player is never punished for what they could not reasonably know


## WORK ORDERS AND ECONOMIC FLOW (LOCKED PRINCIPLES)

### Work Orders as the Core Abstraction

All non-player-ship activity in the game is expressed through a single abstraction: **Work Orders**.

A Work Order represents an ongoing or time-bound directive assigned to a fleet.  
Fleets do not act independently; they always execute a Work Order.

This abstraction unifies:
- Trade routes
- Contracts
- Mining operations
- Patrol and escort duties
- Special strategic actions

---

### Types of Work Orders

There are three high-level categories of Work Orders:

1. **Route Orders (Persistent)**
   - Player-defined
   - Represent long-term trade or supply infrastructure
   - Execute continuously until modified or cancelled
   - Form the economic backbone of the player’s power

2. **Contract Orders (Temporary)**
   - Generated by the world in response to economic and war conditions
   - Time-bound and situational
   - Represent shortages, emergencies, opportunities, or strategic needs
   - Optional but consequential if ignored

3. **Special Orders (Strategic)**
   - Unlocked via technology or intelligence
   - Include actions such as reconnaissance, covert delivery, or strategic intervention
   - Often high-risk and high-impact

All orders share the same structural model, differing only in scope, duration, and origin.

---

### Order Definition (Conceptual)

A Work Order defines:

- Objective (deliver, mine, patrol, escort, recon)
- Origin and destination or operating region
- Duration (persistent, fixed-term, one-off)
- Priority and urgency
- Risk tolerance
- Expected outcome (explicit or estimated)

Orders are evaluated continuously against available information and conditions.

---

### Economic Flow and World Reaction

The game world reacts to Work Orders.

- Sustained routes stabilize regions and markets
- Ignored contracts worsen shortages or instability
- War pressure alters the type and urgency of contracts generated
- Player infrastructure influences what opportunities appear

The player does not simply respond to the world; their trade network actively reshapes it.

---

### Player Interaction Model

- Early game: the player personally executes Work Orders via their ship
- Mid game: fleets execute orders under player direction
- Late game: the player orchestrates multiple overlapping orders at scale

Direct player intervention remains possible for discovery, crisis response, and high-leverage actions.

---

### Technology Interaction

Technology expands the Work Order system by:

- Unlocking new order types
- Improving execution efficiency
- Reducing risk and uncertainty
- Enabling larger or more complex orders

Technology does not eliminate decision-making; it increases strategic bandwidth.

---

### Design Invariants (Reinforced)

- All economic activity flows through Work Orders
- Routes represent power; contracts represent pressure
- The world responds systemically, not narratively
- Scale introduces tradeoffs, not automation without consequence
- The player’s strength is measured by coordination, not micromanagement


## EARLY GAME CONTRACT AND PLAYER AUTHORITY (LOCKED PRINCIPLES)

### Early Game Contract (First 60–90 Minutes)

The early game exists to establish **trust, tension, and legibility**.

During this phase:
- The player controls a single ship
- The playable space is limited to a small number of regions
- Markets are fragile, visible, and reactive
- Losses are survivable but instructive

The player must personally:
- Discover new locations
- Make first contact with stations or regions
- Execute initial trades and deliveries
- Observe cause-and-effect between trade actions and world state

The early game is not a tutorial; it is a **proof of agency**.

---

### Transition to Delegation

Delegation is earned, not granted.

- Fleet control unlocks only after the player has personally executed core economic actions
- Early fleets are limited in scope and autonomy
- Automation quality is initially poor and visibly imperfect

This ensures that abstraction feels like progress, not removal of gameplay.

---

### Player Authority and Intervention

The player retains the right to intervene directly, but not universally.

The player may:
- Personally execute or override critical Work Orders
- Intervene in high-risk or high-impact situations
- Act as a discovery and crisis-response asset

The player may not:
- Micromanage routine fleet execution
- Override outcomes after commitments are made
- Eliminate risk through manual control

Authority is **situational and strategic**, not absolute.

---

### Failure Semantics

Failure is informative, not punitive.

- Failed routes create shortages, instability, or opportunity elsewhere
- Ignored contracts escalate pressure rather than ending the game
- Lost fleets alter the strategic landscape but do not invalidate progress

Failure should:
- Reveal new information
- Force adaptation
- Create downstream consequences

Failure should not:
- Hard-lock progress
- Require reloads to remain viable
- Feel arbitrary or opaque

---

### Design Invariants (Reinforced)

- Early play builds intuition, not efficiency
- Delegation is a reward for understanding
- Player presence matters most at points of uncertainty
- Loss reshapes the world instead of ending play


